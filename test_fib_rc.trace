* Options                                                               
OPTI DIME 2 ELEM QUA4 EPSILON LINEAIRE;                                 
DENS 0.1;                                                               
                                                                        
* Points beton                                                          
P1  = -0.5 -0.5;                                                        
P2  =  0.5 -0.5;                                                        
P3  =  0.5  0.5;                                                        
P4  = -0.5  0.5;                                                        
                                                                        
* Points aciers                                                         
PI1 = -0.4 -0.4;                                                        
PI2 =  0.4 -0.4;                                                        
PS1 = -0.4  0.4;                                                        
PS2 =  0.4  0.4;                                                        
                                                                        
* Lignes                                                                
L1  = DROI 1 P1 P2;                                                     
L2  = DROI P2 P3;                                                       
L3  = DROI 1 P3 P4;                                                     
L4  = DROI P4 P1;                                                       
LT  = L1 ET L2 ET L3 ET L4;                                             
                                                                        
SBET= DALL L1 L2 L3 L4 PLAN;                                            
TRAC SBET;                                                              
                                                                        
OPTI DIME 3;                                                            
                                                                        
* Modele sections                                                       
MO1 = MODE SBET MECANIQUE ELASTIQUE QUAS;                               
MA1 = MATE MO1 'YOUN' 36000e6  'NU' 0.2 'ALPY' (5 / 6) 'ALPZ' (5 / 6);  
                                                                        
MO2 = MODE (PI1 ET PI2) MECANIQUE ELASTIQUE POJS;                       
MA2 = MATE MO2 'YOUN' 210000E6  'NU' 0.3 'ALPY' (5 / 6) SECT 1.0e-3     
'ALPZ' (5 / 6);                                                         
                                                                        
MO3 = MODE (PS1 ET PS2) MECANIQUE ELASTIQUE POJS;                       
MA3 = MATE MO3 'YOUN' 210000E6  'NU' 0.3 'ALPY' (5 / 6) SECT 1.0e-3     
'ALPZ' (5 / 6);                                                         
                                                                        
modsTOT= MO1 ET MO2 ET MO3;                                             
matsTOT= MA1 ET MA2 ET MA3;                                             
                                                                        
* Options                                                               
OPTI DIME 3 ELEM SEG2;                                                  
Q1 = 0 0 0;                                                             
Q2 = 1 0 0;                                                             
Q3 = 2 0 0;                                                             
                                                                        
LQ1 = DROI Q1 Q2;                                                       
LQ2 = DROI Q2 Q3;                                                       
LQT = LQ1 ET LQ2;                                                       
                                                                        
modpout = MODE LQT MECANIQUE ELASTIQUE SECTION PLASTIQUE SECTION TIMO;  
matpout = MATE modpout 'MODS' modsTOT 'MATS' matsTOT 'VECT' (0 1 0);    
                                                                        
* Conditions aux limites                                                
CL1 = BLOQ UY UZ RX RY RZ LQT;                                          
*CL2 = BLOQ DEPL ROTA Q3;                                               
CL3 = BLOQ UX Q3;                                                       
*CL4 = BLOQ RX UY LQT;                                                  
*CLT = CL1 ET CL2 ET CL3 ET CL4;                                        
CLT = CL1 ET CL3;                                                       
                                                                        
* Chargement                                                            
EV1  = EVOL MANU (PROG 0 1) (PROG 0 1);                                 
FO1  = DEPI CL3 1.0 ;                                                   
chpzm = CHAR DIMP FO1 EV1;                                              
                                                                        
* Temps calcul√©s                                                       
tcalc = PROG 0 PAS 0.01 1;                                              
                                                                        
* Pasapas                                                               
TAB1 = TABLE;                                                           
TAB1 . BLOCAGES_MECANIQUES = CLT;                                       
TAB1 . MODELE              = modpout;                                   
TAB1 . CARACTERISTIQUES    = matpout;                                   
TAB1 . CHARGEMENT          = chpzm ;                                    
TAB1 . MOVA                = RIEN   ;                                   
TAB1 . TEMPS_CALCULES      = tcalc  ;                                   
PASAPAS TAB1;                                                           
                                                                        
'DEBPROC' PASAPAS  PRECED*'TABLE';                                      
'SAUTER' 1 'LIGNE';                                                     
'MESS'                                                                  
'------------------ DEBUT DE LA PROCEDURE PASAPAS --------------------';
                                                                        
PAS_DEFA PRECED;                                                        
PAS_INIT  PRECED ;                                                      
WTAB=PRECED.'WTABLE';                                                   
conti=PRECED.'CONTINUATION';                                            
estim = PRECED.'ESTIMATION';                                            
GE0_DEB=WTAB.'FOR0';                                                    
'SI'( WTAB.'GRANDS_DEPLACEMENTS' 'OU'  WTAB.'FEFP_FORMULATION');        
  'SI' ( 'EXIS' conti 'DEPLACEMENTS');                                  
    Ge0_deb= 'FORME' conti . 'DEPLACEMENTS';                            
  'FINSI';                                                              
'FINSI';                                                                
'FORM' WTAB.'FOR0';                                                     
                                                                        
'SI' ('EGA' WTAB.'DT' 'INCONNU' );                                      
   DELTAN = 0.D0 ;                                                      
   WTAB.'DT' = DELTAN ;                                                 
'SINON';                                                                
   DELTAN= WTAB.'DT';                                                   
'FINSI';                                                                
'SI' ('NON'('EXIS' WTAB 'ETAT0'));                                      
        WTAB.'ETAT0'= PAS_ETAT PRECED WTAB.'TEMPS0';                    
        PAS_VERM PRECED WTAB.'ETAT0';                                   
                                                                        
        WTAB.'MAT0' = WTAB.'CARACTERISTIQUES';                          
     'SI' (WTAB.'FOR_MECA');                                            
       'SI' (WTAB.'MATVAR' 'OU' WTAB.'MODAL') ;                         
           WTAB.'MAT0'   = PAS_MATE PRECED WTAB.'ETAT0';                
       'FINSI';                                                         
     'FINSI';                                                           
       WTAB.'ETAT1' = WTAB.'ETAT0' ;                                    
       WTAB.'ETAT0'= 0;                                                 
       WTAB.'MAT1'= WTAB.'MAT0';                                        
'SINON';                                                                
        WTAB.'ETAT1'= PAS_ETAT PRECED WTAB.'TEMPS0';                    
        PAS_VERM PRECED WTAB.'ETAT1';                                   
       'SI' (WTAB.'MATVAR' 'OU' WTAB.'MODAL') ;                         
           WTAB.'MAT1'   = PAS_MATE PRECED WTAB.'ETAT1';                
       'SINON' ;                                                        
           WTAB.'MAT1' = WTAB.'CARACTERISTIQUES';                       
       'FINSI';                                                         
'FINSI';                                                                
     'SI' WTAB.'FOR_MECA';                                              
     'SI'(WTAB.'CHAR_THE' 'OU'  WTAB.'FOR_THER' );                      
           PAS_EPTH PRECED;                                             
           WTAB.'ETHER1'=WTAB.'ETHER2';                                 
          'SI' WTAB.'POR1'; WTAB.'MSRTHER1'=WTAB.'MSRTHER2';'FINSI';    
     'FINSI';                                                           
     'FINSI';                                                           
'SI' ('EXISTE' WTAB 'MA_TOTAL' ) ; 'OUBLIE' WTAB 'MA_TOTAL' ; 'FINSI' ; 
'SI' ('EXISTE' WTAB 'MA_TOT' ) ; 'OUBLIE' WTAB 'MA_TOT' ; 'FINSI' ;     
                                                                        
                                                                        
 'SI' WTAB.'PROCEDURE_PERSO1';                                          
    PRECED.'PERSO1_APPEL' = 1 ;                                         
    PERSO1 PRECED ;                                                     
    'SI' ('EXIS' PRECED 'ARRET') ;                                      
      WTAB . 'ARRET' = PRECED . 'ARRET' ;                               
    'FINSI' ;                                                           
 'FINSI';                                                               
                                                                        
 'SI' WTAB.'PROCEDURE_REAC_MECA' ;                                      
     REEV_MEC PRECED 0      ;                                           
 'FINSI' ;                                                              
                                                                        
                                                                        
PASFINAL = 0 ;     IPAS = 0 ;     ICHG=0;                               
IAUTO=1;IREREDU=VRAI;                                                   
TEMP0=  WTAB.'TEMPS0';                                                  
ISAUV=VRAI;                                                             
 DTV= ('EXTR' wtab.'TEMPS_CALCULES' 1) - TEMP0 ;                        
 'SI' (DTV '<' 1.e-15 );                                                
  'SI' WTAB . 'FREQUENTIEL' ;                                           
     DTV = 1.e-14 ;                                                     
  'SINON' ;                                                             
     DTV = ('EXTR' WTAB.'TEMPS_CALCULES' 2) - TEMP0 ;                   
  'FINSI';                                                              
 'FINSI';                                                               
WTAB.'ARRET'=FAUX; WTAB.'AUTODEUX'=FAUX;                                
WTAB.'CONV'=VRAI;DT_AVANT=DTV;                                          
WTAB.'NOMBRE_ITERATIONS'=12;                                            
RFROT=0;                                                                
                                                                        
'REPETER' BEXTERN  ;                                                    
                                                                        
    NPAS='DIME' WTAB.'TEMPS_CALCULES';                                  
    ICHG=ICHG + 1;  WTAB.'ICHG'= ICHG;                                  
    'SI' ( ICHG '>' NPAS) ; 'QUITTER' BEXTERN; 'FINSI';                 
    TI = 'EXTRAIRE'  WTAB.'TEMPS_CALCULES' ICHG ;                       
    TIV=TI;                                                             
    'SI' (WTAB.'FREQUENTIEL') ;                                         
       'SI'  (TI '<' TEMP0 ) ;  'ITERER'  BEXTERN ; 'FINSI' ;           
    'SINON' ;                                                           
    'SI'  ((TI '<' TEMP0 ) 'OU' (TI 'EGA' PRECED.'TEMPS'. 0));          
        'ITERER'  BEXTERN ;                                             
    'FINSI'; 'FINSI';                                                   
                                                                        
    PASFINAL=PASFINAL+1;                                                
    'SI' WTAB.'PAS_AJUSTE';                                             
       DTV=DT_AVANT;                                                    
       'SI' WTAB.'CONV';                                                
           'SI' (WTAB.'NOMBRE_ITERATIONS' > 20);                        
               DTV=DTV'/' (2. ** 0.5);                                  
           'FINSI';                                                     
           'SI' (WTAB.'NOMBRE_ITERATIONS' <  7);                        
              'SI' IREREDU;                                             
                  DTV=DTV '*' (2. ** 0.5);                              
              'FINSI';                                                  
           'FINSI';                                                     
           DT_AVANT= DTV;                                               
           IREREDU=VRAI;                                                
       'SINON';                                                         
           DTV=0.0000000001D0* DT_AVANT;                                
           DT_AVANT= DT_AVANT /2.;                                      
           IREREDU=FAUX;                                                
       'FINSI';                                                         
       TTI = DTV* 1.0000000001 + TEMP0;                                 
       'SI' ( TTI '<EG' TIV ); TI=TTI;PASFINAL=0; 'FINSI';              
    'FINSI';                                                            
     PRECED.'ESTIMATION'.'TEMPS'=TI;                                    
    'SI' (PASFINAL '>EG' 1.5) ; DT_AVANT= TI-TEMP0; 'FINSI';            
    WTAB.'T_FINAL'= TI;                                                 
    WTAB.'DT_INIT' = TI-TEMP0;                                          
    'SI'((WTAB.'CONSOLIDATION' 'OU' WTAB.'DYNAMIQUE')                   
         'ET' (WTAB.'DT_INIT' 'EGA' 0.));                               
           'ITERER' BEXTERN;                                            
    'FINSI';                                                            
    WTAB.'DT'= WTAB.'DT_INIT';                                          
                                                                        
    IPAS = IPAS + 1;                                                    
    WTAB.'PAS'=IPAS;                                                    
                                                                        
   'SI'( WTAB.'GRANDS_DEPLACEMENTS' 'OU'  WTAB.'FEFP_FORMULATION');     
      'SI' (WTAB.'RECALCUL');                                           
        'SI' ('EGA'  ( 'TYPE' GE0_DEB)  'CONFIGUR');                    
          'FORM'  GE0_DEB;                                              
        'FINSI';                                                        
      'FINSI';                                                          
    'FINSI';                                                            
                                                                        
     I_BOTH = 0 ;                                                       
     'REPETER' BO_BOTH WTAB.'BOU_METH' ;                                
        I_BOTH = I_BOTH + 1 ;                                           
       'SI' WTAB.'CONVERGENCE_MEC_THE' ;                                
          WTAB.'CHARGEMENT' = WTAB . 'CHARGEMENT_I' ;                   
       'FINSI';                                                         
                                                                        
                                                                        
       'SI' (WTAB.'FOR_THER' 'OU' WTAB.'FOR_DIFF') ;                    
         'SI' WTAB.'FOR_MECA' ;                                         
            'SI' (I_BOTH > 1) ;                                         
               'SI' ( 'EXISTE' estim 'FOR' ) ;                          
                  WTAB . 'RECARI' = VRAI ;                              
                  WTAB . 'RECADET' = VRAI;                              
                  WTAB.'REA_GEOM' = VRAI ;                              
                  'FORM' estim.'FOR' ;                                  
               'FINSI';                                                 
            'FINSI' ;                                                   
         'FINSI' ;                                                      
                                                                        
         'SI' (TI 'NEG' TEMP0);                                         
           'SI' ('NON' ('EXISTE' PRECED 'PAS_MAX'));                    
             WTAB.'TEM_CALC' = 'PROG' TI;                               
           'SINON';                                                     
             'SI' ((TEMP0 + PRECED.'PAS_MAX') '>EG' TI);                
                WTAB.'TEM_CALC' = 'PROG' TI;                            
             'SINON';                                                   
                WTAB.'TEM_CALC' = 'PROG' TEMP0                          
                                   'PAS'  PRECED.'PAS_MAX'  TI;         
                WTAB.'TEM_CALC' = 'ENLE'  WTAB.'TEM_CALC' 1;            
             'FINSI';                                                   
           'FINSI';                                                     
           'SI' ('NON' WTAB.'COUPLAGE'); 'MENAGE'; 'FINSI';             
           'SI' ('EGA' WTAB.'PROCEDURE_THERMIQUE' 'NONLINEAIRE');       
              CHTER = TRANSNON PRECED;                                  
           'FINSI';                                                     
           'SI' ('EGA' WTAB.'PROCEDURE_THERMIQUE' 'LINEAIRE');          
             CHTER = TRANSLIN PRECED;                                   
           'FINSI';                                                     
           'SI' ('EGA' WTAB.'PROCEDURE_THERMIQUE' 'DUPONT');            
              WTAB.'NOUV_PAS' = ('EXTR' WTAB.'TEM_CALC' 1) - TEMP0;     
              CHTER = DUPONT2 PRECED;                                   
           'FINSI';                                                     
           'SI' CHTER.'ERREUR';                                         
              'ERREUR' ' ';                                             
           'FINSI';                                                     
           'SI' WTAB.'FOR_THER' ;                                       
             WTAB.'TET2'=CHTER.'INITIAL(2)' ;                           
             WTAB.'CLIT'=CHTER.'CLIT' ;                                 
             'SI' ('EGA' WTAB.'PROCEDURE_THERMIQUE' 'NONLINEAIRE') ;    
               'SI' WTAB.'RAYO' ;                                       
                  WTAB.'RAYONNEMENT' = CHTER.'RAYONNEMENT' ;            
               'FINSI'              ;                                   
               'SI' ('NEG' WTAB.'RIBLO_T' 'INCONNU');                   
                  WTAB.'RIBLO_T'       = CHTER.'RIBLO_T'       ;        
                  WTAB.'LISEA_T'       = CHTER.'LISEA_T'       ;        
               'FINSI' ;                                                
               'SI' WTAB.'PHASE' ;                                      
                  WTAB.'PROPPHAS'    = CHTER.'PROPPHAS'    ;            
               'FINSI' ;                                                
             'FINSI' ;                                                  
             'SI' ('EGA' WTAB.'PROCEDURE_THERMIQUE' 'DUPONT');          
               'SI' WTAB.'RAYO' ;                                       
                 WTAB.'RAYONNEMENT' = CHTER.'RAYONNEMENT' ;             
               'FINSI' ;                                                
             'FINSI';                                                   
           'FINSI' ;                                                    
           'SI' WTAB.'FOR_DIFF' ;                                       
             WTAB.'CO2'=CHTER.'CO2';                                    
             WTAB.'CLID'=CHTER.'CLID' ;                                 
           'FINSI' ;                                                    
         'FINSI';                                                       
         'SI' WTAB.'FOR_THER' ;                                         
           estim.'TEMPERATURES' = WTAB.'TET2' ;                         
           estim.'REACTIONS_THERMIQUES' =                               
             'REAC' WTAB.'CLIT' WTAB.'TET2' ;                           
           'SI' WTAB.'PHASE';                                           
             estim.'PROPORTIONS_PHASE'= WTAB.'PROPPHAS';                
           'FINSI';                                                     
         'FINSI' ;                                                      
         'SI' WTAB.'FOR_DIFF' ;                                         
           estim.'CONCENTRATIONS' = WTAB.'CO2' ;                        
           estim.'REACTIONS_DIFFUSIONS' =                               
             'REAC' WTAB.'CLID' WTAB.'CO2' ;                            
         'FINSI' ;                                                      
                                                                        
         'SI' WTAB.'PROCEDURE_REAC_THER' ;                              
            REEV_THE PRECED  1 ;                                        
         'FINSI' ;                                                      
                                                                        
           FORM GE0_DEB;                                                
         'FINSI' ;                                                      
                                                                        
                                                                        
      'SI' WTAB.'FOR_MECA' ;                                            
         'MESSAGE' ' Numero du pas : ' IPAS                             
'  Indice d evolution : ' ICHG ' -> temps :' TI;                        
                                                                        
         'SI' WTAB.'FOR_THER';                                          
                 THTA1='TABLE';THTA2='TABLE';                           
                 THTA1.0=TEMP0;                                         
                 THTA1.1=TI;                                            
                 THTA2.0= conti.'TEMPERATURES' 'ENLE' 'LX' ;            
                 THTA2.1= estim.'TEMPERATURES' 'ENLE' 'LX' ;            
                 CHTH='CHAR' 'T' THTA1 THTA2;                           
                 CHASANST= WTAB.'CHARGEMENT' 'ENLE' 'T';                
                 WTAB.'CHARGEMENT'= CHASANST 'ET' CHTH;                 
         'FINSI';                                                       
         'SI' (WTAB.'CHAR_THE' );                                       
             WTAB.'TET2' = 'TIRE' (WTAB.'CHARGEMENT') 'T   ' TI;        
         'FINSI';                                                       
                                                                        
                                                                        
      'SI' WTAB.'ITCAR';                                                
            'SI'  ('EGA' WTAB.'CARA'  'INCONNU');                       
                  WTAB.'CARA' = WTAB.'MAT0';                            
           'FINSI';                                                     
      'FINSI';                                                          
                                                                        
         'MENA' ;                                                       
           TT = UNPAS  PRECED;                                          
                                                                        
         'SI'   WTAB.'GRANDS_DEPLACEMENTS' ;                            
            'FORM'  WTAB.'FOR0';                                        
         'FINSI';                                                       
         'SI' WTAB.'FEFP_FORMULATION' ;                                 
            'FORM'  WTAB.'FOR0';                                        
         'FINSI';                                                       
                                                                        
          WTAB.'CONV' = TT.'CONV';                                      
     'SI' ('NON' TT.'CONV' 'ET' ('NON' WTAB.'CONVERGENCE_FORCEE'));     
         'ERREUR' 997 ;                                                 
     'FINSI';                                                           
                                                                        
     DEP0= conti.'DEPLACEMENTS';                                        
     estim.'DEPLACEMENTS' = TT.'ZU1' ;                                  
     estim.'DEFORMATIONS'              = TT.'DEFF';                     
     estim.'CONTRAINTES' = TT.'SIGF';                                   
     estim.'DFGRAD'=TT.'DFGRAD';                                        
     'SI' WTAB.'IPLAVI' ;                                               
       estim.'VARIABLES_INTERNES'        = TT.'VARF';                   
       estim.'DEFORMATIONS_INELASTIQUES' = TT.'DFPF';                   
     'FINSI' ;                                                          
     'SI' WTAB.'GRANDS_DEPLACEMENTS' ;                                  
       estim.'FOR' = TT.'FOR' ;                                         
     'FINSI' ;                                                          
     'SI'  WTAB . 'DYNAMIQUE' ;                                         
        estim.'VITESSES'      = TT.'VITI' ;                             
        estim.'ACCELERATIONS' = TT.'ACCEI' ;                            
     'FINSI';                                                           
     'SI'  WTAB .'ITCAR';                                               
         estim.'CARA_ACTU' = TT.'CARA' ;                                
     'FINSI';                                                           
     'SI' WTAB.'PROCEDURE_REAC_MECA' ;                                  
           REEV_MEC PRECED   1     ;                                    
      'FINSI' ;                                                         
                                                                        
   'FINSI';                                                             
                                                                        
    'SI' WTAB.'CONVERGENCE_MEC_THE' ;                                   
      'SI' (I_BOTH > 1) ;                                               
        CHT1     = WTAB . 'THER_COURANT' ;                              
        DUABS2   = 'ABS' (WTAB . 'THER_COURANTP' - CHT1) ;              
        CRICOH1  = 0. ;                                                 
        NBINCO1  = 'DIME' WTAB . 'PRIM_TOT' ;                           
        'REPE' BINCO1 NBINCO1 ;                                         
          LINCOI1  = 'MOTS' ('EXTR' WTAB . 'PRIM_TOT' &BINCO1) ;        
          MDUABSI1 = 'MAXI' DUABS2 'AVEC' LINCOI1 ;                     
          NORMI1   = 'MAXI' 'ABS' CHT1 'AVEC' LINCOI1 ;                 
          'SI' (NORMI1 '<EG' (1.E-14 * MDUABSI1)) ;                     
            NORMI1   = 1. ;                                             
          'FINS' ;                                                      
          CRICOHI1 = MDUABSI1 / NORMI1 ;                                
          'SI' (CRICOHI1 '>' CRICOH1) ;                                 
            CRICOH1  = CRICOHI1 ;                                       
         'FINS' ;                                                       
        'FIN' BINCO1 ;                                                  
        WTAB.'CONV_THMEC' = CRICOH1 '<' (WTAB . 'CRITERE_COHERENCE') ;  
        'SI'('NON' WTAB.'CONV_THMEC') ;                                 
          'SI' (I_BOTH >EG WTAB.'BOU_METH');                            
            'MESS' 'PAS DE COHERENCE TROUVEE MECANIQUE THERMIQUE' ;     
            'ERREUR' 999;                                               
          'FINSI' ;                                                     
        'FINSI' ;                                                       
      'SINON' ;                                                         
        WTAB.'CONV_THMEC' = FAUX ;                                      
      'FINSI' ;                                                         
       WTAB . 'THER_COURANTP' = WTAB . 'THER_COURANT' ;                 
    'SINON' ;                                                           
      WTAB.'CONV_THMEC' = VRAI ;                                        
    'FINSI' ;                                                           
                                                                        
    'SI' (WTAB.'CONV_THMEC') ;                                          
       'QUITTER' BO_BOTH ;                                              
    'FINSI' ;                                                           
                                                                        
    'SI' ('NEG' ('TYPE'  GE0_DEB) 'MOT') ;                              
      FORME GE0_DEB;                                                    
    'FINSI' ;                                                           
                                                                        
  'FIN' BO_BOTH ;                                                       
                                                                        
                                                                        
      'SI' WTAB.'FOR_THER';                                             
         WTAB.'TET2' = estim.'TEMPERATURES' ;                           
         WTAB.'TET1'=WTAB.'TET2';                                       
         'SI' ('EGA' WTAB.'PROCEDURE_THERMIQUE' 'DUPONT');              
            WTAB.'TET0' = WTAB.'TET1';                                  
            WTAB.'VIEUXPAS'   = WTAB.'NOUV_PAS';                        
            WTAB.'RELAXATION_DUPONT' = CHTER.'RELAXATION_DUPONT';       
            'SI' ('EXISTE' CHTER  'INITIAL(1)') ;                       
               WTAB.'TET1' = CHTER.'INITIAL(1)';                        
            'FINSI' ;                                                   
         'FINSI';                                                       
      'FINSI' ;                                                         
                                                                        
      'SI' WTAB.'FOR_DIFF';                                             
        WTAB.'CO2' = estim.'CONCENTRATIONS' ;                           
      'FINSI' ;                                                         
                                                                        
      'SI' WTAB.'FOR_MECA' ;                                            
         'SI' ('EXISTE' TT 'SECOND_MEMBRE');                            
           WTAB . 'SECOND_MEMBRE' = TT . 'SECOND_MEMBRE' ;              
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'SUCCES');                                   
           WTAB . 'SUCCES' = TT . 'SUCCES' ;                            
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'AUTOCOEF');                                 
           WTAB . 'AUTOCOEF' = TT . 'AUTOCOEF' ;                        
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'AUTOREDU');                                 
           WTAB . 'AUTOREDU' = TT . 'AUTOREDU' ;                        
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'AUTORED1');                                 
           WTAB . 'AUTORED1' = TT . 'AUTORED1' ;                        
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'RIBLO_M');                                  
           WTAB . 'RIBLO_M' = TT . 'RIBLO_M' ;                          
           WTAB . 'LISEA_M' = TT . 'LISEA_M' ;                          
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'INCREMENT');                                
           WTAB . 'INCREMENT' = TT . 'INCREMENT' ;                      
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'INITEMPS');                                 
           WTAB . 'INITEMPS' = TT . 'INITEMPS' ;                        
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'DT');                                       
           WTAB . 'DT' = TT . 'DT' ;                                    
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'NBPLAS');                                   
           WTAB . 'NBPLAS' = TT . 'NBPLAS' ;                            
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'NOMBRE_ITERATIONS');                        
           WTAB . 'NOMBRE_ITERATIONS' = TT . 'NOMBRE_ITERATIONS' ;      
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'FFROT');                                    
           WTAB . 'FFROT' = TT . 'FFROT' ;                              
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'RESIDU');                                   
           WTAB . 'RESIDU' = TT . 'RESIDU' ;                            
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'FNONL');                                    
           WTAB . 'FNONL' = TT . 'FNONL' ;                              
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'DTPREC');                                   
           WTAB . 'DTPREC' = TT . 'DTPREC' ;                            
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'TET2');                                     
           WTAB . 'TET2' = TT . 'TET2' ;                                
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'XDENO');                                    
           WTAB . 'XDENO'  = TT . 'XDENO'  ;                            
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'XDENOM');                                   
           WTAB . 'XDENOM' = TT . 'XDENOM' ;                            
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'LASTKTAN');                                 
           WTAB . 'LASTKTAN' = TT . 'LASTKTAN' ;                        
         'FINSI' ;                                                      
         'SI' ('EXISTE' TT 'DFGRAD');                                   
           WTAB . 'DFGRAD'=  TT .'DFGRAD';                              
         'FINSI' ;                                                      
         'SI' ('EXIS' TT 'ETHER2');                                     
            WTAB.'ETHER1'= TT.'ETHER2';                                 
            WTAB.'ETHER2'= TT.'ETHER2';                                 
         'FINSI';                                                       
         'SI' ('EXIS' TT 'MSRTHER2');                                   
            WTAB.'MSRTHER1'= TT.'MSRTHER2';                             
            WTAB.'MSRTHER2'= TT.'MSRTHER2';                             
         'FINSI';                                                       
         'SI' ('EXIS' TT 'DEFOR2');                                     
            WTAB.'DEFOR1'= TT.'DEFOR2';                                 
            WTAB.'DEFOR2'= TT.'DEFOR2';                                 
         'FINSI';                                                       
         'SI'('EXIS' TT 'ETAT2');                                       
            WTAB.'ETAT1'= TT.'ETAT2';                                   
         'FINSI';                                                       
                                                                        
         TT.'DEPTOT' = estim.'DEPLACEMENTS' ;                           
         TT.'REAC'= 'REAC' TT.'DEPTOT' WTAB.'CLIM';                     
         estim.'REACTIONS' = TT.'REAC' ;                                
         'SI' WTAB.'CHAR_THE';                                          
            WTAB.'ETHER2' = TT.'ETHER2';                                
            'SI' WTAB.'POR1' ;                                          
                WTAB.'MSRTHER2' = TT.'MSRTHER2';                        
            'FINSI';                                                    
         'FINSI';                                                       
                                                                        
         'SI' WTAB . 'DYNAMIQUE' ;                                      
            'SI' WTAB . 'LIAISON_PERSISTANTE' ;                         
                TT.'VITI' =  TT.'VITI' +  TT.'VAUX' ;                   
            'SINON' ;                                                   
             WTAB.'FREA1'  = TT.'FOPL' - TT.'REAC';                     
                                                                        
            TT.'VITI'= VITEUNIL TT.'ZRAIDV' WTAB.'MASSE' TT.'VITI'      
         tt.'DEPT'   DEP0 WTAB.'DT'  WTAB.'SECOND_MEMBRE' WTAB;         
           'SI' ( 'EXIS' WTAB 'RATE_VITEUNIL');                         
           'ERREUR' 'Probleme dans viteunil' ; 'FINSI';                 
            'FINSI' ;                                                   
            'SI' ( 'NEG' WTAB.'REAPREC' 'INCONNU');                     
             'SI' ('EGA' ('TYPE' (EXTR TT.'REAC' 'MAIL')) 'MAILLAGE');  
               reacdif='REDU' WTAB.'REAPREC' (EXTR TT.'REAC' 'MAIL');   
               TT.'REAC'=  TT.'REAC' - REACDIF;                         
             'FINSI' ;                                                  
              WTAB.'REAPREC'=TT.'REAC';                                 
            'SINON';                                                    
               WTAB . 'REAPREC'= TT.'REAC';                             
            'FINSI';                                                    
            estim.'VITESSES'  = TT.'VITI' ;                             
            estim.'REACTIONS' = TT.'REAC' ;                             
         'FINSI';                                                       
                                                                        
'SI' WTAB.'FOR_THER' ;                                                  
'FINS' ;                                                                
                                                                        
                                                                        
         'SI' WTAB . 'CONSOLIDATION' ;                                  
             WTAB.'OPERATEUR'  = ROP;                                   
         'FINSI';                                                       
                                                                        
                                                                        
         'SI'   WTAB.'GRANDS_DEPLACEMENTS' ;                            
            WTAB.'RECALCUL'=VRAI;GE0_DEB = TT.'FOR' ;                   
            'SI' WTAB.'ITCAR' ;                                         
               WTAB.'CARA' = TT.'CARA' ;                                
            'FINSI' ;                                                   
         'FINSI';                                                       
         'FORM' WTAB.'FOR0';                                            
                                                                        
         'SI' ('ET' (WTAB.'FEFP_FORMULATION')                           
                (WTAB.'UPDATE_LAGRANGIAN')) ;                           
            GE0_DEB = TT.'FOR' ; WTAB.'RECALCUL'=VRAI;                  
         'FINSI';                                                       
                                                                        
                                                                        
         'SI' (WTAB . 'RECADET') ;                                      
            'OUBLIER'   ROP;                                            
         'FINSI';                                                       
                                                                        
              DT2 =( TI - TEMP0)/10000.;                                
         'SI' (WTAB . 'AUTOMATIQUE' 'OU' ('NON' WTAB.CONV));            
              TEMP0 = ( TI - TEMP0) *  WTAB.'AUTOCOEF' + TEMP0;         
       'MESS' ' Temps effectivement calcule et non convergÈ : ' TEMP0;  
              WTAB.'TEMPS0' = TEMP0;                                    
         'SINON';                                                       
              TEMP0=TI;                                                 
              WTAB.'TEMPS0' = TEMP0;                                    
         'FINSI';                                                       
                                                                        
                                                                        
         'SI' (WTAB.'PROCEDURE_PERSO1');                                
            PRECED.'PERSO1_APPEL' = 2 ;                                 
            PERSO1 PRECED;                                              
            'SI' ('EXIS' PRECED 'ARRET') ;                              
              WTAB . 'ARRET' = PRECED . 'ARRET' ;                       
            'FINSI' ;                                                   
            TEMP0 =  WTAB.'TEMPS0' ;                                    
         'FINSI';                                                       
         'SI'   WTAB.'CONVERGENCE_MEC_THE' ;                            
           WTAB.'CHARGEMENT_I' = WTAB.'CHARGEMENT' ;                    
         'FINSI';                                                       
      'FINSI';                                                          
                                                                        
      'SI' ('NON' WTAB.'FOR_MECA') ;                                    
         DT2 =( TI - TEMP0)/10000.;                                     
         TEMP0=TI;                                                      
         WTAB.'TEMPS0' = TEMP0;                                         
         TT = 'TABLE' ;                                                 
      'FINSI';                                                          
'SI' ('EXIS' WTAB 'RRRR') ;                                             
'SI'  WTAB.'RECARI';                                                    
   WTAB2= 'ENLEVER' WTAB 'RRRR';                                        
   PRECED .'WTABLE'= WTAB2;                                             
   WTAB=WTAB2;                                                          
   'SI' ( 'EXIS' estim 'FOR') ;                                         
   estim2= 'ENLEVER' estim 'FOR';                                       
   estim= estim2;  PRECED.'ESTIMATION'=estim;                           
   'FINSI';                                                             
'FINSI'; 'FINSI';                                                       
    ISAUV = PAS_RESU  TEMP0  iauto  PRECED  TT ;                        
                                                                        
         'SI' WTAB . 'AUTOMATIQUE'; IAUTO=IAUTO+1;                      
            'SI' ((WTAB . 'AUTOCOEF'   EGA  0.9999999D0) 'OU'           
                  (TEMP0 '>EG' TI)) ;                                   
                  TEMP0=TI;                                             
                'MESS' ' Objectif atteint ';                            
                'MESS' ' ';                                             
                WTAB.'AUTODEUX' = FAUX ;                                
                WTAB.AUTORED1 = 0 ;                                     
                WTAB.AUTOREDU = 1. ;                                    
                IAUTO=1;                                                
            'SINON';                                                    
                'MESS' ' Objectif non atteint: On recommence';          
                'MESS' '  ';                                            
                'SI' ( IAUTO >EG WTAB.'AUTOPAS');                       
                 'ERREUR' 1000;                                         
                'FINSI';                                                
                WTAB.'AUTODEUX'=VRAI;ICHG=ICHG - 1;                     
            'FINSI';                                                    
         'FINSI';                                                       
'SI'(WTAB.'CHAR_THE' 'OU' WTAB.'FOR_THER');                             
       WTAB.'TET1'=WTAB.'TET2';                                         
      'SI' WTAB.'FOR_MECA';WTAB.'ETHER1'=WTAB.'ETHER2';'FINSI';         
      'SI' WTAB.'POR1'; WTAB.'MSRTHER1'=WTAB.'MSRTHER2';'FINSI';        
'FINSI';                                                                
'SI' WTAB.'CHAR_DEFI' ;  WTAB.'DEFOR1'=WTAB.'DEFOR2';'FINSI';           
'SI' WTAB.'FOR_DIFF' ; WTAB.'CO1'=WTAB.'CO2'; 'FINSI' ;                 
'SI' WTAB.'PAS_AJUSTE';                                                 
 'SI' ((TI < TIV) 'OU' ('NON' WTAB.'CONV')); ICHG=ICHG-1;'FINSI';       
'FINSI';                                                                
'SI'  WTAB.'ARRET';                                                     
   'QUITTER' BEXTERN;                                                   
'FINSI';                                                                
'FIN'  BEXTERN;                                                         
                                                                        
 'SI' ('NEG' WTAB.'AMORTISSEMENT' 'INCONNU');                           
     WTAB.'AMORTISSEMENT' = TOTO ;                                      
 'FINSI';                                                               
                                                                        
 'SI' ('NEG' ('TYPE'  GE0_DEB) 'MOT') ;                                 
     'DETR' GE0_DEB;                                                    
 'FINSI' ;                                                              
                                                                        
 WTAB.'MAT1' = 'MOT' 'INCONNU';                                         
                                                                        
 'MESS' ' ';                                                            
 'MESS'                                                                 
'------------------- FIN DE LA PROCEDURE PASAPAS ---------------------';
'SAUTER' 1 'LIGNE';                                                     
'SI' ('EXIS' WTAB 'RRRR') ;                                             
   WTAB1= 'ENLEVER' WTAB 'RRRR';                                        
    PRECED .'WTABLE'= WTAB1;                                            
'FINSI';                                                                
                                                                        
'FINPROC' PRECED ;                                                      
DEBPROC PAS_DEFA PRECED*'TABLE';                                        
INOUV=VRAI;                                                             
'SI' ('EXIS' PRECED 'REPRISE');                                         
  'SI' (PRECED.'REPRISE' > 0.);                                         
     PAS_REPR PRECED;                                                   
  'FINSI';                                                              
'FINSI';                                                                
'SI' ('EXIS' PRECED 'WTABLE');                                          
  WTAB=PRECED.'WTABLE';WTAB.'NOUVEAU'=FAUX;INOUV=FAUX;                  
'SINON';                                                                
  WTAB='TABLE';                                                         
  PRECED.'WTABLE'=WTAB;                                                 
'FINSI';                                                                
                                                                        
'SI' INOUV;                                                             
  'SI' (( 'EXISTE' PRECED 'GRANDES_ROTATIONS') 'OU'                     
      ('EXISTE' PRECED 'GRANDES_DEFORMATIONS' ));                       
        'MESS' 'ATTENTION LES DONNEES CONCERNANT LES GRANDES ROTATIONS';
        'MESS' ' ET GRANDES DEFORMATIONS ONT CHANGE.';                  
        'MESS' ' Voir le mot EPSILON des operateurs OPTION ou MODELE';  
        'MESS' ' Arret de Cast3M';                                      
        'ERREUR'   5 ;                                                  
  'FINSI';                                                              
  'SI' ( 'EXISTE' PRECED 'CONTACT' ) ;                                  
     'MESS' ' ATTENTION :' ;                                            
     'MESS' ' Les donnees concernant le CONTACT dans PASAPAS ont ete'   
            ' modifiees :' ;                                            
     'MESS' ' - L indice CONTACT de la table de PASAPAS n existe plus.';
     'MESS' ' - Il faut definir un MODELE de CONTACT.' ;                
     'MESS' ' Arret de Cast3M' ;                                        
     'ERREUR' 5 ;                                                       
  'FINSI';                                                              
 WTAB.'ADVECTION'=FAUX;                                                 
  WTAB.'AMORTISSEMENT'='MOT' 'INCONNU';                                 
  WTAB.'ARRET'=FAUX;                                                    
  WTAB.'AUTOCRIT'= 0.005;                                               
  WTAB.'AUTOCOEF'='MOT' 'INCONNU';                                      
  WTAB.'AUTODEUX'=FAUX;                                                 
  WTAB.'AUTOMATIQUE'= FAUX;                                             
  WTAB.'AUTOPAS'= 250;                                                  
  WTAB.'AUTOREDU'=1.D0;                                                 
  WTAB.'AUTORED1'='MOT' 'INCONNU';                                      
  WTAB.'BETON_HT' = FAUX;                                               
  WTAB.'BLOCAGES_MECANIQUES'='MOT' 'INCONNU';                           
  WTAB.'BLOCAGES_THERMIQUES'='MOT' 'INCONNU';                           
  WTAB.'BLOCAGES_DIFFUSIONS'='MOT' 'INCONNU';                           
  WTAB.'BOU_METH'=1;                                                    
  WTAB.'CAFROTTE' = FAUX ;                                              
  WTAB.'CARA'='MOT' 'INCONNU';                                          
  WTAB.'CARACTERISTIQUES'= 'MOT' 'INCONNU';                             
  WTAB.'CELSIUS'=FAUX;                                                  
  WTAB.'CERAMIQUE'=FAUX;                                                
  WTAB.'CHARGEMENT'='MOT' 'INCONNU';                                    
  WTAB.'CHARGEMENT_I'='MOT' 'INCONNU';                                  
  WTAB.'CHAR_DEFI'=FAUX;                                                
  WTAB.'CHAR_THE' = FAUX;                                               
  WTAB.'CLIM'='MOT' 'INCONNU';                                          
  WTAB.'CONDUCTION'=FAUX;                                               
  WTAB.'CONSOLIDATION'=FAUX;                                            
  WTAB.'CONTACT' = FAUX ;                                               
  WTAB.'CONV'=VRAI;                                                     
  WTAB.'CONVERGENCE_FORCEE' = VRAI;                                     
  WTAB.'CONVERGENCE_MEC_THE'=FAUX;                                      
  WTAB.'CONVERGENCE_MONOTONE' = FAUX;                                   
  WTAB.'CONVECTION' = FAUX;                                             
  WTAB.'CONV_THMEC'=VRAI;                                               
  WTAB.'COUPLAGE' = FAUX;                                               
  WTAB.'CO1'=0;                                                         
  WTAB.'CO2'=0;                                                         
  WTAB.'CTE_STEFAN_BOLTZMANN' = 5.673E-8 ;                              
  WTAB.'DEJA_CALC_CHARTHER'=0.d0;                                       
  WTAB.'DELTAITER'=10;                                                  
  WTAB.'DT'='MOT' 'INCONNU';                                            
  WTAB.'DTPREC'='MOT' 'INCONNU';                                        
  WTAB.'DT_INIT'=0.D0;                                                  
  WTAB.'DYNAMIQUE'=FAUX;                                                
  WTAB.'ENDOMMAGEMENT'=FAUX;                                            
  WTAB.'ETHER1'='MOT' 'INCONNU';                                        
  WTAB.'ETHER2'='MOT' 'INCONNU';                                        
  WTAB.'ETREF'='MOT' 'INCONNU';                                         
  WTAB.'FNONL'='MOT' 'INCONNU';                                         
  WTAB.'FOR'='MOT' 'INCONNU';                                           
  WTAB.'FOR0'='FORM';                                                   
  WTAB.'FOR_DIFF' = FAUX;                                               
  WTAB.'FEFP_FORMULATION' = FAUX;                                       
  WTAB.'FFROT'='MOT' 'INCONNU';                                         
  WTAB.'FREA1'='MOT' 'INCONNU';                                         
  WTAB.'FREQUENTIEL'= FAUX;                                             
  WTAB.'FTOL'='MOT' 'INCONNU';                                          
  WTAB.'GRANDS_DEPLACEMENTS' = FAUX;                                    
  WTAB.'INCREMENT'='MOT' 'INCONNU';                                     
  WTAB.'INITEMPS'= FAUX;                                                
  WTAB.'INITIALISATION'= VRAI;                                          
  WTAB.'IPLAVI'=FAUX;                                                   
  WTAB.'IPRESU'='MOT' 'INCONNU';                                        
  WTAB.'IPTIME'='MOT' 'INCONNU';                                        
  WTAB.'ISAUVEGA'='MOT' 'INCONNU';                                      
  WTAB.'ISAUVEGL'=FAUX;                                                 
  WTAB.'ITCAR'=FAUX;                                                    
  WTAB.'K_SIGMA'=FAUX;                                                  
  WTAB.'K_TANGENT'=FAUX;                                                
  WTAB.'K_TANGENT_ITER0'='MOT' 'INCONNU';                               
  WTAB.'K_TANGENT_PERT'=FAUX;                                           
  WTAB.'K_TANGENT_SYME'=FAUX;                                           
  WTAB.'K_TANG_PERT_C1'= 1.D-3;                                         
  WTAB.'K_TANG_PERT_C2'='MOT' 'INCONNU';                                
  WTAB.'LASTKTAN'='MOT' 'INCONNU';                                      
  WTAB.'LDEVA'='MOT' 'INCONNU';                                         
  WTAB.'LECONOMI'=FAUX;                                                 
  WTAB.'LIAISON_PERSISTANTE' =FAUX;                                     
  WTAB.'LINESEARCH' = FAUX;                                             
  WTAB.'LISEA_M'='MOT' 'INCONNU';                                       
  WTAB.'LISEA_T'='MOT' 'INCONNU';                                       
  WTAB.'LPAR0'='MOT' 'INCONNU';                                         
  WTAB.'MAN'= FAUX;                                                     
  WTAB.'MASSCONST'=FAUX;                                                
  WTAB.'MAT0'='MOT' 'INCONNU';                                          
  WTAB.'MAT1'='MOT' 'INCONNU';                                          
  WTAB.'MATVAR' = FAUX;                                                 
  WTAB.'MAT_CON'='MOT' 'INCONNU';                                       
  WTAB.'MAT_DIF'='MOT' 'INCONNU';                                       
  WTAB.'MAT_MEC'='MOT' 'INCONNU';                                       
  WTAB.'MAT_PHA'='MOT' 'INCONNU';                                       
  WTAB.'MAT_POR'='MOT' 'INCONNU';                                       
  WTAB.'MAT_RAY'='MOT' 'INCONNU';                                       
  WTAB.'MAT_THE'='MOT' 'INCONNU';                                       
  WTAB.'MAT_THM'= 'MOT' 'INCONNU';                                      
  WTAB.'MAT_T'  = 'MOT' 'INCONNU';                                      
  WTAB.'MAT_TOT'='MOT' 'INCONNU';                                       
  WTAB.'MAXDEFOR'= 1.e-3;                                               
  WTAB.'MAXITERATION' = 49;                                             
  WTAB.'MAXSOUSPAS' = 100;                                              
  WTAB.'MAXISOUSPAS'= 2000;                                             
  WTAB.'MA_TOT'='MOT' 'INCONNU';                                        
  WTAB.'MA_TOTAL'= 'MOT' 'INCONNU';                                     
  WTAB.'MEC1' = FAUX;                                                   
  WTAB.'MESSTHER' = VRAI ;                                              
  WTAB.'MODAL' = FAUX;                                                  
  WTAB.'MOD_ADV'='MOT' 'INCONNU';                                       
  WTAB.'MOD_CON'='MOT' 'INCONNU';                                       
  WTAB.'MOD_DIF'='MOT' 'INCONNU';                                       
  WTAB.'MOD_MEC'= 'MOT' 'INCONNU';                                      
  WTAB.'MOD_PHA'='MOT' 'INCONNU';                                       
  WTAB.'MOD_POR'='MOT' 'INCONNU';                                       
  WTAB.'MOD_RAY'='MOT' 'INCONNU';                                       
  WTAB.'MOD_THE'= 'MOT' 'INCONNU';                                      
  WTAB.'MOD_THM'= 'MOT' 'INCONNU';                                      
  WTAB.'MOD_T'  = 'MOT' 'INCONNU';                                      
  WTAB.'MOD_TOT'= 'MOT' 'INCONNU';                                      
  WTAB.'MO_TOT' ='MOT' 'INCONNU';                                       
  WTAB.'MO_TOTAL'=PRECED.'MODELE';                                      
  WTAB.'MOVA' = 'MOT' 'EPSE';                                           
  WTAB.'MSRTHER2'='MOT' 'INCONNU';                                      
  WTAB.'MTOL'='MOT' 'INCONNU';                                          
  WTAB.'NAURES'=100000;                                                 
  WTAB.'NBPLAS'='MOT' 'INCONNU';                                        
  WTAB.'NB_EL_PARA'=1000;                                               
  WTAB.'NFSOR'=0;                                                       
  WTAB.'NITERINTER_MAX' = 15;                                           
  WTAB.'NITER_KTANGENT' = 1;                                            
  WTAB.'NLOC' = FAUX ;                                                  
  WTAB.'NMAXSUBSTEPS' = 1;                                              
  WTAB.'NOMBRE_ITERATIONS'='MOT' 'INCONNU';                             
  WTAB.'NON_LINEAIRE'= FAUX;                                            
  WTAB.'NON_LOCAL' = 'MOT' 'INCONNU' ;                                  
  WTAB.'NOUVEAU'=VRAI;                                                  
  WTAB.'NOUV_PAS'=0.D0;                                                 
  WTAB.'NSOR'=0;                                                        
  WTAB.'OPERATEUR'='MOT' 'INCONNU';                                     
  WTAB.'ORDRE'=12;                                                      
  WTAB.'PARA_EXTE' = FAUX;                                              
  WTAB.'PAS'=0;                                                         
  WTAB.'PAS_AJUSTE' = FAUX;                                             
  WTAB.'PAS_REDU'=FAUX;                                                 
  WTAB.'PHASE'=FAUX;                                                    
  WTAB.'PLASTIQUE' = FAUX;                                              
  WTAB.'POR1' = FAUX;                                                   
  WTAB.'PRECDECHARGE' = 1.E-2;                                          
  WTAB.'PRECFLEX' = 1.E-4;                                              
  WTAB.'PRECISINTER' = 1.D-8;                                           
  WTAB.'PRECISION' = 1.E-4 ;                                            
  WTAB.'PREDICTEUR' = 'MOT' 'INCONNU';                                  
  WTAB.'PROCEDURE'='MOT' 'PASAPAS';                                     
  WTAB.'PROCEDURE_CHAR_MECA'=FAUX;                                      
  WTAB.'PROCEDURE_CHAR_THER'=FAUX;                                      
  WTAB.'PROCEDURE_CONV'=FAUX;                                           
  WTAB.'PROCEDURE_PARA_THER' = FAUX ;                                   
  WTAB.'PROCEDURE_PERSO1' = FAUX;                                       
  WTAB.'PROCEDURE_PERSO2' = FAUX;                                       
  WTAB.'PROCEDURE_REAC_MECA' = FAUX ;                                   
  WTAB.'PROCEDURE_REAC_THER' = FAUX ;                                   
  WTAB.'PROCEDURE_THERMIQUE'='MOT' 'DUPONT';                            
  WTAB.'PROCESSEURS'='MOT' 'INCONNU';                                   
  WTAB.'PROJECTION'= FAUX;                                              
  WTAB.'RAIDCONST' = FAUX;                                              
  WTAB.'RAYO'=FAUX;                                                     
  WTAB.'RAYONNEMENT'='MOT' 'INCONNU';                                   
  WTAB.'REAC_GRANDS'= 0.1 ;                                             
  WTAB.'REA_GEOM' = FAUX ;                                              
  WTAB.'REAPREC'='MOT' 'INCONNU';                                       
  WTAB.'RECALCUL'= FAUX;                                                
  WTAB.'RECAOP'  = VRAI;                                                
  WTAB.'RECADET' = FAUX;                                                
  WTAB.'RECARI'  = FAUX;                                                
  WTAB.'RELAXATION_DUPONT'=0.25;                                        
  WTAB.'RELAXATION_NONCONV' = 1.;                                       
  WTAB.'RELAXATION_THETA'= 1. ;                                         
  WTAB.'RENORMALISATION' = FAUX;                                        
  WTAB.'RESIDU'='MOT' 'INCONNU';                                        
  WTAB.'RIBLO_M'='MOT' 'INCONNU';                                       
  WTAB.'RIBLO_T'='MOT' 'INCONNU';                                       
  WTAB.'RIGIDITE_CONSTANTE'= 'MOT' 'INCONNU';                           
  WTAB.'SECOND_MEMBRE'='MOT' 'INCONNU';                                 
  WTAB.'SOUS_INCREMENT'=1 ;                                             
  WTAB.'STABILITE' = FAUX;                                              
  WTAB.'SUBSTEPPING'=FAUX;                                              
  WTAB.'SUCCES'=VRAI;                                                   
  WTAB.'TABSAUV'='MOT' 'INCONNU';                                       
  WTAB.'TALPHA_REFERENCE'='MOT' 'INCONNU';                              
  WTAB.'TEMPERATURE_REFERENCE' = 'MOT' 'INCONNU' ;                      
  WTAB.'TEMPS0'=0.D0;                                                   
  WTAB.'TEMPS_CALCULES'='MOT' 'INCONNU';                                
  WTAB.'TEM_CALC'='MOT' 'INCONNU';                                      
  WTAB.'TETA'=  1.0D0;                                                  
  WTAB.'TET0'=0;                                                        
  WTAB.'TET1'=0;                                                        
  WTAB.'TET2'=0;                                                        
  WTAB.'TET_INI' = 'MOT' 'INCONNU' ;                                    
  WTAB.'THE1' = FAUX;                                                   
  WTAB.'THER_COURANT'='MOT' 'INCONNU';                                  
  WTAB.'THM1' = FAUX;                                                   
  WTAB.'TREF'='MOT' 'INCONNU';                                          
  WTAB.'T_FINAL'=0.D0;                                                  
  WTAB.'UPDATE_LAGRANGIAN' = FAUX;                                      
  WTAB.'VIEUXPAS'=0.D0;                                                 
  WTAB.'VISCODOMMAGE'=FAUX;                                             
  WTAB.'VISCOPLASTIQUE' = FAUX;                                         
  WTAB.'VISCO_EXTERNE'=FAUX;                                            
  WTAB.'XDENO'=0.d0;                                                    
  WTAB.'XDENOM'=0.d0;                                                   
  'SI' ( 'EXIS' PRECED 'CONTINUATION' );                                
     iii = 'INDEX' PRECED;nii= 'DIME' iii;                              
     'REPETER' boui nii;                                                
     imo=0;                                                             
     'SI' ('EGA' ('TYPE' iii.&boui ) 'MOT     '); imo=1; 'FINSI';       
      'SI' ('EGA' imo 1);  aa= 'MOT' iii.&boui;                         
      'SINON';  aa=   iii.&boui; 'FINSI';                               
       'SI'('NON' ('EXIS' wtab aa));                                    
         WTAB . aa = PRECED . aa;                                       
       'FINSI';                                                         
     'FIN' BOUI;                                                        
  'FINSI';                                                              
  'SI' ('EXIS' PRECED 'REPRISE');                                       
     'SI' ( > PRECED.'REPRISE' 0);                                      
       ii= 'INDEX' (preced.'TEMPS');                                    
       nn = 'DIME' ii; nsor = ii . nn;                                  
       temps0= PRECED. 'TEMPS' . nsor;                                  
       WTAB.'NSOR' = NSOR;                                              
       WTAB.'TEMPS0'=temps0;                                            
     'FINSI';                                                           
  'FINSI';                                                              
                                                                        
'SINON';                                                                
  WTAB.'AMORTISSEMENT'='MOT' 'INCONNU';                                 
  WTAB.'AUTOMATIQUE'= FAUX;                                             
  WTAB.'CHARGEMENT'='MOT' 'INCONNU';                                    
  WTAB.'CHAR_DEFI'=FAUX;                                                
  WTAB.'CHAR_THE' = FAUX;                                               
  WTAB.'CONVERGENCE_FORCEE' = VRAI;                                     
  WTAB.'CONVERGENCE_MONOTONE' = FAUX;                                   
  WTAB.'DYNAMIQUE'=FAUX;                                                
  WTAB.'FREQUENTIEL'= FAUX;                                             
  WTAB.'FTOL'='MOT' 'INCONNU';                                          
  WTAB.'INITIALISATION'= VRAI;                                          
  WTAB.'ISAUVEGA'='MOT' 'INCONNU';                                      
  WTAB.'ISAUVEGL'=FAUX;                                                 
  WTAB.'K_SIGMA'=FAUX;                                                  
  WTAB.'K_TANGENT'=FAUX;                                                
  WTAB.'K_TANGENT_ITER0' = 'MOT' 'INCONNU' ;                            
  WTAB.'K_TANGENT_PERT' = FAUX ;                                        
  WTAB.'K_TANGENT_SYME' = FAUX ;                                        
  WTAB.'K_TANG_PERT_C1' = 1.D-3 ;                                       
  WTAB.'K_TANG_PERT_C2' = 'MOT' 'INCONNU' ;                             
  WTAB.'LECONOMI'=FAUX;                                                 
  WTAB.'LIAISON_PERSISTANTE' =FAUX;                                     
  WTAB.'LINESEARCH' = FAUX;                                             
  WTAB.'MASSCONST'=FAUX;                                                
  WTAB.'MTOL'='MOT' 'INCONNU';                                          
  'SI' ('NON' ('EXISTE' WTAB  'OPERATEUR'));                            
      WTAB.'OPERATEUR' = 'MOT' 'INCONNU' ;                              
  'FINSI' ;                                                             
  'SI' ('EXISTE' WTAB 'NON_LOCAL') ;                                    
    'SI' ('EGA' ('TYPE' WTAB.'NON_LOCAL') 'LOGIQUE') ;                  
      WTAB.'NLOC' = WTAB.'NON_LOCAL' ;                                  
      WTAB.'NON_LOCAL' = 'MOT' 'INCONNU' ;                              
      'SI' WTAB.'NLOC' ; WTAB.'NON_LOCAL' = 'MOT' 'MOYE' ; 'FINSI' ;    
    'SINON' ;                                                           
      'SI' ('NEG' ('TYPE' WTAB.'NON_LOCAL') 'MOT') ;                    
         WTAB.'NLOC' = FAUX ;                                           
         WTAB.'NON_LOCAL' = 'MOT' 'INCONNU' ;                           
      'FINSI' ;                                                         
    'FINS' ;                                                            
  'SINON' ;                                                             
    WTAB.'NLOC' = FAUX ;                                                
    WTAB.'NON_LOCAL' = 'MOT' 'INCONNU' ;                                
  'FINS' ;                                                              
  WTAB.'PAS_AJUSTE' = FAUX;                                             
  WTAB.'PAS_REDU'=FAUX;                                                 
  WTAB.'PROCEDURE_CHAR_MECA'=FAUX;                                      
  WTAB.'PROCEDURE_CHAR_THER'=FAUX;                                      
  WTAB.'PROCEDURE_PARA_THER' = FAUX ;                                   
  WTAB.'PROCEDURE_PERSO1' = FAUX;                                       
  WTAB.'PROCEDURE_PERSO2' = FAUX;                                       
  WTAB.'PROCEDURE_REAC_MECA' = FAUX ;                                   
  WTAB.'PROCEDURE_REAC_THER' = FAUX ;                                   
  WTAB.'PROCESSEURS'='MOT' 'INCONNU' ;                                  
  WTAB.'PROJECTION'= FAUX;                                              
  WTAB.'RAIDCONST' = FAUX;                                              
  WTAB.'RAYO'=FAUX;                                                     
  WTAB.'RELAXATION_NONCONV' = 1.;                                       
  WTAB.'RENORMALISATION' = FAUX;                                        
  WTAB.'STABILITE' = FAUX;                                              
  WTAB.'TEMPS_CALCULES'='MOT' 'INCONNU';                                
  WTAB.'THM1'= FAUX ;                                                   
  WTAB.'MOD_THM'='MOT' 'INCONNU';                                       
  WTAB.'MAT_THM'='MOT' 'INCONNU';                                       
  WTAB.'MOD_T'='MOT' 'INCONNU';                                         
  WTAB.'MAT_T'='MOT' 'INCONNU';                                         
  'SI'('NON' ('EXIS' WTAB 'REAC_GRANDS'));                              
    WTAB.'REAC_GRANDS' = 0.1 ;                                          
  'SINO' ;                                                              
    'SI' ('NEG' ('TYPE' WTAB . 'REAC_GRANDS') 'FLOTTANT') ;             
      WTAB.'REAC_GRANDS' = 0.1 ;                                        
    'FINS' ;                                                            
  'FINSI';                                                              
  'SI' ('NON' ('EXISTE' WTAB 'TET_INI')) ;                              
     WTAB.'TET_INI' = 'MOT' 'INCONNU' ;                                 
  'FINSI';                                                              
  WTAB.'FOR_DIFF'= FAUX ;                                               
  WTAB.'MOD_DIF'='MOT' 'INCONNU';                                       
  WTAB.'MAT_DIF'='MOT' 'INCONNU';                                       
'FINSI';                                                                
                                                                        
                                                                        
WTAB.'FREQUENTIEL' = 'EGA' ('VALE' 'MODE') 'FREQ' ;                     
                                                                        
'SI' ( 'EXISTE' PRECED 'MODELE');                                       
    MO= PRECED.'MODELE';                                                
    TYP1 = 'TYPE' MO;                                                   
   'SI' ('NEG' TYP1 'MMODEL  ');                                        
      'ERREUR' 'Le type du MODELE est incorrect';                       
   'FINSI';                                                             
    WTAB.'MO_TOTAL'=MO;                                                 
'SINON';                                                                
   'ERREUR' 'Il manque la donnee du modele.';                           
'FINSI';                                                                
                                                                        
'SI' ('EXISTE' PRECED 'CHARGEMENT');                                    
   TYP1 = 'TYPE' (PRECED.'CHARGEMENT');                                 
   'SI' ('NEG' TYP1 'CHARGEME');                                        
      'ERREUR' 'Le type du CHARGEMENT est incorrect';                   
   'FINSI';                                                             
   WTAB.'CHARGEMENT'=PRECED.'CHARGEMENT';                               
'SINON';                                                                
    MAGEO= 'EXTR' MO 'MAILLAGE' ;                                       
    WTAB.'CHARGEMENT' = 'CHAR' 'FARFELU'                                
    ( 'MANU' 'CHPO' MAGEO 1 'FARF' 0.)                                  
    ( 'EVOL' 'MANU'  ('PROG' 0. 10.e15 ) ('PROG' 0. 10.e15));           
'FINSI';                                                                
'SI' ('EXISTE' PRECED 'CARACTERISTIQUES');                              
   MA= PRECED.'CARACTERISTIQUES'  ;                                     
   TYP1 = 'TYPE' MA ;                                                   
   'SI' ('NEG' TYP1 'MCHAML  ');                                        
      'ERREUR' 'Le type du champ de materiau est incorrect';            
   'FINSI';                                                             
   WTAB.'CARACTERISTIQUES'=MA ;                                         
   WTAB.'MA_TOTAL'=MA;                                                  
'SINON';                                                                
   'ERREUR' 'Il manque la donnee du materiau.';                         
'FINSI';                                                                
'SI' ('EXISTE' PRECED 'TEMPS_CALCULES');                                
   TYP1 = 'TYPE' PRECED.'TEMPS_CALCULES';                               
   'SI' ('NEG' TYP1 'LISTREEL');                                        
      'ERREUR' 'Le type de TEMPS_CALCULES est incorrect';               
   'FINSI';                                                             
   WTAB.'TEMPS_CALCULES'= PRECED.'TEMPS_CALCULES';                      
'FINSI';                                                                
'SI' (WTAB.'FREQUENTIEL' 'ET'                                           
                 ('NON' ('EXISTE' PRECED 'TEMPS_CALCULES')));           
 l_zf = 'PROG' ; l_ii = 'PROG' 1. 'PAS' 0.3 4. 'PAS' 1. 10. ;           
 'SI' ('EXISTE' WTAB.'CARACTERISTIQUES' 'FREQ') ;                       
  ccfr1 = 'EXCO' WTAB.'CARACTERISTIQUES' 'FREQ' 'NOID' ;                
  'SI' ('EGA' ('TYPE' ccfr1) 'MCHAML  ') ;                              
 ncfr1 = 'EXTR' ccfr1 'NBZO' ;                                          
  'REPE' vfr1 ncfr1 ;                                                   
   f1 = 'EXTR' ccfr1 'FREQ' &vfr1 1 1 ;                                 
log_f1 = ('LOG' f1) / ('LOG' 10.) ;                                     
                                                                        
e10_f1 = 'ENTI' log_f1 ;                                                
  'SI' (log_f1 < 0.) ; e10_f1 = e10_f1 - 1 ; 'FINSI' ;                  
  'SI'((log_f1 - e10_f1) 'EGA' 0.) ; e10_f1 = e10_f1 - 1 ; 'FINSI' ;    
p10_f1 = 10. ** e10_f1 ;                                                
l_zf1 = 'PROG' (f1 - (p10_f1/10.)) (f1 - (p10_f1/100.))                 
      (f1 - (p10_f1/1000.)) (f1 + (p10_f1/1000.)) ;                     
                                                                        
          l_i10 = l_ii * p10_f1 ;                                       
   'SI' (('DIME' l_zf) 'EGA' 0) ;                                       
      e10_min = e10_f1 ; e10_max = e10_f1 + 1 ;                         
     l_zf = 'ORDO' (l_i10 'ET' l_zf1) 'UNIQ' ;                          
   'SINON' ;                                                            
     l_zf0 = l_zf ;                                                     
     'SI' ((e10_f1 '>EG' e10_min) 'ET' (e10_f1 < e10_max)) ;            
      l_zf = 'ORDO' (l_zf 'ET' l_zf1) 'UNIQ' ;                          
     'SINON' ;                                                          
       'SI' (e10_f1 < e10_min) ;                                        
        e10_u = e10_f1 ;                                                
        'REPE'  b_lz ;                                                  
         l_zf0 = l_i10 'ET' l_zf0 ; e10_u = e10_u + 1 ;                 
         'SI' (e10_u 'EGA' e10_min) ; 'QUIT' b_lz ; 'FINSI'  ;          
         l_i10 = l_i10 * 10 ;                                           
        'FIN'  b_lz ;                                                   
        e10_min = e10_f1 ;                                              
        l_zf = 'ORDO' (l_zf0 'ET' l_zf1) 'UNIQ' ;                       
       'FINSI'  ;                                                       
       'SI' (e10_f1 '>EG' e10_max) ;                                    
        e10_u = e10_f1 ;                                                
        'REPE'  b_lz ;                                                  
         l_zf0 = l_i10 'ET' l_zf0 ; e10_u = e10_u - 1 ;                 
         'SI' (e10_u < e10_max) ; 'QUIT' b_lz ; 'FINSI'  ;              
         l_i10 = l_i10 / 10 ;                                           
        'FIN'  b_lz ;                                                   
        e10_max = e10_f1 + 1;                                           
        l_zf = 'ORDO' (l_zf0 'ET' l_zf1) 'UNIQ' ;                       
       'FINSI'  ;                                                       
     'FINSI'  ;                                                         
   'FINSI'  ;                                                           
  'FIN'  vfr1 ;                                                         
  'SINON' ;                                                             
  l_zf = l_ii ;                                                         
  'FINSI' ;                                                             
  WTAB.'TEMPS_CALCULES' = l_zf ;                                        
 'SINON' ;                                                              
  WTAB.'TEMPS_CALCULES' = l_ii ;                                        
 'FINSI' ;                                                              
'FINSI' ;                                                               
'SI' (WTAB.'FREQUENTIEL') ;                                             
  'REPETER' BTFRE ;                                                     
    TI = 'EXTRAIRE'  WTAB.'TEMPS_CALCULES' &BTFRE ;                     
    'SI' (TI '>' 0.D0) ;                                                
       WTAB.'TEMPS0' = TI ;                                             
       'QUITTER' BTFRE ;                                                
    'FINSI' ;                                                           
 'FIN' BTFRE ;                                                          
'FINSI';                                                                
'SI' ('EXISTE' PRECED 'DELTAITER');                                     
   WTAB.'DELTAITER'=PRECED.'DELTAITER';                                 
'FINSI' ;                                                               
'SI' ('EXISTE' PRECED 'AUTOMATIQUE');                                   
  WTAB.'AUTOMATIQUE'= PRECED.'AUTOMATIQUE';                             
'FINSI' ;                                                               
'SI' ('EXISTE' PRECED 'FTOL' );                                         
   WTAB.'FTOL' = PRECED.'FTOL';                                         
'FINSI';                                                                
'SI' ('EXISTE' PRECED 'MTOL' );                                         
   WTAB.'MTOL' = PRECED.'MTOL';                                         
'FINSI';                                                                
'SI' ('EXISTE' PRECED 'PAS_AJUSTE');                                    
    WTAB.'PAS_AJUSTE' =  PRECED.'PAS_AJUSTE';                           
'SINON';                                                                
   'SI'  (('NON' ( 'EXISTE' PRECED 'TEMPS_CALCULES' ))                  
     'ET' ('EGA' ('TYPE' WTAB.'TEMPS_CALCULES') 'MOT')) ;               
         WTAB.'PAS_AJUSTE' = VRAI;                                      
        'SI'  ( 'NON' ( 'EXISTE' PRECED 'TEMPS_SAUVES' ));              
            'ERREUR'                                                    
          'Il manque la donnÈe des temps a sauver ou a calculer';       
        'FINSI';                                                        
        WTAB.'TEMPS_CALCULES'= PRECED.'TEMPS_SAUVES';                   
        WTAB.'TEMPS_SAUVES' = PRECED.'TEMPS_SAUVES';                    
   'FINSI';                                                             
'FINSI';                                                                
'SI' WTAB.'AUTOMATIQUE';  WTAB.'PAS_AJUSTE'= FAUX; 'FINSI';             
                                                                        
'SI' ( 'EGA' WTAB.'TEMPS_CALCULES' 'INCONNU');                          
    'ERREUR' 'Il manque la donnÈe des TEMPS_CALCULES ';                 
'FINSI';                                                                
                                                                        
  'SI' ('NEG' WTAB.'OPERATEUR' 'INCONNU');                              
     WTAB.'RECAOP' = FAUX ;                                             
  'FINSI' ;                                                             
'SI'  ('EXISTE' PRECED  'PROCEDURE_CHAR_MECA');                         
  WTAB.'PROCEDURE_CHAR_MECA'= PRECED . 'PROCEDURE_CHAR_MECA';           
'FINSI';                                                                
                                                                        
'SI'  ('EXISTE' PRECED  'PROCESSEURS');                                 
  WTAB.'PROCESSEURS'= 'MOT' PRECED  . 'PROCESSEURS';                    
'FINSI';                                                                
                                                                        
'SI'  ('EXISTE' PRECED  'PROCEDURE_CHAR_THER');                         
  WTAB.'PROCEDURE_CHAR_THER'= PRECED . 'PROCEDURE_CHAR_THER';           
'FINSI';                                                                
                                                                        
'SI' ('EXISTE' PRECED 'PROCEDURE_PARA_THER') ;                          
  WTAB.'PROCEDURE_PARA_THER' = PRECED.'PROCEDURE_PARA_THER' ;           
'FINSI';                                                                
                                                                        
WTAB. 'PROCEDURE_THERMIQUE' = 'NONLINEAIRE';                            
'SI' ('EXISTE' PRECED 'PROCEDURE_THERMIQUE');                           
   WTAB. 'PROCEDURE_THERMIQUE' = PRECED.'PROCEDURE_THERMIQUE';          
'FINSI';                                                                
'SI' ('EXISTE' MO 'FORM' 'THERMIQUE');                                  
   'SI'('EXIS' PRECED 'CELSIUS');                                       
     WTAB.'CELSIUS'=PRECED.'CELSIUS';                                   
   'FINSI';                                                             
   WTAB.'THE1'=VRAI;                                                    
   WTAB.'MOD_THE' = 'EXTR' MO 'FORM' 'THERMIQUE';                       
   WTAB.'MAT_THE' = 'REDU' MA WTAB.'MOD_THE';                           
   WTAB.'MOD_T'   = WTAB.'MOD_THE' ;                                    
   WTAB.'MAT_T'   = WTAB.'MAT_THE' ;                                    
   WTAB.'THM1'= 'EXIS' MO 'FORM' 'THERMOHYDRIQUE' ;                     
   'SI' WTAB.'THM1' ;                                                   
     WTAB.'PROCEDURE_THERMIQUE'='NONLINEAIRE';                          
     WTAB.'MOD_THM' = 'EXTR' MO 'FORM' 'THERMOHYDRIQUE' ;               
     WTAB.'MAT_THM' = 'REDU' MA WTAB.'MOD_THM';                         
     WTAB.'MOD_T'   = WTAB.'MOD_T' 'ET' WTAB.'MOD_THM' ;                
     WTAB.'MAT_T'   = WTAB.'MAT_T' 'ET' WTAB.'MAT_THM' ;                
   'FINSI' ;                                                            
   WTAB.'MOD_TOT' = WTAB.'MOD_T' ;                                      
   WTAB.'MAT_TOT' = WTAB.'MAT_T' ;                                      
   WTAB.'PHASE' = 'EXISTE' WTAB.'MOD_THE' 'MATE' 'PHASE';               
   'SI' WTAB.'PHASE';                                                   
     WTAB.'PROCEDURE_THERMIQUE'='NONLINEAIRE';                          
     WTAB.'MOD_PHA' = 'EXTR' WTAB.'MOD_THE' 'MATE' 'PHASE';             
     WTAB.'MAT_PHA' = 'REDU' WTAB.'MAT_THE' WTAB.'MOD_PHA';             
     WTAB.'BLO_PHASE' = PMAT WTAB.'MOD_PHA';                            
   'FINSI';                                                             
   'SI' ( 'EXISTE' WTAB.'MOD_THE' 'MATE' 'CONVECTION');                 
       WTAB.'MOD_CON' = 'EXTR' WTAB.'MOD_THE' 'MATE' 'CONVECTION';      
       WTAB.'MAT_CON'='REDU' WTAB.'MAT_TOT' WTAB.'MOD_CON';             
       WTAB.'CONVECTION'=VRAI;                                          
   'FINSI';                                                             
   'SI' ( 'EXISTE' WTAB.'MOD_THE' 'MATE' 'RAYONNEMENT');                
       WTAB.'PROCEDURE_CHAR_THER' = VRAI ;                              
       WTAB.'RAYO'=VRAI;                                                
       WTAB.'MOD_RAY'= 'EXTR' WTAB.'MOD_THE' 'MATE' 'RAYONNEMENT';      
       WTAB.'MAT_RAY' ='REDU' WTAB.'MAT_TOT' WTAB.'MOD_RAY';            
       WTAB.'RAYONNEMENT'='PRRA'  WTAB.'MOD_RAY';                       
   'FINSI';                                                             
   'SI' ( 'EXISTE' WTAB.'MOD_THE' 'MATE' 'ADVECTION');                  
       WTAB.'MOD_ADV' = 'EXTR' WTAB.'MOD_THE' 'MATE' 'ADVECTION';       
       WTAB.'MAT_ADV'='REDU' WTAB.'MAT_TOT' WTAB.'MOD_ADV';             
       WTAB.'ADVECTION'=VRAI;                                           
   'FINSI';                                                             
   'SI' ( 'EXISTE' WTAB.'MOD_THE' 'MATE' 'CONDUCTION');                 
       WTAB.'MOD_COND'= 'EXTR' WTAB.'MOD_THE' 'MATE' 'CONDUCTION';      
       WTAB.'MAT_COND'= 'REDU' WTAB.'MAT_TOT' WTAB.'MOD_COND';          
       WTAB.'CONDUCTION'=VRAI;                                          
    'FINSI';                                                            
   'SI' ( 'EXIS' PRECED 'BLOCAGES_THERMIQUES' );                        
      WTAB. 'BLOCAGES_THERMIQUES'=PRECED. 'BLOCAGES_THERMIQUES';        
   'FINSI';                                                             
'SINON' ;                                                               
  'SI' ('EXISTE' MO 'FORM' 'THERMOHYDRIQUE');                           
    'SI'('EXIS' PRECED 'CELSIUS');                                      
      WTAB.'CELSIUS'=PRECED.'CELSIUS';                                  
    'FINSI';                                                            
    WTAB.'THE1' = FAUX;                                                 
    WTAB.'THM1' = VRAI;                                                 
    WTAB.'PROCEDURE_THERMIQUE'='NONLINEAIRE';                           
    WTAB.'MOD_THM' = 'EXTR' MO 'FORM' 'THERMOHYDRIQUE';                 
    WTAB.'MAT_THM' = 'REDU' MA WTAB.'MOD_THM';                          
    WTAB.'MOD_T'   = WTAB.'MOD_THM' ;                                   
    WTAB.'MAT_T'   = WTAB.'MAT_THM' ;                                   
    WTAB.'MOD_TOT' = WTAB.'MOD_T' ;                                     
    WTAB.'MAT_TOT' = WTAB.'MAT_T' ;                                     
    WTAB.'PHASE' = FAUX ;                                               
    'SI' ('EXISTE' MO 'MATE' 'CONVECTION');                             
      WTAB.'MOD_CON' = 'EXTR' MO 'MATE' 'CONVECTION';                   
      WTAB.'MAT_CON'='REDU' MA WTAB.'MOD_CON';                          
      WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_CON';              
      WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_CON';              
      WTAB.'CONVECTION' = VRAI;                                         
    'FINSI';                                                            
    'SI' ('EXISTE' MO 'MATE' 'RAYONNEMENT');                            
      WTAB.'PROCEDURE_CHAR_THER' = VRAI ;                               
      WTAB.'RAYO'=VRAI;                                                 
      WTAB.'MOD_RAY'= 'EXTR'  MO 'MATE' 'RAYONNEMENT';                  
      WTAB.'MAT_RAY' = 'REDU' MA WTAB.'MOD_RAY';                        
      WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_RAY';              
      WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_RAY';              
    'FINSI';                                                            
    'SI' ('EXISTE' MO 'MATE' 'CONDUCTION');                             
      WTAB.'MOD_COND' = 'EXTR' MO 'MATE' 'CONDUCTION';                  
      WTAB.'MAT_COND'='REDU' MA WTAB.'MOD_COND';                        
      WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_COND';             
      WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_COND';             
      WTAB.'CONVECTION' = VRAI;                                         
    'FINSI';                                                            
    'SI' ('EXISTE' MO 'MATE' 'ADVECTION');                              
      WTAB.'MOD_ADV' = 'EXTR' MO 'MATE' 'ADVECTION';                    
      WTAB.'MAT_ADV'='REDU' MA WTAB.'MOD_ADV';                          
      WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_ADV';              
      WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_ADV';              
      WTAB.'ADVECTION' = VRAI;                                          
    'FINSI';                                                            
    'SI' ( 'EXIS' PRECED 'BLOCAGES_THERMIQUES' );                       
       WTAB. 'BLOCAGES_THERMIQUES'=PRECED. 'BLOCAGES_THERMIQUES';       
    'FINSI';                                                            
  'FINSI';                                                              
'FINSI';                                                                
WTAB . 'FOR_THER' = WTAB.'THE1' 'OU' WTAB.'THM1' ;                      
'SI' ('EXIS' MO 'FORM' 'DIFFUSION') ;                                   
  WTAB . 'FOR_DIFF' = VRAI ;                                            
  WTAB . 'MOD_DIF'  = 'EXTR' MO 'FORM' 'DIFFUSION' ;                    
  WTAB . 'MAT_DIF'  = 'REDU' MA WTAB . 'MOD_DIF' ;                      
  WTAB . 'PROCEDURE_THERMIQUE' = 'NONLINEAIRE';                         
  'SI' WTAB.'THE1' ;                                                    
    WTAB.'MOD_THE' = WTAB.'MOD_THE' 'ET' WTAB.'MOD_DIF' ;               
    WTAB.'MAT_THE' = WTAB.'MAT_THE' 'ET' WTAB.'MAT_DIF' ;               
    WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_DIF' ;               
    WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_DIF' ;               
  'SINON' ;                                                             
    WTAB.'MOD_THE' = WTAB.'MOD_DIF' ;                                   
    WTAB.'MAT_THE' = WTAB.'MAT_DIF' ;                                   
    'SI' WTAB.'THM1' ;                                                  
      WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_DIF' ;             
      WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_DIF' ;             
    'SINON' ;                                                           
      'SI' ('NEG' WTAB.'MOD_TOT' 'INCONNU') ;                           
        WTAB.'MOD_TOT' = WTAB.'MOD_TOT' 'ET' WTAB.'MOD_DIF' ;           
        WTAB.'MAT_TOT' = WTAB.'MAT_TOT' 'ET' WTAB.'MAT_DIF' ;           
      'SINON' ;                                                         
        WTAB.'MOD_TOT' = WTAB.'MOD_DIF' ;                               
        WTAB.'MAT_TOT' = WTAB.'MAT_DIF' ;                               
      'FINSI' ;                                                         
    'FINSI' ;                                                           
                                                                        
  'FINSI' ;                                                             
  'SI' ('EXIS' PRECED 'BLOCAGES_DIFFUSIONS') ;                          
    WTAB . 'BLOCAGES_DIFFUSIONS' = PRECED .  'BLOCAGES_DIFFUSIONS';     
  'FINSI' ;                                                             
'FINSI' ;                                                               
'SI' ('NEG' (WTAB.'MOD_TOT') 'INCONNU') ;                               
  WTAB . 'PRIM_TOT' = 'EXTR' WTAB . 'MOD_TOT' 'DEPL' ;                  
  WTAB . 'DUAL_TOT' = 'EXTR' WTAB . 'MOD_TOT' 'FORC' ;                  
  WTAB . 'PRIM_TOT' = WTAB . 'PRIM_TOT' 'ET' ('MOTS' 'LX') ;            
  WTAB . 'DUAL_TOT' = WTAB . 'DUAL_TOT' 'ET' ('MOTS' 'FLX') ;           
'FINS' ;                                                                
'SI' WTAB . 'FOR_THER' ;                                                
  WTAB . 'PRIM_T' = 'EXTR' WTAB . 'MOD_T' 'DEPL' ;                      
  WTAB . 'DUAL_T' = 'EXTR' WTAB . 'MOD_T' 'FORC' ;                      
  WTAB . 'PRIM_T' = WTAB . 'PRIM_T' 'ET' ('MOTS' 'LX') ;                
  WTAB . 'DUAL_T' = WTAB . 'DUAL_T' 'ET' ('MOTS' 'FLX') ;               
'FINS' ;                                                                
'SI' WTAB . 'FOR_DIFF' ;                                                
  WTAB . 'PRIM_DIF' = 'EXTR' WTAB . 'MOD_DIF' 'DEPL' ;                  
  WTAB . 'DUAL_DIF' = 'EXTR' WTAB . 'MOD_DIF' 'FORC' ;                  
  WTAB . 'PRIM_DIF' = WTAB . 'PRIM_DIF' 'ET' ('MOTS' 'LX') ;            
  WTAB . 'DUAL_DIF' = WTAB . 'DUAL_DIF' 'ET' ('MOTS' 'FLX') ;           
'FINS' ;                                                                
NOLIUTIL = FAUX ;                                                       
'SI' ('EXISTE' MO 'FORM' 'MECANIQUE');                                  
   WTAB.'MEC1'=VRAI;                                                    
   WTAB.'MOD_MEC' = 'EXTR' MO 'FORM' 'MECANIQUE';                       
   WTAB.'MAT_MEC' = 'REDU' MA  WTAB.'MOD_MEC';                          
'FINSI';                                                                
'SI' ('EXIS' MO 'FORM' 'CONTACT' ) ;                                    
   WTAB.'CONTACT' = VRAI ;                                              
   WTAB.'GRANDS_DEPLACEMENTS' = VRAI;                                   
   MODCONTA='EXTR' MO  'FORM' 'CONTACT';                                
   WTAB.'MODCONTA'=MODCONTA;                                            
   'SI' ( ('EXIS'  MODCONTA  'MATE' 'COULOMB') 'OU'                     
          ('EXIS'  MODCONTA  'MATE' 'FROCABLE') ) ;                     
      WTAB.'CAFROTTE' = VRAI ;                                          
      WTAB.'MOD_FRO' = 'EXTR' MO 'COMP' 'FROTTANT';                     
      WTAB.'MAT_FRO'= 'REDU' MA  WTAB.'MOD_FRO' ;                       
   'FINSI';                                                             
'FINSI';                                                                
'SI' ('EXISTE' MO 'FORM' 'POREUX');                                     
   WTAB.'POR1'=VRAI;                                                    
   WTAB.'MOD_POR' = 'EXTR' MO 'FORM' 'POREUX';                          
   WTAB.'MAT_POR' = 'REDU' MA  WTAB.'MOD_POR';                          
   WTAB.'MAI_POR' = 'EXTR' WTAB.'MOD_POR' 'MAIL';                       
   WTAB.'MOT_POR' = 'MOTS' 'FP' 'FPQ' 'FTP' ;                           
'FINSI';                                                                
WTAB . 'FOR_MECA' = WTAB . 'MEC1' 'OU' WTAB . 'POR1' ;                  
'SI'                                                                    
  ('NON' (WTAB.'FOR_MECA' 'OU' WTAB.'FOR_THER' 'OU' WTAB.'FOR_DIFF')) ; 
   'ERREUR' 'Le modele ne correspond a aucune formulation valable';     
'FINSI';                                                                
'SI' ('EXISTE' MO 'FORM' 'LIAISON');                                    
   WTAB.'MOD_LIA' = 'EXTR' MO 'FORM' 'LIAISON' ;                        
   WTAB.'MAT_LIA' = 'REDU' MA WTAB.'MOD_LIA' ;                          
'FINSI' ;                                                               
'SI' WTAB.'FOR_THER';                                                   
  'SI'  WTAB.'FOR_MECA' ;                                               
      WTAB.'COUPLAGE' = VRAI;                                           
      'SI' ('NON' ('EXIS' PRECED 'PROJECTION'));                        
          WTAB.'PROJECTION' = FAUX;                                     
      'SINON';                                                          
          WTAB.'PROJECTION'=PRECED.'PROJECTION';                        
      'FINSI';                                                          
  'SINON';                                                              
      WTAB.'PAS_AJUSTE'=FAUX;                                           
  'FINSI';                                                              
'FINSI';                                                                
                                                                        
'SI' (('EXISTE' (WTAB.'CHARGEMENT') 'T') 'OU' WTAB.'COUPLAGE');         
    WTAB.'CHAR_THE' = VRAI;                                             
    'SI' ('EXISTE' PRECED 'TEMPERATURE_REFERENCE') ;                    
       WTAB.'TEMPERATURE_REFERENCE' = PRECED.'TEMPERATURE_REFERENCE' ;  
    'SINON';                                                            
       'SI' ('EGA' (WTAB.'TEMPERATURE_REFERENCE') 'INCONNU') ;          
         'SI' ('EXIS' PRECED 'TEMPERATURES');                           
           WTAB.'TEMPERATURE_REFERENCE' = PRECED.'TEMPERATURES'. 0 ;    
         'SINON' ;                                                      
           'SI' WTAB.'COUPLAGE' ;                                       
             WTAB.'TEMPERATURE_REFERENCE' = 'CHAN' 'CHPO'               
                ('ZERO' WTAB.'MOD_THE' 'TEMPERATURES') WTAB.'MOD_THE';  
           'SINON' ;                                                    
             WTAB.'TEMPERATURE_REFERENCE' = 'TIRE' WTAB.'CHARGEMENT'    
                                                   'T' WTAB.'TEMPS0' ;  
           'FINSI' ;                                                    
         'FINSI' ;                                                      
       'FINSI' ;                                                        
    'FINSI';                                                            
    'SI' ('EXISTE' PRECED 'TALPHA_REFERENCE');                          
         WTAB.'TALPHA_REFERENCE' = PRECED.'TALPHA_REFERENCE';           
    'SINON';                                                            
         WTAB.'TALPHA_REFERENCE' = 0.;                                  
    'FINSI';                                                            
    'SI' ('EGA' WTAB.'TET_INI' 'INCONNU') ;                             
       'SI' ('EXIS' PRECED 'TEMPERATURES') ;                            
          WTAB.'TET_INI' = PRECED.'TEMPERATURES'. 0 ;                   
       'SINON' ;                                                        
          'SI' ('EXISTE' (WTAB.'CHARGEMENT') 'T') ;                     
            WTAB.'TET_INI'= 'TIRE' WTAB.'CHARGEMENT' 'T' WTAB.'TEMPS0' ;
          'SINON';                                                      
            WTAB.'TET_INI' = 'CHAN' 'CHPO' WTAB.'MOD_THE'               
                 ('ZERO'  WTAB.'MOD_THE' 'TEMPERATURES') ;              
          'FINSI';                                                      
       'FINSI' ;                                                        
    'FINSI';                                                            
'FINSI';                                                                
'SI' ('EXISTE' (WTAB.'CHARGEMENT') 'DEFI');                             
      WTAB.'CHAR_DEFI' = VRAI;                                          
'FINSI';                                                                
                                                                        
'SI' (  'EXISTE' PRECED 'DYNAMIQUE') ;                                  
      WTAB.'DYNAMIQUE' = PRECED.'DYNAMIQUE';                            
      'SI' ('EXISTE' PRECED 'AMORTISSEMENT' );                          
          WTAB.'AMORTISSEMENT'  =   'EXTR'  PRECED.'AMORTISSEMENT'      
                                       'RIGI' 'NOMU' ;                  
      'FINSI';                                                          
'FINSI';                                                                
'SI' ( 'EXISTE' PRECED 'LIAISON_PERSISTANTE' ) ;                        
    WTAB.'LIAISON_PERSISTANTE' = PRECED.'LIAISON_PERSISTANTE';          
'FINSI';                                                                
                                                                        
'SI' ('EXISTE' PRECED 'CONSOLIDATION')  ;                               
    WTAB.'CONSOLIDATION' =  PRECED.'CONSOLIDATION'  ;                   
'FINSI';                                                                
'SI' WTAB.'POR1';                                                       
   'SI' (WTAB.'CONSOLIDATION');                                         
       'SI' ('NON' ('EXISTE' PRECED 'PERMEABILITE'));                   
          'ERREUR' 'Il faut donner la matrice de permeabilite';         
        'SINON';                                                        
           WTAB.'PERMEABILITE'=PRECED.'PERMEABILITE';                   
       'FINSI';                                                         
       'SI' (  'EXISTE' PRECED 'TETA' ) ;                               
          WTAB.'TETA' = PRECED.'TETA';                                  
       'FINSI';                                                         
       'SI' ( WTAB.'DYNAMIQUE' );                                       
          'ERREUR' ' On ne peut pas etre en dynamique.' ;               
       'FINSI';                                                         
   'FINSI';                                                             
'FINSI';                                                                
                                                                        
'SI' ( 'EXISTE' PRECED 'CONVERGENCE_FORCEE');                           
   WTAB.'CONVERGENCE_FORCEE'= PRECED.'CONVERGENCE_FORCEE';              
'SINON';                                                                
    'SI' ( 'NON'  WTAB.'AUTOMATIQUE');                                  
        WTAB.'CONVERGENCE_FORCEE' = VRAI;                               
    'FINSI';                                                            
'FINSI';                                                                
                                                                        
'SI' ( 'EXISTE' PRECED 'PREDICTEUR');                                   
   WTAB.'PREDICTEUR'= 'MOT' PRECED.'PREDICTEUR';                        
'FINSI';                                                                
                                                                        
'SI' ( 'EXISTE' PRECED 'STABILITE');                                    
 'SI' ('EGA' PRECED.'STABILITE' VRAI);                                  
   WTAB.'STABILITE'= VRAI;                                              
 'SINON';                                                               
   WTAB.'STABILITE'= FAUX;                                              
 'FINSI';                                                               
'FINSI';                                                                
                                                                        
'SI' ( 'EXISTE' PRECED 'LINESEARCH');                                   
 'SI' ('EGA' PRECED.'LINESEARCH' VRAI);                                 
   WTAB.'LINESEARCH'= VRAI;                                             
   WTAB.'GRANDS_DEPLACEMENTS' = VRAI;                                   
 'SINON';                                                               
   WTAB.'LINESEARCH'= FAUX;                                             
 'FINSI';                                                               
'FINSI';                                                                
                                                                        
'SI' ( 'EXISTE' PRECED 'INITIALISATION');                               
   WTAB.'INITIALISATION'= PRECED . 'INITIALISATION';                    
'FINSI';                                                                
'SI' ( 'EXISTE' PRECED 'RENORMALISATION');                              
   WTAB.'RENORMALISATION' = PRECED . 'RENORMALISATION';                 
'FINSI';                                                                
'SI' ( 'EXISTE' PRECED 'CONVERGENCE_MONOTONE');                         
   WTAB.'CONVERGENCE_MONOTONE' = PRECED . 'CONVERGENCE_MONOTONE';       
'FINSI';                                                                
                                                                        
                                                                        
'SI' (WTAB.'CONVERGENCE_FORCEE' 'OU' WTAB.'RENORMALISATION');           
    WTAB.'MAXITERATION' = 250;                                          
   'SI' ('EXISTE' PRECED 'MAXDEFOR');                                   
        WTAB.'MAXDEFOR'=PRECED.'MAXDEFOR' ;                             
   'FINSI';                                                             
   'SI' WTAB.'CONVERGENCE_FORCEE';                                      
      'SI' ('EXISTE' PRECED 'RELAXATION_NONCONV');                      
           WTAB.'RELAXATION_NONCONV'=PRECED.'RELAXATION_NONCONV' ;      
      'FINSI';                                                          
   'FINSI';                                                             
'FINSI';                                                                
                                                                        
                                                                        
'SI'  ('EXISTE' PRECED 'CONVERGENCE_MEC_THE');                          
   WTAB.'CONVERGENCE_MEC_THE'=PRECED.'CONVERGENCE_MEC_THE';             
'FINSI';                                                                
'SI' WTAB.'CONVERGENCE_MEC_THE';                                        
   WTAB.'AUTOMATIQUE'=FAUX;                                             
   WTAB.'CONVERGENCE_FORCEE' =FAUX;                                     
   'SI'(WTAB.'PAS_AJUSTE');                                             
   'ERREUR'  'Options CONVERGENCE_MEC_THE et PAS_AJUSTE incompatibles'; 
   'FINSI';                                                             
   'SI' ('EXISTE' PRECED 'CRITERE_COHERENCE') ;                         
     WTAB.'CRITERE_COHERENCE'=PRECED.'CRITERE_COHERENCE' ;              
   'SINO' ;                                                             
     'SI' ('EXISTE' PRECED 'PRECISION') ;                               
       WTAB.'CRITERE_COHERENCE' = PRECED.'PRECISION' ;                  
     'SINO' ;                                                           
       WTAB.'CRITERE_COHERENCE' = WTAB.'PRECISION' ;                    
     'FINS' ;                                                           
   'FINSI' ;                                                            
   'SI' ('EXISTE' PRECED 'PROCEDURE_CONV') ;                            
      WTAB.'PROCEDURE_CONV'=PRECED.'PROCEDURE_CONV' ;                   
   'FINSI' ;                                                            
   'SI' ('EXISTE' PRECED 'NB_BOTH');                                    
     WTAB.'BOU_METH'=PRECED.'NB_BOTH';                                  
   'SINON';                                                             
     WTAB.'BOU_METH'=10;                                                
   'FINSI';                                                             
'FINSI';                                                                
                                                                        
'SI' ('EXISTE' PRECED 'PROCEDURE_REAC_MECA');                           
    WTAB.'PROCEDURE_REAC_MECA'=PRECED.'PROCEDURE_REAC_MECA' ;           
'FINSI' ;                                                               
'SI' ('EXISTE' PRECED 'PROCEDURE_REAC_THER');                           
    WTAB.'PROCEDURE_REAC_THER' =PRECED.'PROCEDURE_REAC_THER' ;          
'FINSI' ;                                                               
                                                                        
'SI' ( 'EXISTE' PRECED 'MAXSOUSPAS');                                   
   WTAB.'MAXSOUSPAS' = PRECED.'MAXSOUSPAS' ;                            
'FINSI';                                                                
                                                                        
'SI' ( 'EXISTE' PRECED 'MAXITERATION') ;                                
   WTAB. 'MAXITERATION' = PRECED.'MAXITERATION';                        
'SINON';                                                                
   'SI'  WTAB.'AUTOMATIQUE' ;WTAB.'MAXITERATION' = 250;'FINSI';         
   'SI' WTAB.'PAS_AJUSTE' ;  WTAB.'MAXITERATION'=250;'FINSI';           
'FINSI';                                                                
'SI' ('EXIS' PRECED 'SOUS-INCREMENT' );                                 
      WTAB.'SOUS-INCREMENT'=PRECED.'SOUS-INCREMENT';                    
'FINSI';                                                                
                                                                        
'SI' ('EXIS' PRECED 'BLOCAGES_MECANIQUES');                             
    WTAB.'BLOCAGES_MECANIQUES'= PRECED.'BLOCAGES_MECANIQUES';           
'SINON';                                                                
    WTAB.'BLOCAGES_MECANIQUES'= 'VIDE' 'RIGIDITE'/'RIGIDITE';           
'FINSI';                                                                
'SI' ('EXIS' PRECED 'REAC_GRANDS');                                     
  'SI' ('EGA' ('TYPE' PRECED . 'REAC_GRANDS') 'FLOTTANT') ;             
     WTAB.'REAC_GRANDS' = PRECED.'REAC_GRANDS';                         
  'FINSI';                                                              
'FINSI';                                                                
                                                                        
                                                                        
'SI' ( 'EXISTE' PRECED 'TEMPS_SAUVES' );                                
   WTAB.'IPRESU'=PRECED.'TEMPS_SAUVES';                                 
'SINON';                                                                
   WTAB.'IPRESU'= WTAB.'TEMPS_CALCULES';                                
'FINSI';                                                                
WTAB.'IPTIME'= WTAB.'TEMPS_CALCULES';                                   
'SI' ( 'EXISTE' PRECED 'TEMPS_SAUVEGARDES');                            
   WTAB.'ISAUVEGL'=VRAI; WTAB.'ISAUVEGA'=PRECED.'TEMPS_SAUVEGARDES';    
'FINSI';                                                                
'SI' ( 'EXISTE' PRECED 'ECONOMIQUE');                                   
    WTAB.'LECONOMI'=PRECED. 'ECONOMIQUE';                               
'FINSI';                                                                
                                                                        
'SI' ( 'EXIS' PRECED 'MES_SAUVEGARDES');                                
    TABSAUV = PRECED .'MES_SAUVEGARDES';                                
    WTAB.'TABSAUV' = TABSAUV ;                                          
   'SI' ('NON' ( 'EXIS' TABSAUV 'DEFIN'));                              
      WTAB.'TABSAUV'.'DEFIN' = FAUX;                                    
   'FINSI';                                                             
   'SI' ('NON' ( 'EXIS' TABSAUV 'DEFTO'));                              
      WTAB.'TABSAUV'.'DEFTO' = FAUX;                                    
   'FINSI';                                                             
'SINON';                                                                
    WTAB.'TABSAUV'=TABLE ;                                              
    WTAB.'TABSAUV'.'DEFIN' = FAUX;                                      
    WTAB.'TABSAUV'.'DEFTO' = FAUX;                                      
'FINSI';                                                                
LOGERR1= 'DANS' 'QUEL' wtab.'IPRESU' wtab.'IPTIME';LOGERR2=VRAI;        
'SI' WTAB.'ISAUVEGL';                                                   
   LOGERR2= 'DANS' 'QUEL' WTAB.'ISAUVEGA' wtab.'IPTIME';                
'FINSI';                                                                
'SI' ('NON' ( LOGERR1 'ET' LOGERR2));                                   
  'ERRE' 1013;                                                          
'FINSI';                                                                
                                                                        
'SI' ('EXISTE' PRECED 'PRECISION') ;                                    
  WTAB.'PRECISION' = PRECED.'PRECISION' ;                               
'FINS' ;                                                                
'SI' ('EXISTE' PRECED 'PROCEDURE_PERSO1');                              
   WTAB.'PROCEDURE_PERSO1'=PRECED.'PROCEDURE_PERSO1';                   
'FINSI';                                                                
'SI' ('EXISTE' PRECED 'PROCEDURE_PERSO2');                              
   WTAB.'PROCEDURE_PERSO2'=PRECED.'PROCEDURE_PERSO2' ;                  
'FINSI';                                                                
'SI' WTAB.'FOR_THER' ;                                                  
  'SI'  WTAB.'RAYO' ;                                                   
      'SI' ('NON' ('EXISTE' (PRECED.'CARACTERISTIQUES') 'EMIS'));       
         'ERREUR' ' Il manque la donnee des facteurs d emissivite';     
      'FINSI';                                                          
      'SI'('EXISTE' PRECED 'CTE_STEFAN_BOLTZMANN') ;                    
        WTAB.'CTE_STEFAN_BOLTZMANN'=PRECED.'CTE_STEFAN_BOLTZMANN';      
        'SAUT' 1 'LIGN' ;                                               
        'MESS' 'ATTENTION ! Constante de Stefan-Boltzmann en unitÈs SI';
        'MESS' '            soit ' (WTAB . 'CTE_STEFAN_BOLTZMANN') ;    
      'FINSI' ;                                                         
   'FINSI';                                                             
   'SI'  WTAB.'PHASE';                                                  
      'SI' ('NON' ('EXISTE' (PRECED.'CARACTERISTIQUES') 'QLAT'));       
         'ERREUR' 'Il manque la donnÈe de la chaleur latente QLAT';     
      'FINSI';                                                          
      'SI' ('NON' ('EXISTE' (PRECED.'CARACTERISTIQUES') 'TPHA'));       
         'ERREUR' 'Il manque la donnÈe de la temperature TPHA';         
      'FINSI';                                                          
   'FINSI';                                                             
   'SI' ('EXIS'  PRECED  'RELAXATION_THETA' );                          
        WTAB. 'RELAXATION_THETA'=PRECED. 'RELAXATION_THETA' ;           
   'FINSI';                                                             
   'SI' ('EXIS'  PRECED  'RELAXATION_DUPONT');                          
       WTAB.'RELAXATION_DUPONT'=  PRECED . 'RELAXATION_DUPONT' ;        
   'FINSI';                                                             
'FINSI';                                                                
'SI' WTAB.'FOR_DIFF' ;                                                  
   'SI' ('EXIS'  PRECED  'RELAXATION_THETA' );                          
        WTAB. 'RELAXATION_THETA'=PRECED. 'RELAXATION_THETA' ;           
   'FINSI';                                                             
'FINSI';                                                                
'SI' WTAB.'FOR_MECA' ;                                                  
   'SI' ('EXISTE' PRECED 'PRECISION') ;                                 
      WTAB.'PRECFLEX'  = PRECED.'PRECISION' ;                           
   'FINSI';                                                             
   'SI' ('EXISTE' PRECED 'PRECFLEX') ;                                  
      WTAB.'PRECFLEX' = PRECED.'PRECFLEX';                              
   'FINSI';                                                             
   'SI' ('EXISTE' PRECED 'PRECDECHARGE') ;                              
      WTAB.'PRECDECHARGE' = PRECED.'PRECDECHARGE' ;                     
   'FINSI';                                                             
                                                                        
   'SI' (  'EXISTE' PRECED 'K_TANGENT');                                
      WTAB.'K_TANGENT' = PRECED.'K_TANGENT';                            
   'FINSI';                                                             
   'SI' ('EXISTE' PRECED 'K_TANGENT_PERT') ;                            
      WTAB.'K_TANGENT_PERT' = PRECED.'K_TANGENT_PERT' ;                 
      'SI' WTAB.'K_TANGENT_PERT' ;                                      
         WTAB.'K_TANGENT' = VRAI ;                                      
      'FINSI' ;                                                         
   'FINSI' ;                                                            
   'SI' ('EXISTE' PRECED 'K_TANG_PERT_C1') ;                            
      WTAB.'K_TANG_PERT_C1' = PRECED.'K_TANG_PERT_C1' ;                 
   'FINSI' ;                                                            
   'SI' ('EXISTE' PRECED 'K_TANG_PERT_C2') ;                            
      WTAB.'K_TANG_PERT_C2' = PRECED.'K_TANG_PERT_C2' ;                 
   'FINSI' ;                                                            
   'SI' ('EGA' WTAB.'K_TANG_PERT_C2' 'INCONNU') ;                       
      WTAB.'K_TANG_PERT_C2' = WTAB.'K_TANG_PERT_C1' / 1.D+02 ;          
   'FINSI' ;                                                            
   'SI' ('EXISTE' PRECED 'K_TANGENT_ITER0') ;                           
      WTAB.'K_TANGENT_ITER0' = PRECED.'K_TANGENT_ITER0' ;               
   'FINSI' ;                                                            
   'SI' ('EXISTE' PRECED 'K_TANGENT_SYME') ;                            
      WTAB.'K_TANGENT_SYME' = PRECED.'K_TANGENT_SYME' ;                 
   'FINSI' ;                                                            
   'SI' (  'EXISTE' PRECED 'NITER_KTANGENT');                           
      WTAB.'NITER_KTANGENT' =PRECED.'NITER_KTANGENT' ;                  
   'FINSI';                                                             
   'SI' (  'EXISTE' PRECED 'SUBSTEPPING');                              
      WTAB.'SUBSTEPPING'=PRECED.'SUBSTEPPING' ;                         
   'FINSI';                                                             
   'SI' (  'EXISTE' PRECED 'PRECISINTER');                              
      WTAB.'PRECISINTER' = PRECED.'PRECISINTER';                        
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'NITERINTER_MAX');                            
      WTAB.'NITERINTER_MAX' =PRECED.'NITERINTER_MAX';                   
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED  'NMAXSUBSTEPS');                             
      WTAB.'NMAXSUBSTEPS'=PRECED.'NMAXSUBSTEPS';                        
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'GRANDS_DEPLACEMENTS' );                      
      'SI' (WTAB.'CONTACT' et (non PRECED.'GRANDS_DEPLACEMENTS'));      
        MESS 'Un calcul avec un modele de CONTACT doit necessairement'  
        MESS 'etre realise en GRANDS_DEPLACEMENTS !';                   
        MESS 'Arret de pasapas'; ERRE 21;                               
      'FINSI';                                                          
      WTAB.'GRANDS_DEPLACEMENTS' = PRECED.'GRANDS_DEPLACEMENTS';        
      'SI'  (WTAB.'GRANDS_DEPLACEMENTS');                               
        WTAB.'K_SIGMA'=VRAI;                                            
        'SI' ('NON' ('EXIS' PRECED 'MES_SAUVEGARDES'));                 
          WTAB.'TABSAUV'.'DEFTO'= VRAI ;                                
        'FINS' ;                                                        
      'FINSI';                                                          
   'FINSI';                                                             
   'SI' (  'EXISTE' PRECED 'K_SIGMA');                                  
      WTAB.'K_SIGMA' = PRECED.'K_SIGMA';                                
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'MAN' );                                      
      WTAB.'MAN'= PRECED.'MAN';                                         
    'SINON';                                                            
      WTAB.'MAN'=FAUX;                                                  
    'FINSI';                                                            
    'SI' (WTAB.'MEC1' 'ET' WTAB.'POR1') ;                               
      MO_TOT = WTAB.'MOD_MEC' 'ET' WTAB.'MOD_POR';                      
    'SINON';                                                            
      'SI' WTAB.'MEC1';                                                 
         MO_TOT = WTAB.'MOD_MEC';                                       
      'FINSI';                                                          
      'SI' WTAB.'POR1';                                                 
         MO_TOT = WTAB.'MOD_POR';                                       
      'FINSI';                                                          
    'FINSI';                                                            
   'SI' ('EXISTE' WTAB 'MOD_LIA') ;                                     
       MO_TOT = MO_TOT 'ET' WTAB.'MOD_LIA';                             
   'FINSI' ;                                                            
   'SI' ('EXISTE' MO_TOT 'MATE' 'PLASTIQUE');                           
      WTAB.'PLASTIQUE' = VRAI; WTAB.'IPLAVI'=VRAI;                      
   'FINSI';                                                             
   'SI' ('EXISTE' MO_TOT 'MATE' 'PLASTIQUE_ENDOM');                     
      WTAB.'PLASTIQUE' = VRAI;       WTAB.'IPLAVI'=VRAI;                
      WTAB.'ENDOMMAGEMENT' = VRAI ;                                     
   'FINSI';                                                             
   'SI' (('EXISTE' MO_TOT 'MATE' 'VISCOPLASTIQUE') 'OU'                 
        ('EXISTE' MO_TOT 'MATE' 'FLUAGE' ));                            
      WTAB.'VISCOPLASTIQUE' = VRAI;  WTAB.'IPLAVI'=VRAI;                
   'FINSI';                                                             
   'SI' ('EXISTE' MO_TOT 'MATE' 'VISCODOMMAGE');                        
      WTAB.'VISCODOMMAGE'=VRAI; WTAB.'IPLAVI'=VRAI;                     
   'FINSI';                                                             
   'SI' (('EXISTE' MO_TOT 'MATE' 'ENDOMMAGEMENT') 'OU'                  
        ('EXISTE' MO_TOT 'MATE' 'ENDOMMAGEABLE'));                      
      WTAB.'ENDOMMAGEMENT'=VRAI;  WTAB.'IPLAVI'=VRAI;                   
   'FINSI';                                                             
   'SI' ('EXISTE' MO_TOT 'MATE' 'NON_LINEAIRE') ;                       
      WTAB.'NON_LINEAIRE'=VRAI;   WTAB.'IPLAVI'=VRAI;                   
      NOLIUTIL = 'EXISTE' MO_TOT 'MATE' 'UTILISATEUR' ;                 
   'FINSI';                                                             
   'SI' ('EXISTE' MO_TOT 'MATE' 'VISCO_EXTERNE') ;                      
      WTAB.'VISCO_EXTERNE'=VRAI;   WTAB.'IPLAVI'=VRAI;                  
   'FINSI';                                                             
  'SI' ('EXISTE' MO_TOT 'MATE' 'CERAMIQUE');                            
      WTAB.'CERAMIQUE' = VRAI;  WTAB.'IPLAVI'=VRAI;                     
   'FINSI';                                                             
   'SI' (('EXISTE' MO_TOT 'MATE' 'MODAL') 'OU'                          
             ('EXISTE' MO_TOT 'MATE' 'STATIQUE' ));                     
      WTAB.'MODAL' = VRAI;  WTAB.'IPLAVI'=VRAI;                         
  'FINSI';                                                              
   'SI' ('EXISTE' MO_TOT 'MATE' 'IMPEDANCE');                           
      WTAB.'IMPEDANCE' = VRAI;  WTAB.'IPLAVI'=VRAI;                     
  'FINSI';                                                              
                                                                        
   WTAB.'MO_TOT' = MO_TOT;                                              
   MAI_TOT = 'EXTR' MO_TOT 'MAIL';                                      
   WTAB.'MA_TOT' = 'REDU' MA MO_TOT;                                    
   WTAB.'LDEVA' = 'EXTR' WTAB.'MA_TOT' 'DEVA';                          
   WTAB.'LPAR0' = 'EXTR' MO_TOT 'PARA';                                 
   'SI' ('NEG' 0 ('DIME'  WTAB.'LPAR0'));WTAB.'PARA_EXTE'=VRAI;'FINSI'; 
                                                                        
   'SI' (  'EXISTE' PRECED 'FEFP_FORMULATION'  );                       
      WTAB.'FEFP_FORMULATION' = PRECED.'FEFP_FORMULATION';              
   'FINSI';                                                             
   'SI' WTAB.'FEFP_FORMULATION';                                        
      'MESS' ' *** FORMULACION FeFp ***' ;                              
      WTAB.'GRANDS_DEPLACEMENTS'  = FAUX;                               
      WTAB.'K_SIGMA'              = VRAI;                               
      WTAB.'K_TANGENT'            = VRAI;                               
      WTAB.'SUBSTEPPING'          = FAUX;                               
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'UPDATE_LAGRANGIAN'  );                       
      WTAB.'UPDATE_LAGRANGIAN' = PRECED.'UPDATE_LAGRANGIAN' ;           
   'FINSI';                                                             
   'SI' WTAB.'UPDATE_LAGRANGIAN';                                       
      'MESS' ' *** UPDATE LAGRANGIAN ***' ;                             
   'FINSI';                                                             
   'SI' ( 'EXISTE'  PRECED 'AUTORESU');                                 
      WTAB.'NAURES' = PRECED . 'AUTORESU';                              
   'FINSI';                                                             
   'SI'  WTAB . 'AUTOMATIQUE' ;                                         
       'SI' (  'EXISTE' PRECED 'AUTOCRIT');                             
           WTAB.'AUTOCRIT'= PRECED.'AUTOCRIT';                          
       'FINSI';                                                         
       'SI' ( 'EXISTE' PRECED 'AUTOPAS');                               
           WTAB.'AUTOPAS'= PRECED.'AUTOPAS';                            
       'FINSI';                                                         
       WTAB.'DELTAITER'=WTAB.'MAXITERATION';                            
    'FINSI';                                                            
   'SI' (  'EXISTE' PRECED 'MOVA');                                     
      WTAB.'MOVA' =PRECED.'MOVA';                                       
   'SINON';                                                             
    'SI'( WTAB.'VISCO_EXTERNE'  'OU' NOLIUTIL);                         
         WTAB.MOVA = 'MOT' 'RIEN';                                      
    'FINSI';                                                            
     'SI' ('NON' ('EXISTE' ('EXTR' WTAB.'MO_TOTAL' 'VARI') 'EPSE'));    
         WTAB.'MOVA' = 'MOT' 'RIEN';                                    
     'FINSI'  ;                                                         
                                                                        
   'FINSI';                                                             
  'SI' ( 'EXISTE' PRECED 'ORDRE');                                      
       WTAB.'ORDRE'=PRECED.'ORDRE';                                     
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'RIGIDITE_CONSTANTE');                        
       WTAB.'RAIDCONST' =VRAI;                                          
       WTAB.'RIGIDITE_CONSTANTE'=PRECED.'RIGIDITE_CONSTANTE';           
       RR= PRECED.'RIGIDITE_CONSTANTE';                                 
       MNOMU = ('EXTR' RR 'MAILLAGE' 'NOMU') 'NBNO';                    
       MAVMU = ('EXTR' RR 'MAILLAGE' ) 'NBNO';                          
       'SI' ( MNOMU 'NEG' MAVMU) ;                                      
           'ERREUR'                                                     
        'Il ne faut pas de multiplicateur dans RIGIDITE_CONSTANTE';     
       'FINSI';                                                         
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'MASSE_CONSTANTE');                           
       WTAB.'MASSE_CONSTANTE'=PRECED.'MASSE_CONSTANTE';                 
       WTAB.'MASSCONST'=VRAI;                                           
   'FINSI';                                                             
   'SI' ( 'EXISTE' PRECED 'SOUS_INCREMENT');                            
       WTAB.'SOUS_INCREMENT'=PRECED.'SOUS_INCREMENT';                   
   'FINSI';                                                             
   'SI'  ('EXISTE' PRECED 'NON_LOCAL'  );                               
          WTAB.'NLOC' = VRAI ;                                          
          WTAB.'NON_LOCAL' = PRECED.'NON_LOCAL';                        
   'FINSI';                                                             
   'SI' WTAB.'NLOC' ;                                                   
      'SI' (('NEG' WTAB.'NON_LOCAL' 'MOYE') 'ET'                        
            ('NEG' WTAB.'NON_LOCAL' 'SB'  )) ;                          
        'ERREUR' 'Methode NON LOCALE non implementee ' WTAB.'NON_LOCAL';
      'FINSI' ;                                                         
      'SI' ( 'EXISTE'  PRECED 'CONN' );                                 
          'MESS' 'On garde les connectivites dans TAB CONN';            
          WTAB.'CONN'=PRECED . 'CONN' ;                                 
      'SINON';                                                          
          'SI' ( 'EXISTE'  PRECED 'LCAR' );                             
             'MESS' 'Calcul des connectivites en mode normal.';         
             WTAB.CONN='CONN' MO_TOT PRECED.LCAR 'NORMAL';              
          'SINON';                                                      
             'ERREUR' 'Il faut donner LCAR ou CONN en NON_LOCAL';       
          'FINSI';                                                      
      'FINSI';                                                          
      'SI'( 'NON' ('EXISTE' PRECED 'LVIAM'));                           
 'ERREUR' 'Il faut donner la liste des variables internes a moyenner';  
      'SINON';                                                          
        WTAB.'LVIAM'= PRECED.'LVIAM';                                   
      'FINSI';                                                          
      'SI' ('EGA' WTAB.'NON_LOCAL' 'SB  ') ;                            
        'SI' ('NON' ('EXISTE' PRECED 'NLOC_SB_MODL')) ;                 
          'ERREUR' 'Il faut donner le modele a regulariser' ;           
        'FINS' ;                                                        
        'SI' ('NON' ('EXISTE' PRECED 'NLOC_SB_FT')) ;                   
 'ERREUR' 'Il faut donner la contrainte limite en traction pour normer';
        'FINS' ;                                                        
        WTAB.'NLOC_SB_MODL' = PRECED.'NLOC_SB_MODL' ;                   
        MOD_SB = WTAB.'NLOC_SB_MODL' ;                                  
        CHM_1 = 'MANU' 'CHML' MOD_SB 'LONG' 1.0 'STRESSES' ;            
        CHM_L = 'INTG' 'ELEM' MOD_SB CHM_1 'LONG' ;                     
        CHM_L = 'CHAN' 'COMP' 'LONG' CHM_L ;                            
        CHM_L = 'CHAN' 'STRESSES' MOD_SB CHM_L ;                        
        TAIL1 = CHM_L ** (1. / ('VALE' 'DIME')) ;                       
        FTCH  = PRECED.'NLOC_SB_FT' ;                                   
        'SI' (('EGA' ('TYPE' FTCH) 'FLOTTANT') 'OU'                     
              ('EGA' ('TYPE' FTCH) 'ENTIER  ')) ;                       
          FTCH = 'MANU' 'CHML' MOD_SB 'FT  ' FTCH 'STRESSES' ;          
        'SINON' ;                                                       
          'SI' ('NEG' ('TYPE' FTCH) 'MCHAML  ') ;                       
            'ERREUR' 'Indice NLOC_SB_FT de type incorrect' ;            
          'FINS' ;                                                      
          FTCH  = 'CHAN' 'COMP' 'FT  ' ('REDU' MOD_SB FTCH) ;           
        'FINSI' ;                                                       
        WTAB.'NLOC_SB_REGU' = FTCH '+' TAIL1;                           
        WTAB.'NLOC_SB_CCS' = 'MOTS' 'EPTI' 'SI11' 'SI22' 'SI33'         
                                    'COX1' 'COY1' 'COZ1'                
                                    'COX2' 'COY2' 'COZ2'                
                                    'COX3' 'COY3' 'COZ3'                
                                    'FT  ' 'LONG' ;                     
      'FINS' ;                                                          
   'FINSI';                                                             
   'SI' WTAB.'GRANDS_DEPLACEMENTS' ;                                    
       MOCA = 'MOTS' 'VECT' 'VX  ' 'VY  ' 'VZ  ' 'VXF ' 'VYF ' 'VZF '   
                     'V1X ' 'V1Y ' 'V1Z ' 'V2X ' 'V2Y ' 'V2Z ';         
       'REPETER' BOU_CAR ('DIME' MOCA);                                 
          ITE2 = &BOU_CAR;                                              
          MOT1 = 'EXTR' MOCA ITE2;                                      
          'SI' ('EXIS' WTAB.'MA_TOT' MOT1);                             
             WTAB.'ITCAR' = VRAI;                                       
             'QUITTER' BOU_CAR;                                         
          'FINSI';                                                      
       'FIN' BOU_CAR;                                                   
   'FINSI';                                                             
   'SI'( WTAB.'GRANDS_DEPLACEMENTS' 'OU'  WTAB.'FEFP_FORMULATION');     
       WTAB.'RECALCUL'= VRAI ;                                          
   'FINSI';                                                             
   'SI' ('EXIS'  MO_TOT  'MATE' 'MISTRAL');                             
     'SI' ('NON' ('EXISTE' (WTAB.'CHARGEMENT') 'FI  ')) ;               
      FIZER='MANU' 'CHPO' MAI_TOT 1 'FI  ' 0. 'NATURE' 'DIFFUS' ;       
      WTAB.'CHARGEMENT'= WTAB.'CHARGEMENT' 'ET' ('CHAR' 'FI' FIZER      
      ('EVOL' 'MANU'  ('PROG' 0. 10.e10 ) ('PROG' 1. 1.)));             
     'FINSI';                                                           
   'FINSI';                                                             
   'SI' (('EXIS'  MO_TOT  'MATE' 'UO2') 'OU'                            
         ('EXIS'  MO_TOT  'MATE' 'GATT_MONERIE') ) ;                    
      'SI' ('NON' ('EXISTE' (WTAB.'CHARGEMENT') 'DFIS')) ;              
     DFISZER='MANU' 'CHPO'  MAI_TOT 1 'DFIS' 0. 'NATURE' 'DIFFUS' ;     
      WTAB.'CHARGEMENT'= WTAB.'CHARGEMENT' 'ET' ('CHAR' 'DFIS' DFISZER  
         ('EVOL' 'MANU'   ('PROG' 0. 10.e10 ) ('PROG' 1. 1.))) ;        
     'FINSI';                                                           
   'FINSI';                                                             
'FINSI';                                                                
WTAB.'CHARGEMENT_I'=WTAB.'CHARGEMENT';                                  
                                                                        
                                                                        
'SAUTER' 1 'LIGNE';                                                     
'SI' WTAB.'FOR_MECA' ;                                                  
   'SI' WTAB.'FOR_THER';                                                
       'MESS'  'Couplage THERMIQUE-MECANIQUE ';                         
   'SINON'   ;                                                          
       'MESS'   'Calcul MECANIQUE';                                     
   'FINSI';                                                             
   'SI' ('NEG' WTAB.'PREDICTEUR' 'INCONNU');                            
       'MESS'   ' *** Predicteur: ' wtab.'PREDICTEUR';                  
   'FINSI';                                                             
   'SI' WTAB.'K_SIGMA';                                                 
       'MESS'   ' *** K_SIGMA *** ';                                    
   'FINSI';                                                             
   'SI' WTAB.'STABILITE';                                               
       'MESS'   ' *** Verification stabilite *** ';                     
   'FINSI';                                                             
   'SI' WTAB.'LINESEARCH';                                              
       'MESS'   ' *** Linesearch  *** ';                                
   'FINSI';                                                             
   'SI' (non WTAB.'INITIALISATION');                                    
       'MESS'   ' *** Initialisation a partir du pas precedent'         
                ' interdite *** ';                                      
   'FINSI';                                                             
   'SI' (WTAB.'CONVERGENCE_MONOTONE');                                  
       'MESS'   ' *** Convergence monotone imposÈe *** ';               
   'FINSI';                                                             
   'SI' (WTAB.'RENORMALISATION');                                       
       'MESS'   ' *** Renormalisation des itÈrÈs *** ';                 
   'FINSI';                                                             
   'SI' WTAB.'POR1';                                                    
      'MESS' ' *** POREUX ***';                                         
   'FINSI';                                                             
   'SI'(WTAB.'DYNAMIQUE');                                              
      'MESSAGE' ' *** DYNAMIQUE PAS A PAS ***';                         
   'FINSI' ;                                                            
   'SI' (WTAB.'FREQUENTIEL') ;                                          
      'MESSAGE' ' *** FREQUENTIEL PAS A PAS ***' ;                      
   'FINSI' ;                                                            
   'SI'(WTAB.'LIAISON_PERSISTANTE');                                    
      'MESSAGE' ' *** LIAISON PERSISTANTE ***';                         
   'FINSI' ;                                                            
   'SI'(WTAB.'CONSOLIDATION');                                          
      'MESSAGE' ' *** CONSOLIDATION ***';                               
   'FINSI' ;                                                            
   'SI'(WTAB.'PLASTIQUE');                                              
     'MESSAGE' ' *** PLASTICITE ***';                                   
   'FINSI';                                                             
   'SI'(WTAB.'VISCOPLASTIQUE');                                         
      'MESSAGE' ' *** VISCO - PLASTICITE ***';                          
   'FINSI' ;                                                            
   'SI' WTAB.'NON_LINEAIRE';                                            
      'SI' NOLIUTIL;                                                    
         'MESS' ' *** MODELE DE COMPORTEMENT NON LINEAIRE EXTERNE ***'; 
      'SINON';                                                          
         'MESS' ' *** ELASTICITE NON_LINEAIRE ***';                     
      'FINSI';                                                          
   'FINSI' ;                                                            
   'SI' WTAB.'VISCO_EXTERNE';                                           
      'MESSAGE' ' *** VISCO - PLASTICITE, MODELE EXTERNE ***';          
   'FINSI' ;                                                            
   'SI' WTAB.'CHAR_THE';                                                
      'MESSAGE' ' *** CHARGEMENT THERMIQUE ***';                        
   'FINSI';                                                             
   'SI' WTAB.'CHAR_DEFI';                                               
      'MESSAGE' ' *** CHARGEMENT PAR DES DEFORMATIONS ***';             
   'FINSI';                                                             
   'SI' WTAB.'PARA_EXTE';                                               
      'MESSAGE' ' *** LE MODELE DEPEND DE PARAMETRES EXTERNES ***';     
   'FINSI';                                                             
   'SI'(WTAB.'GRANDS_DEPLACEMENTS');                                    
      'MESSAGE' ' *** GRANDS DEPLACEMENTS ***';                         
   'FINSI';                                                             
   'SI'(WTAB.'CONVERGENCE_FORCEE');                                     
      'MESSAGE' ' *** CONVERGENCE FORCEE   ***';                        
   'FINSI';                                                             
   'SI'(WTAB.'ENDOMMAGEMENT');                                          
      'MESSAGE' ' *** PLASTICITE + ENDOMMAGEMENT ***';                  
   'FINSI';                                                             
   'SI'(WTAB.'VISCODOMMAGE');                                           
      'MESSAGE' ' *** VISCO-PLASTICITE + ENDOMMAGEMENT ***';            
   'FINSI';                                                             
   'SI'(WTAB.'CERAMIQUE');                                              
      'MESSAGE' ' ***CERAMIQUE FLUAGE  + ENDOMMAGEMENT ***';            
      'MESSAGE' ' ***             +OTTOSEN             ***';            
   'FINSI';                                                             
   'SI' WTAB.'NLOC' ;                                                   
      'SI' ('EGA' WTAB.'NON_LOCAL' 'SB') ;                              
         'MESS' ' *** EN NON-LOCAL BASE SUR ETAT DE CONTRAINTE *** ' ;  
      'SINO' ;                                                          
         'MESS' ' *** EN NON-LOCAL *** ' ;                              
      'FINSI';                                                          
   'FINSI';                                                             
   'SI' WTAB.'CONTACT';                                                 
      'MESS' ' *** CONTACT ***';                                        
   'FINSI';                                                             
   'SI' (WTAB.'SOUS_INCREMENT' > 1);                                    
      'MESS'  ' *** SOUS_INCREMENT : ' WTAB.SOUS_INCREMENT;             
   'FINSI';                                                             
   'SI' WTAB.'CAFROTTE';                                                
      'MESS' ' *** FROTTEMENT ***';                                     
   'FINSI';                                                             
   'SI' WTAB.'K_TANGENT' ;                                              
     'SI' WTAB.'K_TANGENT_PERT' ;                                       
       'MESS' ' *** MATRICE TANGENTE PAR PERTURBATION ***' ;            
     'SINON' ;                                                          
       'MESS' ' *** MATRICE TANGENTE (COHERENTE) ***' ;                 
     'FINSI' ;                                                          
     'MESS' '     MATRICE EVALUEE TOUTES LES' WTAB.'NITER_KTANGENT'     
            'ITERATIONS' ;                                              
     'SI' WTAB.'K_TANGENT_SYME' ;                                       
       'MESS' '     PARTIE SYMETRIQUE DE LA MATRICE TANGENTE UTILISEE'; 
     'FINSI' ;                                                          
   'FINSI';                                                             
   'SI' WTAB.'SUBSTEPPING';                                             
     'MESSAGE' ' *** SUBSTEPPING *** NUM_MAXI_SUBSTEPS = '              
               WTAB.'NMAXSUBSTEPS' ;                                    
      'MESSAGE' ' *** SUBSTEPPING *** NUM_ITER_INTERNAS = '             
                WTAB.'NITERINTER_MAX' ;                                 
   'FINSI';                                                             
'SINON';                                                                
   'MESS' 'Calcul  THERMIQUE ';                                         
'FINSI';                                                                
NBPART='VALEUR' 'ASSI';                                                 
WTAB.'NBPART' = NBPART ;                                                
b_PARA = 0 ;                                                            
'SI' ( 'EGA' 'INCONNU' WTAB.'PROCESSEURS');                             
  'SI' (NBPART > 1);                                                    
    toutmo = 'EXTR' PRECED.'MODELE' 'ZONE' ;                            
    IMOD = ('DIME' toutmo) / 2 ;                                        
    MINELE=1000000; MAXELE=0;                                           
    'REPE' BOUCMO IMOD;                                                 
      BBB = 'NBEL' TOUTMO . ( &BOUCMO * 2);                             
      'SI' (MINELE > BBB); MINELE = BBB; 'FINSI';                       
      'SI' (MAXELE < BBB); MAXELE = BBB; 'FINSI';                       
    'FIN' BOUCMO ;                                                      
    MINELE=MINELE/NBPART;MAXELE=MAXELE/NBPART;                          
    NBELMIN = 1000; NBELMM=100 ;                                        
    'SI' (MINELE > NBELMIN) ;                                           
      b_PARA = 2 ;                                                      
    'SINON';                                                            
      'SI'( (MINELE > NBELMM) 'OU' (MAXELE > 500));                     
        b_PARA = 1 ;                                                    
      'FINSI';                                                          
    'FINSI';                                                            
  'FINSI';                                                              
'SINON' ;                                                               
  'SI' ( '>' NBPART 1) ;                                                
    'SI' ('EGA' WTAB.'PROCESSEURS' 'COMPORTEMENT');                     
      b_PARA = 1 ;                                                      
    'SINON';                                                            
      'SI' ('EGA' WTAB.'PROCESSEURS' 'AUTOMATIQUE');                    
        b_PARA = 2 ;                                                    
      'FINSI';                                                          
    'FINSI';                                                            
  'FINSI';                                                              
'FINSI';                                                                
'SAUTER' 1 'LIGNE';                                                     
'SI' ('EGA' b_PARA 0) ;                                                 
  WTAB.'PROCESSEURS' = 'MOT' 'MONO_PROCESSEUR' ;                        
  'MESS' ' *** Pas de parallelisation ***' ;                            
  'SINON' ;                                                             
  'SI' ('EGA' b_PARA 1) ;                                               
    'MESS' ' *** Parallelisation du comportement ***';                  
    WTAB.'PROCESSEURS' = 'MOT' 'COMPORTEMENT' ;                         
  'SINON' ;                                                             
    'SI' ('EGA' b_PARA 2) ;                                             
      WTAB.'PROCESSEURS' = 'MOT' 'AUTOMATIQUE' ;                        
      'MESS' ' *** Parallelisation automatique ***' ;                   
    'SINON' ;                                                           
      'MESS' ' *** Cas // non prevu' ; 'ERREUR' 5 ;                     
  'FINSI';                                                              
'FINSI';                                                                
'FINSI' ;                                                               
                                                                        
'SAUTER' 1 'LIGNE';                                                     
'FINPROC' ;                                                             
'DEBPROC' PAS_INIT   PRECED*'TABLE'  ;                                  
WTAB=PRECED.'WTABLE';TABSAUV=WTAB.'TABSAUV';                            
'SI' ( 'EXIS' PRECED 'CONTINUATION');                                   
   conti=PRECED.'CONTINUATION';inouv=faux;                              
   WTAB.'TEMPS0'=conti.'TEMPS';                                         
'SINON';                                                                
conti='TABLE';inouv=vrai;                                               
PRECED.'CONTINUATION'= CONTI;                                           
'FINSI';                                                                
'SI' ('EXIS' PRECED TEMPS) ;                                            
   NSOR= ('DIME' (PRECED . 'TEMPS' )) - 1;WTAB.'NSOR'=NSOR;             
   'SI' ('EXIS' conti 'TEMPS');                                         
      WTAB.'TEMPS0'=conti.'TEMPS';TEMP0=WTAB.'TEMPS0';                  
   'SINON';                                                             
     TEMP0=PRECED.'TEMPS' . NSOR;                                       
     WTAB.'TEMPS0'=TEMP0;                                               
   'FINSI';                                                             
'SINON';                                                                
   NSOR= 0;   PRECED.'TEMPS'='TABLE';                                   
      'SI' WTAB.'FREQUENTIEL' ;                                         
   TEMP0 = WTAB.'TEMPS0' ;                                              
      'SINON' ;                                                         
   TEMP0 = 0.D0 ;                                                       
      'FINSI' ;                                                         
   PRECED.'TEMPS' . 0 = TEMP0 ;                                         
   WTAB.'TEMPS0'=TEMP0;WTAB.'NSOR'=NSOR;                                
'FINSI';                                                                
conti.'TEMPS'=WTAB.'TEMPS0';                                            
'SI' WTAB.'FOR_MECA' ;                                                  
   MO_TOT=WTAB.'MO_TOT';                                                
  'SI' ('NON' ('EXIS' PRECED 'DEPLACEMENTS' ));                         
     DDDD = 'ZERO' MO_TOT 'DEPLACEM';                                   
     DEP_COUR = 'CHANGER' 'CHPO'  MO_TOT DDDD;                          
     'DETRUIRE' DDDD;                                                   
     PRECED.'DEPLACEMENTS' = 'TABLE';                                   
     PRECED.'DEPLACEMENTS'. 0 = DEP_COUR;                               
  'FINSI';                                                              
  'FORM' WTAB.'FOR0';                                                   
'SI' inouv; conti.'DEPLACEMENTS'= PRECED. 'DEPLACEMENTS' . NSOR;        
'FINS';                                                                 
  'SI' ('NON' ('EXIS' PRECED 'CONTRAINTES'));                           
      SIG_COUR = 'ZERO' MO_TOT 'CONTRAIN';                              
      PRECED.'CONTRAINTES' = 'TABLE';                                   
      PRECED.'CONTRAINTES'. 0 = SIG_COUR;                               
  'FINSI';                                                              
'SI' inouv; conti.'CONTRAINTES' = PRECED.'CONTRAINTES'.NSOR;'FINS';     
  'SI' (WTAB.'DYNAMIQUE' 'OU' ('EXISTE' WTAB 'MOD_LIA'));               
     'SI'  ('EXISTE' PRECED 'VITESSES')  ;                              
        TABINT=INDEX (PRECED.'VITESSES');                               
        IND0=TABINT.('DIME' TABINT);                                    
        VIT_COUR=PRECED.'VITESSES' . IND0;                              
     'SINON';                                                           
        DDDD = 'ZERO' MO_TOT 'DEPLACEMENTS';                            
        VIT_COUR = 'CHANGER' 'CHPO'  MO_TOT DDDD;                       
        'DETRUIRE' DDDD;                                                
        PRECED.'VITESSES'=TABLE;                                        
        PRECED.'VITESSES'. 0 = VIT_COUR;                                
     'FINSI';                                                           
'SI' inouv;  conti.'VITESSES'=VIT_COUR;'FINS';                          
  'FINSI';                                                              
  'SI' WTAB.'DYNAMIQUE';                                                
     'SI'  ('EXISTE' PRECED 'ACCELERATIONS') ;                          
        TABINT=INDEX (PRECED.'ACCELERATIONS') ;                         
        IND0=TABINT.('DIME' TABINT);                                    
        ACC_COUR=PRECED.'ACCELERATIONS' . IND0;                         
     'SINON';                                                           
        DDDD = 'ZERO' MO_TOT 'DEPLACEMENTS';                            
        ACC_COUR = 'CHANGER' 'CHPO'  MO_TOT DDDD;                       
        'DETRUIRE' DDDD;                                                
        PRECED.'ACCELERATIONS'=TABLE;                                   
        PRECED.'ACCELERATIONS'. 0 = ACC_COUR;                           
     'FINSI';                                                           
'SI' inouv;  conti.'ACCELERATIONS'=ACC_COUR;'FINS';                     
  'FINSI';                                                              
  'SI' ('NON' ('EXIS' PRECED 'REACTIONS'));                             
      'SI' ('EXIS' PRECED 'BLOCAGES_MECANIQUES');                       
     REA_COUR='REAC' PRECED.'BLOCAGES_MECANIQUES' conti.'DEPLACEMENTS'; 
      'SINON' ;                                                         
     REA_COUR = 'CHAN' 'CHPO' MO_TOT ('ZERO'  MO_TOT 'FORCES') ;        
      'FINSI' ;                                                         
     PRECED.'REACTIONS' = TABLE;                                        
     PRECED.'REACTIONS' . 0 = REA_COUR;                                 
  'FINSI';                                                              
'SI' inouv; conti.'REACTIONS'=PRECED.'REACTIONS'.NSOR;'FINS';           
  'SI' WTAB.'IPLAVI';                                                   
    'SI' ('EXIS' PRECED 'VARIABLES_INTERNES' );                         
       TABINT=INDEX (PRECED.'VARIABLES_INTERNES');                      
       IND0=TABINT.('DIME' TABINT) ;                                    
       VAR_COUR=PRECED.'VARIABLES_INTERNES' . IND0;                     
    'SINON';                                                            
       VAR_COUR = 'ZERO' MO_TOT 'VARINTER';                             
       PRECED.'VARIABLES_INTERNES' = 'TABLE';                           
       PRECED.'VARIABLES_INTERNES'. 0 = VAR_COUR;                       
    'FINSI';                                                            
'SI' inouv;    conti.'VARIABLES_INTERNES'=VAR_COUR;'FINS';              
  'FINSI';                                                              
  'SI' ('EXISTE' PRECED 'DEFORMATIONS_INELASTIQUES');                   
      TABINT=INDEX (PRECED.'DEFORMATIONS_INELASTIQUES');                
      IND0=TABINT.('DIME' TABINT);                                      
      DEI_COUR=PRECED.'DEFORMATIONS_INELASTIQUES' . IND0;               
  'SINON';                                                              
      DEI_COUR = 'ZERO' MO_TOT 'DEFINELA';                              
      'SI' ('EXIS' TABSAUV  'DEFIN');                                   
         'SI' TABSAUV.'DEFIN';                                          
            PRECED.'DEFORMATIONS_INELASTIQUES'='TABLE';                 
            PRECED.'DEFORMATIONS_INELASTIQUES' . 0=DEI_COUR;            
         'FINSI';                                                       
      'FINSI';                                                          
  'FINSI';                                                              
'SI' inouv;  conti.'DEFORMATIONS_INELASTIQUES'=DEI_COUR;'FINS';         
  'SI' ('EXISTE' PRECED 'DEFORMATIONS');                                
      TABINT=INDEX (PRECED.'DEFORMATIONS');                             
      IND0=TABINT.('DIME' TABINT);                                      
      DEF_COUR=PRECED.'DEFORMATIONS' . IND0;                            
  'SINON';                                                              
      DEF_COUR = 'ZERO' MO_TOT 'DEFORMATIONS';                          
      'SI' ('EXIS' TABSAUV  'DEFTO');                                   
         'SI' TABSAUV.'DEFTO';                                          
            PRECED.'DEFORMATIONS'='TABLE';                              
            PRECED.'DEFORMATIONS' . 0=DEF_COUR;                         
         'FINSI';                                                       
      'FINSI';                                                          
  'FINSI';                                                              
'SI' inouv;  conti.'DEFORMATIONS'=DEF_COUR;'FINS';                      
  WTAB.'DFGRAD' = 'MOT' 'INCONNU' ;                                     
  'SI' ( 'EXIS' WTAB.'CHARGEMENT' 'T');                                 
     WTAB.'TET1'= 'TIRE' WTAB.'CHARGEMENT' 'T' TEMP0;                   
     WTAB.'TET2' = WTAB . 'TET1';                                       
  'FINSI';                                                              
  'SI' WTAB.'CHAR_DEFI';                                                
        WTAB.'DEFOR1'='TIRE' WTAB.'CHARGEMENT' 'DEFI' WTAB.'TEMPS0';    
        WTAB.'DEFOR2'=WTAB.'DEFOR1';                                    
   'FINSI';                                                             
'FINSI';                                                                
'SI' WTAB.'FOR_THER';                                                   
  'SI' ('EXISTE' PRECED 'TEMPERATURES');                                
      TABINT=INDEX (PRECED.'TEMPERATURES');                             
      IND0=TABINT.('DIME' TABINT );                                     
      TH_COUR=PRECED.'TEMPERATURES' . IND0;                             
      'SI' (IND0 '>EG' 2) ;                                             
         WTAB.'TET0'=PRECED.'TEMPERATURES' . (IND0 - 2);                
      'FINSI';                                                          
   'SINON';                                                             
      DDDD = 'ZERO' WTAB.'MOD_T' 'TEMPERAT' ;                           
      TH_COUR = 'CHANGER' 'CHPO' WTAB.'MOD_T' DDDD;                     
      PRECED.'TEMPERATURES' = 'TABLE';                                  
      PRECED.'TEMPERATURES'. 0 = TH_COUR;                               
   'FINSI';                                                             
  'SI' INOUV ;                                                          
    CONTI.'TEMPERATURES' = TH_COUR;                                     
  'FINS';                                                               
   WTAB.'TET_INI'=PRECED.'TEMPERATURES'. 0;                             
   WTAB.'TET1'=TH_COUR; WTAB.'TET2'=TH_COUR;                            
   'SI' ('NON' ('EXIS' PRECED 'REACTIONS_THERMIQUES')) ;                
     'SI' ('EXIS' PRECED 'BLOCAGES_THERMIQUES') ;                       
       QTH_COUR = 'REAC' PRECED.'BLOCAGES_THERMIQUES' TH_COUR ;         
     'SINON' ;                                                          
       QTH_COUR = 'CHAN' 'CHPO' WTAB.'MOD_T'                            
         ('ZERO' WTAB.'MOD_T' 'FORCES') ;                               
     'FINSI' ;                                                          
     PRECED.'REACTIONS_THERMIQUES' = 'TABL' ;                           
      PRECED.'REACTIONS_THERMIQUES' . 0 = QTH_COUR ;                    
   'FINS' ;                                                             
   'SI' inouv;                                                          
     conti.'REACTIONS_THERMIQUES' = PRECED.'REACTIONS_THERMIQUES'.NSOR ;
   'FINS';                                                              
   'SI' WTAB.'PHASE';                                                   
      'SI' ( 'EXISTE' PRECED 'PROPORTIONS_PHASE');                      
         TABINT=INDEX (PRECED.'PROPORTIONS_PHASE');                     
         IND0=TABINT.('DIME' TABINT);                                   
         PP_COUR=PRECED.'PROPORTIONS_PHASE' . IND0;                     
      'SINON';                                                          
         DDDD= WTAB.'MAT_PHA' 'EXCO' TPHA;                              
         DDD = EXTRAI WTAB.'MAT_PHA' 'COVA';                            
         'SI' ( 'EXISTE' DDD 'TPHA');                                   
             DDDD = 'VARI' 'NUAG' WTAB.'MOD_PHA'                        
                    DDD  WTAB.'CHARGEMENT' 'NOEUD';                     
         'FINSI';                                                       
         DDD=('CHANG' DDDD WTAB.'MOD_PHA' 'NOEUD') 'NOMC' 'T';          
         XXXX = 'CHANG' 'CHAM' TH_COUR  WTAB.'MOD_PHA'                  
                 'NOEUD';XXXX = XXXX 'NOMC' 'T';                        
         PRECED.'PROPORTIONS_PHASE'='TABLE';                            
         PP_COUR=   (MASQUE DDD EGINFE XXXX)                            
                                   'NOMC' 'PPHA';                       
         PRECED.'PROPORTIONS_PHASE' . 0 =PP_COUR;                       
                                                                        
      'FINSI';                                                          
'SI' inouv;        conti.'PROPORTIONS_PHASE'=PP_COUR;'FINS';            
      WTAB.'PROPPHAS'=PP_COUR;                                          
   'FINSI';                                                             
'FINSI';                                                                
'SI' WTAB.'FOR_DIFF' ;                                                  
  'SI' ('EXIS' PRECED 'CONCENTRATIONS') ;                               
    TABIND0  = 'INDE' (PRECED.'CONCENTRATIONS') ;                       
    IND0     = TABIND0 . ('DIME' TABIND0) ;                             
    CHCO0    = PRECED. 'CONCENTRATIONS' . IND0 ;                        
  'SINO' ;                                                              
    CHCO0    = 'ZERO' WTAB. 'MOD_DIF' 'DEPLACEMENTS' ;                  
    CHCO0    = 'CHAN' 'CHPO' WTAB. 'MOD_DIF' CHCO0 ;                    
    PRECED.'CONCENTRATIONS'    = 'TABL' ;                               
    PRECED.'CONCENTRATIONS'. 0 = CHCO0 ;                                
  'FINS' ;                                                              
  'SI' INOUV ;                                                          
    CONTI . 'CONCENTRATIONS' = CHCO0 ;                                  
  'FINS' ;                                                              
  WTAB . 'CO1' = CHCO0 ; WTAB . 'CO2' = CHCO0 ;                         
  'SI' ('NON' ('EXIS' PRECED 'REACTIONS_DIFFUSIONS')) ;                 
    'SI' ('EXIS' PRECED 'BLOCAGES_DIFFUSIONS') ;                        
      QDI_COUR = 'REAC' PRECED.'BLOCAGES_DIFFUSIONS' CHCO0 ;            
    'SINON' ;                                                           
      QDI_COUR = 'CHAN' 'CHPO' WTAB.'MOD_T'                             
        ('ZERO' WTAB.'MOD_T' 'FORCES') ;                                
    'FINSI' ;                                                           
    PRECED.'REACTIONS_DIFFUSIONS'   = 'TABL' ;                          
    PRECED.'REACTIONS_DIFFUSIONS' . 0 = QDI_COUR ;                      
  'FINS' ;                                                              
  'SI' INOUV ;                                                          
    CONTI . 'REACTIONS_DIFFUSIONS' =                                    
      PRECED . 'REACTIONS_DIFFUSIONS'. NSOR ;                           
  'FINS' ;                                                              
'FINS' ;                                                                
    'SI'(WTAB.'CHAR_THE' 'OU' WTAB.'FOR_THER');                         
      'SI' WTAB.'FOR_MECA';WTAB.'ETHER1'=WTAB.'ETHER2';'FINSI';         
      'SI' WTAB.'POR1'; WTAB.'MSRTHER1'=WTAB.'MSRTHER2';'FINSI';        
    'FINSI';                                                            
    'SI' WTAB.'CHAR_DEFI' ;  WTAB.'DEFOR1'=WTAB.'DEFOR2';'FINSI';       
    'SI' WTAB.'FOR_DIFF' ; WTAB.'CO1'=WTAB.'CO2'; 'FINSI' ;             
PRECED.'ESTIMATION'='COPIER' conti;                                     
'FINPROC';                                                              
'DEBPROC' PAS_ETAT PRECED*'TABLE' TI*'FLOTTANT'   ;                     
                                                                        
                                                                        
WTAB = PRECED.'WTABLE';                                                 
                                                                        
MCH = 'VIDE' 'MCHAML';                                                  
                                                                        
IE = FAUX;                                                              
'SI' ('EXIS' WTAB 'CHARGEMENT');                                        
   MCH = MCH 'ADET' WTAB.'MO_TOTAL' WTAB.'CHARGEMENT' TI;               
'FINS';                                                                 
                                                                        
CONTI = PRECED. 'CONTINUATION';                                         
ESTIM = PRECED. 'ESTIMATION'  ;                                         
NCONT = 'DIME' CONTI            ;                                       
                                                                        
'SI' (NCONT NEG 0);                                                     
   IND   = 'INDEX' CONTI   ;                                            
   TCONV =  CONTI . 'TEMPS';                                            
   TCONT =  ESTIM . 'TEMPS';                                            
   IAD   =  FAUX           ;                                            
   IAC   =  FAUX           ;                                            
                                                                        
   'SI' ( 'NEG' TCONT TCONV);                                           
      XPRO  = (TI - TCONV)/ (TCONT - TCONV);                            
      UNXPRO= 1.d0 - XPRO;                                              
      IAD   = ('ABS' UNXPRO) '>' 1.E-10 ;                               
      IAC   = ('ABS' XPRO  ) '>' 1.E-10 ;                               
   'FINSI';                                                             
                                                                        
   'REPE' BOU NCONT;                                                    
      MO= 'MOT' IND . &BOU;                                             
      II='TEXT' ' ';                                                    
      'SI' ( 'EGA' MO 'TEMPS' ) ;                                       
         II= 'TEXT' MO;                                                 
      'FINSI';                                                          
      'SI' ( 'EGA' MO 'GEODEB')                   ; 'ITER' BOU; 'FINSI';
      'SI' ( 'EGA' MO 'GEOFIN')                   ; 'ITER' BOU; 'FINSI';
      'SI' ( 'EGA' MO 'REACTIONS')                ; 'ITER' BOU; 'FINSI';
      'SI' ( 'EGA' MO 'DEFORMATIONS_INELASTIQUES'); 'ITER' BOU; 'FINSI';
      'SI' ( 'EGA' MO 'DEFORMATIONS')             ; 'ITER' BOU; 'FINSI';
      'SI' ( 'EGA' MO 'VITESSES')                 ; 'ITER' BOU; 'FINSI';
      'SI' ( 'EGA' MO 'CARA_ACTU')                ; 'ITER' BOU; 'FINSI';
                                                                        
      'SI' IAD;                                                         
         VAD = CONTI. MO;                                               
         'SI' IAC ;                                                     
            VAD = (VAD * UNXPRO) + (ESTIM.MO * XPRO);                   
         'FINSI';                                                       
      'SINON' ;                                                         
         VAD = ESTIM. MO;                                               
      'FINSI';                                                          
                                                                        
      'SI' ( 'EGA' MO 'TEMPS' );                                        
         MCH = MCH 'ADET'        WTAB. 'MO_TOTAL'  MO VAD ;             
      'SINON';                                                          
         'SI' ( 'EGA' ( 'TYPE' VAD) ('MOT' 'MCHAML'));                  
            MCH=MCH 'ADET' WTAB.'MO_TOTAL' (REDU VAD WTAB.'MO_TOTAL');  
         'SINON';                                                       
            MCH=MCH 'ADET' WTAB.'MO_TOTAL'       VAD ;                  
         'FINSI';                                                       
      'FINSI';                                                          
   'FIN' BOU;                                                           
'FINSI';                                                                
                                                                        
'FINP' MCH;                                                             
'DEBPROC' PAS_VERM PRECED*'TABLE' chetat1*'MCHAML';                     
conti=PRECED.'CONTINUATION';                                            
WTAB=PRECED.'WTABLE';                                                   
LDEVA = 'EXTR' WTAB.'MA_TOTAL' 'DEVA';                                  
LPAR0 = 'EXTR' WTAB.'MO_TOTAL' 'PARA';                                  
LDEVA_DI = 'DIME' LDEVA;                                                
nocom='EXTR'  CHETAT1 'COMP';                                           
'SI' ('NEG' LDEVA_DI 0);                                                
                                                                        
   'REPETER' BOU_VA1 LDEVA_DI;                                          
        ITE1 = &BOU_VA1;                                                
        NOM1 = 'EXTR' LDEVA ITE1;                                       
        'SI' (WTAB.'FREQUENTIEL' 'ET' ('EGA' NOM1 'FREQ')) ;            
        'SINON';                                                        
         'SI' ('NON' ('EXISTE'   nocom NOM1));                          
            'MESS' 'Il manque la variable ' NOM1 ;                      
            'ERRE'  ' ';                                                
         'FINSI' ;                                                      
        'FINSI';                                                        
   'FIN' BOU_VA1;                                                       
   'SI' WTAB.'FOR_MECA' ;                                               
     'SI'  WTAB.'MEC1' ;                                                
        MA=WTAB.'MAT_MEC';                                              
        'SI' WTAB.'POR1' ;                                              
          MA= MA 'ET' WTAB.'MAT_POR';                                   
        'FINSI';                                                        
     'SINON';                                                           
        MA=WTAB.'MAT_POR';                                              
     'FINSI';                                                           
      LDEVAM='EXTR' MA 'DEVA';                                          
      LDEVA_DM = 'DIME' LDEVAM;                                         
     'SI' ('NEG' LDEVA_DM 0);                                           
        'SI' ('NON' (('EGA' LDEVA_DM 1) 'ET'                            
             ( 'EGA' (LDEVAM 'EXTR' 1) 'ALPH' ) ));                     
            WTAB.'RECALCUL'= VRAI;                                      
        'FINSI';                                                        
        WTAB.'MATVAR'=VRAI;WTAB.'LDEVA'=LDEVAM;                         
        'SI' WTAB.'FREQUENTIEL' ; WTAB.'MATVAR'= FAUX; 'FINSI';         
     'FINSI';                                                           
   'FINSI';                                                             
'FINSI';                                                                
'SI' WTAB.'PARA_EXTE';                                                  
    TEMP0=conti.'TEMPS';                                                
    LPAR0_DI = 'DIME' LPAR0;                                            
   'REPETER' BOU_PA1 LPAR0_DI;                                          
       NOM1 = 'EXTR' LPAR0 &BOU_PA1;                                    
       'SI' ('NON' ('EXISTE'   nocom NOM1));                            
            'MESS' 'Il manque la variable ' NOM1  ;                     
            'ERRE'  ' ';                                                
       'FINSI';                                                         
   'FIN' BOU_PA1;                                                       
   'SI' WTAB.'FOR_MECA' ;                                               
     WTAB.'PARA_EXTE'=FAUX;                                             
     'SI'  WTAB.'MEC1' ;                                                
        MO=WTAB.'MOD_MEC';                                              
        'SI' WTAB.'POR1' ;                                              
          MO= MO 'ET' WTAB.'MOD_POR';                                   
        'FINSI';                                                        
     'SINON';                                                           
        MO=WTAB.'MOD_POR';                                              
     'FINSI';                                                           
     LPAR0 = 'EXTR' MO 'PARA';                                          
     LPAR0_DI = 'DIME' LPAR0;                                           
     'SI' ( LPAR0_DI  'NEG' 0) ;                                        
       WTAB.'PARA_EXTE'=VRAI;                                           
       WTAB.'LPAR0'= LPAR0 ;                                            
     'FINSI';                                                           
   'FINSI';                                                             
'FINSI';                                                                
'FINPROC';                                                              
'DEBPROC' UNPAS   PRECED*'TABLE';                                       
WTAB = PRECED.'WTABLE'      ;                                           
conti= PRECED.'CONTINUATION';                                           
estim= PRECED.'ESTIMATION'  ;                                           
MXMYMZ = 'MOTS' 'MX'  'MY'  'MZ'  'MT'  'FP'  'FPQ'  'FTP'              
                'IMX' 'IMY' 'IMZ' 'IMT' 'IFP' 'IFPQ' 'IFTP' ;           
MXMFLX = 'MOTS' 'MX'  'MY'  'MZ'  'MT'  'FLX' 'FP'  'FPQ'  'FTP'        
                'IMX' 'IMY' 'IMZ' 'IMT' 'FLX' 'IFP' 'IFPQ' 'IFTP' ;     
MLPRIM = 'MOTS' 'UX'  'UY'  'UZ'  'UR'  'UT'   'RX'   'RY'  'RZ'  'RT'  
                'LX'  'P'   'PQ'  'TP'   'ALFA' 'BETA'                  
                'IUX' 'IUY' 'IUZ' 'IUR'  'IUT'  'IRX'  'IRY' 'IRZ' 'IRT'
                'IP' 'IPQ'  'ITP' 'IALF' 'IBET' ;                       
MLDUAL = 'MOTS' 'FX'  'FY'  'FZ'  'FR'   'FT'   'MX'   'MY'  'MZ'  'MT' 
                'FLX' 'FP'  'FPQ' 'FTP'  'FALF' 'FBET'                  
                'IFX' 'IFY' 'IFZ' 'IFR'  'IFT'  'IMX'  'IMY' 'IMZ' 'IMT'
                'IFP' 'IFPQ' 'IFTP' 'IFAL' 'IFBE' ;                     
MLDEPL = 'MOTS' 'UX' 'UY' 'UZ' 'UR' 'UT'  'IUX' 'IUY' 'IUZ' 'IUR' 'IUT' 
                'ALFA' 'BETA' 'IALF' 'IBET' ;                           
MLROTA = 'MOTS' 'RX' 'RY' 'RZ' 'RT' 'P' 'PQ' 'TP'                       
                'IRX' 'IRY' 'IRZ' 'IRT' 'IP' 'IPQ' 'ITP';               
MLDEFOR = 'MOTS'  'EPXX' 'EPYY' 'EPZZ' 'EPSS' 'EPTT' 'EPRR'             
                  'GAXY' 'GAXZ' 'GAYZ' 'GAST' 'GASN' 'GATN'             
                  'GARZ' 'GART' 'GAZT' 'RTSS' 'RTTT' 'RTST'             
                  'RTZZ' 'RTXX' 'EPS ' 'GXY ' 'CX  ' 'CY  ' 'CZ  '      
                  'EPSE' ;                                              
MLDEFOR = 'MOTS'  'EPXX' 'EPYY' 'EPZZ' 'EPSS' 'EPTT' 'EPRR'             
                  'GAXY' 'GAXZ' 'GAYZ' 'GAST' 'GASN' 'GATN'             
                  'GARZ' 'GART' 'GAZT' 'GXY ' 'CX  ' 'CY  ' 'CZ  '      
                  'EPSE' ;                                              
MVPRIM = 'MOTS' 'VTX' 'VTY' 'VTZ' 'VTR' 'VTT' 'VWX' 'VWY' 'VWZ' 'VWT'   
                'VLX' 'VVP' 'VVPQ' 'VVTP' 'VALF' 'VBET'                 
          'IVTX' 'IVTY' 'IVTZ' 'IVTR' 'IVTT' 'IVWX' 'IVWY' 'IVWZ' 'IVWT'
                'IVVP' 'IVPQ' 'IVTP' 'IVAL' 'IVBE' ;                    
MOCA = 'MOTS' 'VECT' 'VX  ' 'VY  ' 'VZ  ' 'VXF ' 'VYF ' 'VZF '          
              'V1X ' 'V1Y ' 'V1Z ' 'V2X ' 'V2Y ' 'V2Z ' ;               
                                                                        
ICERAM = WTAB.'CERAMIQUE' ;                                             
IDYN   = WTAB.'DYNAMIQUE';                                              
IELANL = WTAB.'NON_LINEAIRE';                                           
IENDOM = WTAB.'ENDOMMAGEMENT';                                          
IFEFP  = WTAB.'FEFP_FORMULATION' ;                                      
IFEFPUL= WTAB.'UPDATE_LAGRANGIAN';                                      
IFTOL  = 'NEG' WTAB.'FTOL' 'INCONNU' ;                                  
IGRD   = WTAB.'GRANDS_DEPLACEMENTS';                                    
IKSIA  = WTAB.'K_SIGMA';                                                
IKTAN  = WTAB.'K_TANGENT' ;                                             
IMPLP  = WTAB.'LIAISON_PERSISTANTE';                                    
IMTOL  = 'NEG' WTAB.'MTOL' 'INCONNU';                                   
IPILOT = WTAB.'AUTOMATIQUE';                                            
IPLAST = WTAB.'PLASTIQUE';                                              
IPLAVI = WTAB.'IPLAVI';                                                 
IPREDIC = WTAB.'PREDICTEUR';                                            
IRCON  = WTAB.'RAIDCONST';                                              
ISOL   = WTAB.'CONSOLIDATION';                                          
ISSTE  = WTAB.'SUBSTEPPING';                                            
ITHER  = WTAB.'CHAR_THE' 'OU' WTAB.'FOR_THER';                          
IVIEXT = WTAB.'VISCO_EXTERNE';                                          
IVIDOM = WTAB.'VISCODOMMAGE';                                           
IVISCO = WTAB.'VISCOPLASTIQUE';                                         
LNLOC  = WTAB.'NLOC';                                                   
LOGDEF = WTAB.'CHAR_DEFI';                                              
NITMA  = WTAB.'NITERINTER_MAX';                                         
NSSTE  = WTAB.'NMAXSUBSTEPS';                                           
POR1   = WTAB.'POR1' ;                                                  
TI     = WTAB.'T_FINAL';                                                
EKREAC = WTAB.'REAC_GRANDS';                                            
ZMAXIT = WTAB.'MAXITERATION' ;                                          
ZNACCE = 2 ;                                                            
ZNCONS = WTAB.'NITER_KTANGENT';                                         
ZPREC  = WTAB.'PRECISION' ;                                             
ZPREK  = WTAB.'PRECISINTER';                                            
ZPRECD = WTAB.'PRECDECHARGE';                                           
ZPRECM = WTAB.'PRECFLEX';                                               
WTAB.'CLIM'=WTAB.'BLOCAGES_MECANIQUES';                                 
ZCLIM  = WTAB.'CLIM' ;                                                  
ZCLIMCF = ZCLIM;                                                        
SI (EXISTE WTAB CLIMCF); ZCLIMCF = WTAB.CLIMCF; FINSI;                  
BLO_INI=WTAB.'BLOCAGES_MECANIQUES';                                     
DT= WTAB.'DT';                                                          
TEMPS0=WTAB.'TEMPS0';                                                   
'SI'  WTAB.'RECALCUL'  ;                                                
    WTAB . 'RECARI' = VRAI ;                                            
    WTAB . 'RECADET' = VRAI;                                            
    WTAB . 'REA_GEOM' = VRAI ;                                          
    GEOM1 = 'FORM';                                                     
'SINON';                                                                
     GEOM1 = WTAB.'FOR0' ;                                              
     WTAB . 'RECARI' = FAUX ;                                           
     WTAB . 'RECADET' = FAUX;                                           
'FINSI';                                                                
                                                                        
'SI' ('OU' ('OU' IENDOM  IVIDOM) ICERAM);                               
     WTAB.'RECARI'= VRAI;                                               
'FINSI';                                                                
                                                                        
ZMAT11 = WTAB.'MAT1' ;                                                  
ZETAT2='ADET' 'NOUV' wtab.'MO_TOTAL' wtab.'CHARGEMENT' TI               
                           estim 'TEMP'  TI ;                           
'SI' (WTAB.'MATVAR' 'OU' WTAB.'MODAL' 'OU' WTAB.'FREQUENTIEL') ;        
     ZMAT22 = PAS_MATE PRECED  ZETAT2;                                  
'SINON';                                                                
     ZMAT22 = WTAB.'CARACTERISTIQUES';                                  
'FINSI';                                                                
     ZMATIN = ZMAT22;                                                   
'SI' ITHER ;                                                            
  WTAB.'MAT1' = ZMAT22 ;                                                
  PAS_EPTH PRECED      ;                                                
'FINSI';                                                                
'SI' ('EXISTE' (WTAB.'CHARGEMENT') 'MECA');                             
      ZFEXT2 = 'TIRE' (WTAB.'CHARGEMENT') 'MECA' TI;                    
      TYP_2 = 'TYPE' ZFEXT2;                                            
      'SI' ('NEG' TYP_2 'CHPOINT ');                                    
 'MESS' '*** Erreur dans la definition du chargement ( MECA ) ***';     
 'ERRE' '*** Le type du champ n est pas CHPOINT ***';                   
      'FINSI';                                                          
'SINON';                                                                
    ZFEXT2= 'VIDE' 'CHPOINT' / 'DISCRET';                               
'FINSI';                                                                
'SI' ('EXISTE' (WTAB.'CHARGEMENT') 'FORC');                             
      F2_FOR = 'TIRE' (WTAB.'CHARGEMENT') 'FORC' TI;                    
       TYP_2 = 'TYPE' F2_FOR;                                           
       'SI' ('NEG' TYP_2 'CHPOINT ');                                   
 'MESS' '*** Erreur dans la definition du chargement ( FORC ) ***';     
 'ERRE' '*** Le type du champ n est pas CHPOINT ***';                   
      'FINSI';                                                          
       ZFEXT2 = ZFEXT2 + F2_FOR ;                                       
'FINSI';                                                                
         'SI' ('EXISTE' (WTAB.'CHARGEMENT') 'DIMP');                    
             F2_DEP = 'TIRE' (WTAB.'CHARGEMENT') 'DIMP' TI;             
             ZFEXT2 = ZFEXT2 + F2_DEP;                                  
         'FINSI';                                                       
         'SI' WTAB.'CHAR_DEFI' ;                                        
             WTAB.'DEFOR2' = 'TIRE' WTAB.'CHARGEMENT' 'DEFI' TI;        
         'FINSI';                                                       
                                                                        
         'SI' ( WTAB.'DYNAMIQUE' ) ;                                    
            'SI'  ('EGA' WTAB.'FREA1' 'INCONNU');                       
               'SI' ('EXISTE' WTAB.'CHARGEMENT' 'MECA');                
                   F1 = 'TIRE' WTAB.'CHARGEMENT' 'MECA' TEMP0;          
               'FINSI';                                                 
               'SI' ('EXISTE' WTAB.'CHARGEMENT' 'FORC');                
                  F1F = 'TIRE' WTAB.'CHARGEMENT' 'FORC' TEMP0;          
                'SI' ('EGA' ('TYPE' F1) 'CHPOINT ') ;                   
                  F1 = F1 + F1F ;                                       
                'SINON';                                                
                  F1 = F1F ;                                            
                'FINSI' ;                                               
               'FINSI';                                                 
               'SI' WTAB.'PROCEDURE_CHAR_MECA';                         
                   TFF1 =  CHARMECA PRECED TEMPS0 ;                     
                   'SI' ( 'EXIS' TFF1 'ADDI_SECOND');                   
                       FF1=TFF1 .'ADDI_SECOND'; 'FINSI';                
                  'SI' ('EGA' ('TYPE' F1) 'CHPOINT ');                  
                     F1=F1 + FF1;                                       
                  'SINON';                                              
                     F1 = FF1;                                          
                  'FINSI';                                              
               'FINSI';                                                 
                 LAF0 = 'BSIG' WTAB.'MO_TOT' conti.'CONTRAINTES' ZMAT22;
               'SI'  WTAB.'RAIDCONST'  ;                                
                  MAI2 = 'EXTR' WTAB.'RIGIDITE_CONSTANTE' 'MAIL';       
               LAF0 = LAF0 'ET'                                         
                    ('REDU' MAI2                                        
                   (WTAB.'RIGIDITE_CONSTANTE'*conti.'DEPLACEMENTS'));   
               'FINSI';                                                 
               'SI' (('EXIS' WTAB.'CHARGEMENT' 'MECA') 'OU'             
                    ('EXIS' WTAB.'CHARGEMENT' 'FORC') 'OU'              
                   wtab.'PROCEDURE_CHAR_MECA');                         
                  LAF1  = F1  - LAF0 ;                                  
               'SINON';                                                 
                  LAF1 = -1 * LAF0;                                     
               'FINSI';                                                 
               LAF2 = 'ENLEVER'  (WTAB . 'BLOCAGES_MECANIQUES'          
                              * conti.'DEPLACEMENTS' ) 'FLX';           
                WTAB.'FREA1' = LAF1 - LAF2 ;                            
            'FINSI';                                                    
            'SI' wtab.'LIAISON_PERSISTANTE' ;                           
              'SI' ('NEG' WTAB.'AMORTISSEMENT' 'INCONNU');              
                 FF4 = WTAB.'AMORTISSEMENT'* conti.'VITESSES';          
                 WTAB.'FMAN'= WTAB.'FREA1' - FF4 ;                      
              'SINON' ;                                                 
                 WTAB.'FMAN'= WTAB.'FREA1' ;                            
              'FINSI';                                                  
            'FINSI';                                                    
            'SI' ( ('NON' ('EXIS' WTAB MASSE )) 'OU'                    
                               WTAB.'GRANDS_DEPLACEMENTS');             
                WTAB.'MASSE' = 'MASS' WTAB.'MO_TOT' ('CHAN' 'MASSE'     
                         ZMAT22 WTAB.'MO_TOT' ) ;                       
               'SI' WTAB.'MASSCONST';                                   
                  WTAB.'MASSE'=WTAB.'MASSE' 'ET' WTAB.'MASSE_CONSTANTE';
               'FINSI';                                                 
            'FINSI';                                                    
            FF = WTAB.'MASSE' *conti.'VITESSES';                        
            FF4 = 4. / DT * FF; 'DETR' FF;                              
            WTAB.'FREA1' = FF4 + WTAB.'FREA1';                          
         'FINSI';                                                       
          'SI' WTAB.'CONSOLIDATION' ;                                   
            FF = BSIGMA WTAB.'MOD_POR' conti.'CONTRAINTES' ;            
            FF4 = 'EXCO'  WTAB.'MOT_POR' FF                             
                    WTAB.'MOT_POR' 'NOID' 'NATURE' 'DISCRET' ;          
            'SI' WTAB.'DYNAMIQUE';                                      
                WTAB.'FREA1' = WTAB.'FREA1' +   FF4   ;                 
            'SINON';                                                    
                 WTAB.'FREA1' =  FF4   ;                                
            'FINSI';                                                    
            ZFEXT2 = ZFEXT2 + FF4  ;  'DETR' FF ;                       
            'SI' ( 'EXIS' WTAB.'CHARGEMENT' 'FLUX' ) ;                  
               FLUXT0= 'TIRE' WTAB.'CHARGEMENT' 'FLUX' TEMPS0;          
               FLUXTI= 'TIRE' WTAB.'CHARGEMENT' 'FLUX' TI  ;            
               FACFLU =  -1. * WTAB.'DT';                               
               FLUXT =   ( FACFLU * (1 - WTAB.'TETA') * FLUXT0 )        
                       + ( FACFLU * WTAB.'TETA' *FLUXTI ) ;             
               ZFEXT2 = ZFEXT2 + FLUXT ;                                
               'DETR' FLUXT ; 'DETR' FLUXT0; 'DETR' FLUXTI;             
           'FINSI' ;                                                    
        'FINSI';                                                        
        'SI' ( WTAB.'FREQUENTIEL' 'ET' ('NON' ('EXIS' WTAB 'MASSE' ))); 
             WTAB.'MASSE' = 'MASS' WTAB.'MO_TOT'('CHAN' 'MASSE'         
                         ZMAT22 WTAB.'MO_TOT' ) ;                       
        'FINSI';                                                        
                                                                        
                                                                        
ZMODLI = WTAB.'MO_TOT' ;                                                
NBPART = WTAB.'NBPART' ;                                                
                                                                        
PARALLEL = FAUX ;                                                       
PARTLOCA = FAUX ;                                                       
ZMODL  = ZMODLI ;                                                       
'SI' ('EGA' WTAB.'PROCESSEURS' 'COMPORTEMENT') ;                        
  PARALLEL = VRAI ;                                                     
  PARTLOCA = VRAI ;                                                     
  MODRELOC = 'PART' ZMODLI NBPART ;                                     
'FINSI' ;                                                               
'SI' ('EGA' WTAB.'PROCESSEURS' 'AUTOMATIQUE') ;                         
  PARALLEL = VRAI ;                                                     
  PARTLOCA = FAUX ;                                                     
  ZMODL = 'PART' ZMODLI NBPART ;                                        
  'OPTI' 'PARA' VRAI ;                                                  
'FINSI' ;                                                               
                                                                        
STAB12             = 'TABLE' ;                                          
STAB12.'ZU1'       =  CONTI.'DEPLACEMENTS';                             
STAB12.'SIGF'      = 'REDU' (CONTI.'CONTRAINTES' ) ZMODL ;              
STAB12.'DEFF'      = 'REDU' (conti.'DEFORMATIONS') ZMODL ;              
STAB12.'FNONL'     =  WTAB.'FNONL'  ;                                   
STAB12.'RESIDU'    =  WTAB.'RESIDU' ;                                   
STAB12.'XDENO'     =  WTAB.'XDENO'  ;                                   
STAB12.'XDENOM'    =  WTAB.'XDENOM' ;                                   
'SI' ( 'EXIS' WTAB 'ETAT1' );                                           
  STAB12.'ETAT1'   = WTAB.'ETAT1';                                      
'FINSI';                                                                
STAB12.'ETAT2'= ZETAT2;                                                 
'SI' ('EXIS' WTAB 'DEFOR1' );                                           
  STAB12.'DEFOR1'  = WTAB.'DEFOR1'  ;                                   
  STAB12.'DEFOR2'  = WTAB.'DEFOR2'  ;                                   
'FINSI';                                                                
'SI' ('EXIS' WTAB 'ETHER1');                                            
  STAB12.'ETHER1'  = WTAB.'ETHER1'  ;                                   
'FINSI';                                                                
'SI' ('EXIS' WTAB 'MSRTHER1' ) ;                                        
  STAB12.'MSRTHER1'= WTAB.'MSRTHER1';                                   
'FINSI';                                                                
'SI' ( 'EXIS' WTAB 'FNONL');                                            
  STAB12.'FNONL'   = WTAB.'FNONL'   ;                                   
'FINSI';                                                                
'SI' ('EXIS' WTAB  'TET1') ;                                            
  STAB12.'TET1'    = WTAB.'TET1'    ;                                   
  STAB12.'TET2'    = WTAB.'TET2'    ;                                   
'FINSI';                                                                
'SI' ('NEG' WTAB.'AUTOCOEF' 'INCONNU') ;                                
  STAB12.'AUTOCOEF' = WTAB.'AUTOCOEF' ;                                 
'FINSI' ;                                                               
'SI' ('NEG' WTAB.'AUTOREDU' 'INCONNU') ;                                
  STAB12.'AUTOREDU' = WTAB.'AUTOREDU' ;                                 
'FINSI' ;                                                               
'SI' ('NEG' WTAB.'SECOND_MEMBRE' 'INCONNU') ;                           
  STAB12.'SECOND_MEMBRE' = WTAB.'SECOND_MEMBRE' ;                       
'FINSI' ;                                                               
'SI' ('NEG' WTAB.'LASTKTAN' 'INCONNU') ;                                
  STAB12.'LASTKTAN' = WTAB.'LASTKTAN' ;                                 
'FINSI' ;                                                               
'SI' ('NEG' WTAB.'AUTORED1' 'INCONNU') ;                                
  STAB12.'AUTORED1' = WTAB.'AUTORED1' ;                                 
'FINSI' ;                                                               
'SI' ('NEG' WTAB.'LISEA_M' 'INCONNU') ;                                 
  STAB12.'LISEA_M' = WTAB.'LISEA_M' ;                                   
  STAB12.'RIBLO_M' = WTAB.'RIBLO_M' ;                                   
'FINSI' ;                                                               
'SI' ('NEG' WTAB.'INCREMENT' 'INCONNU' );                               
  STAB12.'INCREMENT' = WTAB.'INCREMENT';                                
  INCRPREC = STAB12.'INCREMENT'        ;                                
'FINSI';                                                                
STAB12.'FFROT'    = WTAB.'FFROT'    ;                                   
STAB12.'INITEMPS' = WTAB.'INITEMPS' ;                                   
STAB12.'DT'       = WTAB.'DT'       ;                                   
STAB12.'DTPREC'   = WTAB.'DTPREC'   ;                                   
'SI'  ITHER  ;                                                          
  STAB12.'TETA1' = WTAB.'TET1';                                         
  STAB12.'TETA2' = WTAB.'TET2' ;                                        
'SINON' ;                                                               
  che3 = 'MANU' 'CHML' ZMODL 'T' 20. 'STRESSES' ;                       
  che4 = 'MANU' 'CHML' ZMODL 'T' 20. 'STRESSES' ;                       
'FINSI' ;                                                               
                                                                        
ZMATI    = 'REDU' ZMAT22 ZMODLI ;                                       
ZMAT     = 'REDU' ZMATI  ZMODL  ;                                       
                                                                        
'SI' ('NEG' WTAB.'MOD_MEC' 'INCONNU') ;                                 
  'SI' ('EGA' WTAB.'DFGRAD' 'INCONNU') ;                                
    STAB12.'DFGRAD' = 'GRAD' ZMODL ZMAT STAB12.'ZU1' ;                  
  'SINO';                                                               
    STAB12.'DFGRAD' = 'REDU' WTAB.'DFGRAD' ZMODL;                       
  'FINS' ;                                                              
'SINON' ;                                                               
  STAB12.'DFGRAD' = WTAB.'DFGRAD' ;                                     
'FINS' ;                                                                
                                                                        
com_sig  = 'EXTR' ZMODLI  'CONT';                                       
HPP_EPS  =  FAUX                ;                                       
EPS_EPS  = 'TEXT' '        '    ;                                       
EPS_NLIN =  VRAI                ;                                       
                                                                        
'SI' ('EGA' ('VALE' 'EPSI') 'LINEAIRE'); EPS_NLIN = FAUX; 'FINSI';      
'SI' ('EXISTE' PRECED 'ACCELERATION') ;                                 
  III = PRECED.'ACCELERATION' ;                                         
  'SI' ('EGA' ('TYPE' III) 'ENTIER') ; ZNACCE = III ; 'FINSI' ;         
'FINSI' ;                                                               
IKTAN  = IKTAN 'ET' IPLAVI ;                                            
'SI' (WTAB.'K_TANGENT' 'ET' ('NON' IPLAVI)) ;                           
  'MESS' 'IPLAVI faux : pas de matrice tangente ->'                     
         ' on utilise la rigidite elastique' ;                          
'FINSI' ;                                                               
IPERT = WTAB.'K_TANGENT_PERT' 'ET' ('NON' LNLOC) 'ET' IPLAVI ;          
ZPERC1 = WTAB.'K_TANG_PERT_C1' ;  ZPERC2 = WTAB.'K_TANG_PERT_C2' ;      
'SI' WTAB.'K_TANGENT_SYME' ;                                            
  ZKTASYM = 'MOT' 'SYME' ;                                              
'SINON' ;                                                               
  ZKTASYM = 'TEXTE' '    ' ;                                            
'FINSI';                                                                
'SI' IKTAN ;                                                            
  'SI' (IFEFP 'OU' ISSTE) ; ZNACCE = 999 ; 'FINSI';                     
'FINSI' ;                                                               
'SI' IFTOL ;                                                            
    ZFTOL = 'ABS' WTAB.'FTOL' ;                                         
'FINSI';                                                                
'SI'  IMTOL  ;                                                          
    ZMTOL = 'ABS' WTAB.'MTOL' ;                                         
'FINSI';                                                                
'SI' IRCON;                                                             
    MAI2  ='EXTR' (WTAB.'RIGIDITE_CONSTANTE') 'MAIL';                   
'FINSI';                                                                
ITCAR = ( 'EXIS' ZMATI 'EPAI') 'OU' ('EXIS' ZMATI 'INRY') 'OU'          
        ( 'EXIS' ZMATI 'MODS') 'OU'                                     
       (('EXIS' ZMODLI 'ELEM' 'JOI1') 'ET' ('EXIS' ZMATI 'V1X ')        
                                      'ET' ('EXIS' ZMATI 'V1Y '))  ;    
'SI' (ITCAR 'EGA' FAUX) ;                                               
     ZMAT2 = ZMATI ; ZMAT2R= ZMAT;                                      
'FINSI';                                                                
                                                                        
'SI' ('OU' ('OU' IVISCO IVIDOM) IVIEXT);  ZPREK = 5.E-7 ;  'FINSI';     
'SI' IENDOM;                              ZPREK = ZPREC ;  'FINSI';     
                                                                        
'SI' WTAB.'POR1';                                                       
    MO_PORI = 'EXTR' ZMODLI 'FORM' 'POREUX';                            
    MO_POR  = 'EXTR' ZMODL  'FORM' 'POREUX';                            
                                                                        
    MA_POR  = 'REDU' ZMAT22 MO_POR      ;                               
    MA_POR0 = 'REDU' ZMAT11 MO_POR      ;                               
                                                                        
    MAI_POR = 'EXTR' MO_POR  'MAILLAGE' ;                               
    MAI_PORI= 'EXTR' MO_PORI 'MAILLAGE' ;                               
'FINSI';                                                                
                                                                        
DEFT0 = 'REDU'  (conti.'DEFORMATIONS')  ZMODL  ;                        
'SI' IPLAVI ;                                                           
     ZEPS0   = 'REDU' (conti.'DEFORMATIONS_INELASTIQUES')  ZMODL ;      
     ZVAR0   = 'REDU' (conti.'VARIABLES_INTERNES'       )  ZMODL ;      
     com_var = 'EXTR' ZMODLI 'VARI' ;                                   
     com_dei = 'EXTR' ZMODLI 'DEIN' ;                                   
     lnom    =  com_var             ;                                   
    'SI' ISOL  ;                                                        
       com_maa = 'EXTR' ZMODLI 'MATE' ;                                 
    'FINSI' ;                                                           
'FINSI' ;                                                               
TSTMOM = ITCAR 'OU' ('EGA' ('VALE' 'MODE') 'PLANGENE') ;                
'SI' POR1  ; TSTMOM=VRAI ; 'FINSI';                                     
IKLFFF=VRAI;                                                            
'SI'TSTMOM;    'SI' IFTOL;     'SI' IMTOL;                              
       IKLFFF=FAUX;                                                     
'FINSI';        'FINSI';        'FINSI';                                
'SI'('NON' TSTMOM); 'SI' IFTOL;                                         
       IKLFFF=FAUX;                                                     
'FINSI';'FINSI';                                                        
GEOREF0  = WTAB.'FOR0' ;                                                
WTAB.'CONV'=VRAI;                                                       
WTAB . 'ISOUSPAS' = 0;                                                  
NSOUSPAS = WTAB . 'MAXSOUSPAS';                                         
ZCCONV = VRAI ;                                                         
KNOCONV = 0 ;                                                           
'REPETER'  BONOCONV NSOUSPAS;                                           
                                                                        
  KNOCONV       = KNOCONV+1      ;                                      
  STAB12.'CONV' = FAUX           ;                                      
  DT_INIT       = STAB12.'DT'    ;                                      
  DTINI         = STAB12.'DT'    ;                                      
  ZSIG0         = STAB12.'SIGF'  ;                                      
  ZPI0          = ZSIG0          ;                                      
  ZU1           = STAB12.'ZU1'   ;                                      
  GR_U_DEB      = STAB12.'DFGRAD';                                      
                                                                        
  'SI'  ITHER  ;                                                        
    TETA1 = STAB12.'TETA1' ;                                            
    TETA2 = STAB12.'TETA2' ;                                            
    DTETD = TETA2 - TETA1  ;                                            
  'FINSI' ;                                                             
                                                                        
    'SI' (WTAB.'MATVAR' 'OU' WTAB.'MODAL' 'OU' WTAB.'FREQUENTIEL');     
      'SI' (knoconv > 1) ;                                              
       STAB12.'MAT1' = PAS_MATE  PRECED  STAB12.'ETAT1';                
      'SINON';                                                          
       STAB12.'MAT1' = ZMAT11 ;                                         
      'FINSI' ;                                                         
   'SINON';                                                             
      'SI' WTAB.'FOR_MECA' ;                                            
         'SI' WTAB.'MEC1';                                              
            MA=WTAB.'MAT_MEC';                                          
            'SI' WTAB.'POR1' ; MA=MA 'ET' WTAB.'MAT_POR'; 'FINSI';      
         'SINON';                                                       
            MA= WTAB.'MAT_POR';                                         
         'FINSI';                                                       
      'FINSI';                                                          
      STAB12.'MAT1'=MA;                                                 
   'FINSI';                                                             
                                                                        
   'SI' WTAB.'ITCAR';                                                   
      'SI' ('EGA' WTAB.'CARA'  'INCONNU');                              
         WTAB.'CARA' = STAB12.'MAT1';                                   
      'SINON';                                                          
         MECAR1        = 'EXCO' MOCA STAB12.'MAT1' 'NOID'       ;       
         MECAR2        = 'EXCO' MOCA WTAB  .'CARA' 'NOID'       ;       
         MECAR1        = 'CHAN' 'TYPE' MECAR1 'CARACTERISTIQUES';       
         MECAR2        = 'CHAN' 'TYPE' MECAR2 'CARACTERISTIQUES';       
         STAB12.'MAT1' =  STAB12.'MAT1' - MECAR1 + MECAR2       ;       
      'FINSI';                                                          
   'FINSI';                                                             
                                                                        
    'SI' (WTAB.'MATVAR' 'OU' WTAB.'MODAL' 'OU' WTAB.'FREQUENTIEL');     
      'SI' (knoconv > 1) ;                                              
         MCHC = PAS_ETAT PRECED  TI;                                    
         MMMM = PAS_MATE PRECED  MCHC;                                  
      'SINON' ;                                                         
         MMMM = ZMAT22 ;                                                
      'FINSI' ;                                                         
    'SINON';                                                            
         MMMM = WTAB.'CARACTERISTIQUES';                                
    'FINSI';                                                            
                                                                        
    'SI' WTAB.'ITCAR';                                                  
         MECAR1 = 'EXCO'  MOCA  MMMM        'NOID'       ;              
         MECAR2 = 'EXCO'  MOCA  WTAB.'CARA' 'NOID'       ;              
         MECAR1 = 'CHAN' 'TYPE' MECAR1 'CARACTERISTIQUES';              
         MECAR2 = 'CHAN' 'TYPE' MECAR2 'CARACTERISTIQUES';              
         MMMM = MMMM - MECAR1 + MECAR2;                                 
         MECAR2 = 'EXCO'  MOCA  MMMM  'NOID'             ;              
         MECAR1 = 'EXCO'  MOCA  ZMAT  'NOID'             ;              
         MECAR1 = 'EXCO'  MOCA  ZMATI 'NOID'             ;              
         MECAR2 = 'CHAN' 'TYPE' MECAR2 'CARACTERISTIQUES';              
         MECAR1 = 'CHAN' 'TYPE' MECAR1 'CARACTERISTIQUES';              
         MECAR1 = 'CHAN' 'TYPE' MECAR1 'CARACTERISTIQUES';              
         ZMAT   =  ZMAT  - MECAR1 + MECAR2               ;              
         ZMATI  =  ZMATI - MECAR1 + MECAR2               ;              
    'FINSI';                                                            
                                                                        
    'SI' ( (WTAB.'RECARI' 'ET' WTAB.'CONV') 'OU'                        
           ('NON' ('EXIS' WTAB 'RRRR')    )     );                      
      'SI' ('OU' ('OU' IENDOM  IVIDOM) ICERAM);                         
         HOOKENDO ='HOOK' ZMODL MMMM conti.'VARIABLES_INTERNES';        
         RH       ='RIGI' ZMODL HOOKENDO MMMM ;                         
        'DETR' HOOKENDO;                                                
      'SINON';                                                          
         RH = 'RIGI' ZMODL MMMM ;                                       
      'FINSI';                                                          
                                                                        
       RRRR = RH 'ET' WTAB.'BLOCAGES_MECANIQUES';                       
       'SI' WTAB.'RAIDCONST';                                           
          RRRR = RRRR 'ET' WTAB.'RIGIDITE_CONSTANTE';                   
       'FINSI';                                                         
       WTAB.'RRRR'=RRRR;                                                
                                                                        
    'SINON';                                                            
         AA1 = 'EXTR' WTAB.'BLOCAGES_MECANIQUES' 'MAIL';                
         AA2 = 'EXTR' BLO_INI 'MAIL';                                   
         AA3 = 'DIFF' AA1 AA2;                                          
         'SI' ('NEG' (NBNO AA3) 0);                                     
            'SI' ('OU' ('OU' IENDOM  IVIDOM) ICERAM);                   
                HOOKENDO = 'HOOK' ZMODL MMMM conti.'VARIABLES_INTERNES';
                RH       = 'RIGI' ZMODL HOOKENDO MMMM ;                 
               'DETR' HOOKENDO;                                         
            'SINON';                                                    
                RH       = 'RIGI' ZMODL MMMM ;                          
            'FINSI';                                                    
            RRRR = RH 'ET' WTAB.'BLOCAGES_MECANIQUES';                  
            'SI' WTAB.'RAIDCONST';                                      
               RRRR = RRRR 'ET' WTAB.'RIGIDITE_CONSTANTE';              
            'FINSI';                                                    
            WTAB.'RRRR'=RRRR;                                           
            BLO_INI = WTAB.'BLOCAGES_MECANIQUES';                       
          'SINON';                                                      
            RRRR=WTAB.'RRRR';                                           
         'FINSI';                                                       
    'FINSI';                                                            
    ZRAID=RRRR;                                                         
                                                                        
    'SI' ( WTAB.'CONSOLIDATION' 'OU' WTAB.'DYNAMIQUE');                 
          DT = TI - TEMP0;                                              
          'SI' ( '>' (DELTAN*0.9999) DT) ;                              
               WTAB . 'RECAOP' = VRAI;                                  
          'FINSI';                                                      
          'SI' ( '<' (DELTAN*1.0001) DT) ;                              
               WTAB . 'RECAOP' = VRAI;                                  
          'FINSI';                                                      
          'SI' WTAB.'MATVAR';                                           
               WTAB . 'RECAOP' = VRAI;                                  
          'FINSI';                                                      
               DELTAN=WTAB.'DT';                                        
    'FINSI';                                                            
     'SI' ( WTAB.'DYNAMIQUE' 'OU' WTAB.'CONSOLIDATION');                
       'SI' ('NEG' WTAB.'OPERATEUR' 'INCONNU');                         
          ZRAID = WTAB.'OPERATEUR';                                     
         'SI' (WTAB . 'RECAOP') ;                                       
            ZRAID = RRRR ;                                              
         'FINSI';                                                       
       'FINSI';                                                         
     'FINSI';                                                           
                                                                        
     'SI' WTAB.'FREQUENTIEL' ;                                          
        RRR2 = 'AMOR'  ZMODL ZMAT ;                                     
        RR2  = 'CHAN' 'INCO' RRR2                                       
              ('MOTS' 'ALFA' 'BETA') ('MOTS' 'IALF' 'IBET')             
              ('MOTS' 'FALF' 'FBET') ('MOTS' 'FALF' 'FBET') 'QUEL' ;    
        RR3  = 'CHAN' 'INCO' RRR2                                       
              ('MOTS' 'ALFA' 'BETA') ('MOTS' 'ALFA' 'BETA')             
              ('MOTS' 'FALF' 'FBET') ('MOTS' 'IFAL' 'IFBE') 'QUEL' ;    
        RRR2 = RR2 'ET' RR3 ;                                           
                                                                        
        RR1  = ZRAID ;                                                  
        OMEGI= 2.* PI * TI ;                                            
        RRR1 = OMEGI * OMEGI * (-1.) * WTAB.'MASSE' ;                   
        RR1  = ZRAID 'ET'  RRR1 ;                                       
        RR4  = 'CHAN' 'INCO' (RR1 * (-1.))                              
              ('MOTS' 'ALFA' 'BETA') ('MOTS' 'IALF' 'IBET')             
              ('MOTS' 'FALF' 'FBET') ('MOTS' 'IFAL' 'IFBE') 'QUEL';     
        ZRAID= RR1 'ET' RR4    ;                                        
        RR5  = OMEGI * RRR2    ;                                        
        ZRAID= ZRAID 'ET' RR5  ;                                        
     'FINSI' ;                                                          
                                                                        
     'SI' (WTAB.'CONSOLIDATION') ;                                      
       'SI' (WTAB.'GRANDS_DEPLACEMENTS' 'OU' WTAB.'MATVAR') ;           
          WTAB .'PERMEABILITE'= 'PERM' WTAB.'MOD_POR' MMMM ;            
          WTAB .'RECAOP'      =  VRAI                      ;            
       'FINSI';                                                         
     'FINSI';                                                           
                                                                        
     'SI' (WTAB . 'RECAOP') ;                                           
       'SI' ( WTAB.'DYNAMIQUE');                                        
          ZRAID =  4. /( DT * DT) * WTAB.'MASSE'  'ET' ZRAID;           
         'SI' ('NEG' WTAB.'AMORTISSEMENT' 'INCONNU');                   
            ZRAID = WTAB.'AMORTISSEMENT'*(2. /DT) 'ET' ZRAID ;          
         'FINSI';                                                       
       'FINSI' ;                                                        
                                                                        
       'SI' ( WTAB.'CONSOLIDATION');                                    
          ZRAID = -1. * DT * WTAB.'TETA'* WTAB.'PERMEABILITE'           
                 'ET' ZRAID ;                                           
       'FINSI' ;                                                        
        WTAB . 'OPERATEUR'= ZRAID ;                                     
        WTAB . 'RECAOP'   = FAUX  ;                                     
     'FINSI';                                                           
                                                                        
     WTAB.'CLIM' = WTAB.'BLOCAGES_MECANIQUES';                          
     CDEP = STAB12.'ZU1' ;                                              
     CDEPSLX = 'ENLEVER' CDEP 'LX' ;                                    
     ZFCONT  = 'VIDE' 'CHPOINT' / 'DISCRET';                            
     CRR = 0;                                                           
     'SI' WTAB.'CONTACT';                                               
        ZCLIM = WTAB.'CLIM';                                            
ZCLIMCF = ZCLIM;                                                        
SI (EXISTE WTAB CLIMCF); ZCLIMCF = WTAB.CLIMCF; FINSI;                  
          modcon= wtab.'MODCONTA';                                      
          WTAB.'CONT_REEL'=modcon;                                      
          'SI' ('EXIS' WTAB  'MAT_JEU') ;                               
            CDAP CRR RFROTE= 'RFCO' modcon  WTAB.'CONV'                 
                WTAB. 'MAT_JEU';                                        
          'SINON' ;                                                     
             CDAP CRR RFROTE= 'RFCO' modcon  WTAB.'CONV'  ;             
          'FINSI';                                                      
          'SI' (WTAB . 'MODAL') ;                                       
             CRR  = 'PJBA' CRR  ZMODL MMMM ;                            
             MCRR = 'EXTR' CRR 'MAIL' 'MULT' ;                          
             MCDAP = 'EXTR' CDAP 'MAIL' ;                               
            'REPETER' BCDA ('NBNO' MCDAP) ;                             
                PBCDA = MCDAP 'POINT' &BCDA ;                           
                PCRR = 'POINT' MCRR &BCDA ;                             
              CHCR='MANU' 'CHPO' PCRR 1 'FLX' ('EXTR' CDAP 'FLX' PBCDA) 
               'NATURE' 'DISCRETE' ;                                    
               'SI' ('EGA' 1 &BCDA) ;                                   
                   CCDA = CHCR ;                                        
               'SINON' ;                                                
                  CCDA = CCDA 'ET' CHCR ;                               
               'FINSI' ;                                                
            'FIN' BCDA ;                                                
            CDAP = CCDA ;                                               
          'FINSI' ;                                                     
          ZCLIM2 = 0;                                                   
          'SI'  ('NEG' CRR 0);                                          
               ZCLIM2 =  CRR ;                                          
               CCOR = CRR * CDEPSLX;                                    
               ZFCONT = ZFCONT + CCOR;                                  
          'FINSI';                                                      
          'SI' ( 'NEG' 0 CDAP);                                         
               ZFCONT = ZFCONT + CDAP;                                  
          'FINSI';                                                      
          'SI' ('NEG' 0 RFROTE);                                        
            RFROT = RFROTE;                                             
            'SI'  ('EGA' ZCLIM2 0);                                     
               ZCLIM2 =  RFROT ;                                        
            'SINON';                                                    
                 ZCLIM2 = RFROT 'ET' ZCLIM2;                            
            'FINSI';                                                    
            CCOR  = RFROT * CDEPSLX ;                                   
            ZFCONT = ZFCONT + CCOR;                                     
          'FINSI';                                                      
        ZFCONSTA = 'COPIER' (ZFCONT + ZFEXT2);                          
       'SI' ('NEG' ZCLIM2 0);                                           
          ZRAID = ZCLIM2 'ET' ZRAID ;                                   
          ZCLIM = ZCLIM2 'ET' ZCLIM ;                                   
       'FINSI';                                                         
     'FINSI';                                                           
                                                                        
     ISNPB = FAUX ;                                                     
     AL1 = 1. ;COEPI = 1.d0; COEINC=0.d0;COEPI0=1.d0;DAL1=100.D0;       
     CORPREC = 1. ;                                                     
     'SI' (('EGA' ipredic  'HPP') 'ET' WTAB.'CONV');                    
          EPS_EPS = 'TEXTE' 'LINEAIRE';                                 
          HPP_EPS = VRAI;                                               
     'FINSI';                                                           
     'SI' IPILOT ;                                                      
          'SI' ( WTAB.'AUTODEUX' ) ;                                    
                COEPI = 'ABS' ( STAB12.'AUTOCOEF');                     
                COEPI = COEPI / (1.-COEPI);                             
                'SI' (COEPI > 1.D0) ; COEPI=1.D0;'FINSI';               
                COEPI0=COEPI;STAB12.'AUTOCOEF'=COEPI;                   
           'SINON';                                                     
                STAB12.'AUTOCOEF' = 1.D0;                               
           'FINSI' ;                                                    
           RED1 = 1. ;                                                  
           RED2 = 0 ;                                                   
           'SI' ('NEG' WTAB.'AUTORED1' 'INCONNU') ;                     
                'SI' (STAB12.'AUTORED1' > 0);                           
                     STAB12.'AUTORED1' = STAB12.'AUTORED1' - 1;         
                     'SI' (STAB12.'AUTORED1' 'EGA' 0) ;                 
                           COEPI = 3 *  COEPI ;                         
                           STAB12.'AUTOREDU' = STAB12.'AUTOREDU' / 3.;  
                           'SI' (STAB12.'AUTOREDU' > 1.1 );             
                                STAB12.'AUTORED1' = 4 ;                 
                                RED1 = 3. ;                             
                           'FINSI';                                     
                     'MESS' 'On multiplie le critere de pilotage par 3';
                     'FINSI';                                           
                'FINSI';                                                
           'FINSI';                                                     
           'SI' (COEPI > 1d0);                                          
                 RED1 = RED1 / COEPI ;COEPI =1d0;                       
           'FINSI';                                                     
           'SI' ( 'NEG' WTAB.'NBPLAS' 'INCONNU') ;                      
                 'SI' ( WTAB.'NBPLAS' 'EGA' 0) ;                        
                    'SI' (COEPI < 0.) ;COEPI = COEPI * -2.;'FINSI';     
                 'FINSI';                                               
           'FINSI';                                                     
           COEPI = 'ABS' COEPI ;                                        
           COEPI0 = COEPI;                                              
     'SINON';                                                           
           STAB12.'AUTOCOEF'= 1.D0;                                     
     'FINSI';                                                           
     URG = FAUX;RED_URG = 0   ;IT= 0 ; c_zdepr = faux;ITACC = 0;        
     ZICONV = VRAI; MMC = 0 ;  MMCMAX = 0 ; EPSM = 0.; DPSMAX = 0. ;    
     DEPSTDM  = 0. ;  DEKREAC1 = 0. ;XCONVNOR = 0. ; ITNORM1  = 0 ;     
     DEPSTREF = 100. * (WTAB . 'MAXDEFOR') ;ZDEPL=0;                    
     GR_U_K   = GR_U_DEB ;                                              
     DITNORM1 = 0  ;NBCYCLE1 = 0  ;zdept = 0; zdeptq = 0; zdeptp = 0;   
     zprecnc=1e-5;FTHE = 0. ;  FDEF = 0. ; ITNV = -5 ;                  
     TABCONV = 'TABLE' ;                                                
     'SI' IFEFPUL;                                                      
       XUPDA = 1;                                                       
     'FINSI';                                                           
                                                                        
     DEPST0=0;                                                          
     'SI' (WTAB.'MATVAR');                                              
           ZMAT1 = 'REDU'  ZMODL STAB12.'MAT1'   ;                      
           'SI' ('OU' ('OU' IENDOM IVIDOM) ICERAM);                     
              XXX3 = 'ELAS' ZMODL ZSIG0 ZMAT  ZVAR0;                    
              XXX4 = 'ELAS' ZMODL ZSIG0 ZMAT1 ZVAR0;                    
           'SINON';                                                     
              XXX3 = 'ELAS' ZMODL ZSIG0 ZMAT       ;                    
              XXX4 = 'ELAS' ZMODL ZSIG0 ZMAT1      ;                    
           'FINSI';                                                     
           DDEF0 = XXX4 - XXX3;                                         
           'DETR' XXX3;'DETR' XXX4;                                     
           DEPST0=-1.* DDEF0;                                           
     'FINSI';                                                           
     'SI'  ITHER   ;                                                    
          'SI' (WTAB.'MATVAR' 'ET' IPILOT);                             
                'MESS' 'Le pilotage n est pas possible avec un'         
              ' materiau qui depend de la temperature' ;                
              'ERREUR' 19 ;                                             
          'FINSI' ;                                                     
           XXX1 = TETA2 - WTAB.'TALPHA_REFERENCE';                      
           ETT  ='EPTH' ZMODL ZMAT XXX1          ;                      
           ETT0 ='REDU' (STAB12.'ETHER1')  ZMODL ;                      
           ETT  = ETT -  ('REDU' (WTAB.'ETREF') ZMODL);                 
           DTT  = ETT - ETT0;                                           
           'SI' ('EGA' DEPST0 0); DEPST0=DTT;                           
           'SINON';                                                     
           DEPST0 = DTT +DEPST0 ; 'FINSI';                              
           'SI' ('OU' ('OU' IENDOM IVIDOM) ICERAM);                     
                DSIGT0 = 'ELAS' ZMODL DEPST0 ZMAT ZVAR0;                
           'SINON';                                                     
                DSIGT0 = 'ELAS' ZMODL DEPST0 ZMAT      ;                
           'FINSI';                                                     
           'SI' POR1 ;                                                  
                MSRTT0 = 'REDU' (STAB12.'MSRTHER1') ZMODL;              
                ZMATP  = 'REDU' ZMAT MO_POR              ;              
                ZALM   =('EXCO' 'ALPM' ZMATP 'MSR0')                    
                         'CHAN' 'TYPE' 'SCALAIRE'        ;              
                ZBI    =('EXCO' 'COB' ZMATP 'MSR0')                     
                         'CHAN' 'TYPE' 'SCALAIRE'        ;              
                ZALPH  = ('EXCO' 'ALPH' ZMATP 'MSR0')                   
                         'CHAN' 'TYPE' 'SCALAIRE'        ;              
                ZFAC   = 3. * ( ZALM - ( ZBI * ZALPH ) ) ;              
                ZFAC   = 'CHAN' 'STRESSES' MO_POR ZFAC   ;              
                ZDT    = 'REDU' ( TETA2 - WTAB.'TEMPERATURE_REFERENCE') 
                          MAI_PORi                       ;              
                ZDDT   = 'CHAN' 'CHAM' ZDT MO_POR 'STRESSES' 'SCALAIRE';
                MSRTT  = ZFAC  * ZDDT                    ;              
                DMSRT0 = MSRTT - MSRTT0                  ;              
           'FINSI' ;                                                    
     'FINSI';                                                           
                                                                        
     'SI' ( ITHER 'OU' WTAB.'MATVAR');                                  
           'SI' ('OU' ('OU' IENDOM IVIDOM) ICERAM);                     
                DSIGT0 = 'ELAS' ZMODL DEPST0 ZMAT ZVAR0;                
           'SINON';                                                     
                DSIGT0 = 'ELAS' ZMODL DEPST0 ZMAT;                      
           'FINSI';                                                     
           'SI' (POR1 'ET' ITHER);DSIGT0 = DSIGT0 +  DMSRT0;'FINSI';    
           FTHE = 'BSIGMA' ZMODL  DSIGT0 ZMAT ;                         
     'FINSI';                                                           
                                                                        
     'SI' LOGDEF;                                                       
           DDEFOR0 ='REDU' (STAB12.'DEFOR2' - STAB12.'DEFOR1') ZMODL;   
           'SI' ('OU' ('OU' IENDOM IVIDOM) ICERAM);                     
                DSI1 = 'ELAS' ZMODL DDEFOR0 ZMAT ZVAR0;                 
           'SINON';                                                     
                DSI1 = 'ELAS' ZMODL DDEFOR0 ZMAT      ;                 
           'FINSI';                                                     
            FDEF = 'BSIGMA' ZMODL DSI1 ZMAT ;                           
     'FINSI';                                                           
                                                                        
     'SI' IKTAN ;                                                       
           'SI' IFEFP ;                                                 
                IKT_SAUV = VRAI ;                                       
                'SI' ('NEG' WTAB.'LASTKTAN' 'INCONNU') ;                
                       'MESS' 'FEFP: Start with LASTKTAN' ;             
                     ZRIKTA = STAB12.'LASTKTAN' ;                       
                     ZRAID = ZCLIM 'ET' ZRIKTA ;                        
                'SINON' ;                                               
                     'MESS' 'FEFP: Previous KTAN not available' ;       
                     ZRAID = ZRAID 'ET' ('KSIGMA' ZMODL ZSIG0 ZMAT) ;   
                'FINSI' ;                                               
           'SINON' ;                                                    
                'SI' ('NEG' WTAB.'LASTKTAN' 'INCONNU') ;                
                     IKT_SAUV = VRAI ;                                  
                     'SI' IPERT ;                                       
                         'MESS' 'Matrice tangente par perturbation - '  
                         'Demarrage avec KTAN = LASTKTAN' ;             
                     'SINON' ;                                          
                         'MESS' 'Matrice tangente "coherente" - '       
                         'Demarrage avec KTAN = LASTKTAN' ;             
                     'FINSI' ;                                          
                      ZRIKTA = STAB12.'LASTKTAN' ;                      
                      ZRAID = ZCLIM 'ET' ZRIKTA ;                       
                'SINON' ;                                               
                     'SI' IPERT ;                                       
                          IKT_SAUV='NEG' WTAB.'K_TANGENT_ITER0'         
                                   'MAT_ELASTIQUE';                     
                         'MESS' 'Matrice tangente par perturbation - '  
                         'Demarrage avec KTAN = rigidite elastique' ;   
                     'SINON' ;                                          
               IKT_SAUV = ('NEG' WTAB.'K_TANGENT_ITER0' 'MAT_ELASTIQUE')
               'ET' ('NEG' WTAB.'K_TANGENT_ITER0' 'MAT_TANGENTE') ;     
                         'SI' ('EGA' WTAB.'K_TANGENT_ITER0'             
                              'MAT_ELASTIQUE') ;                        
                               'MESS' 'Matrice tangente "coherente" - ' 
                            'Demarrage avec KTAN = rigidite elastique' ;
                         'SINON' ;                                      
                               'MESS' 'Matrice tangente "coherente" - ' 
                               'Demarrage avec KTAN (DTTAN = 0.)' ;     
                               DTTAN = 0. ;                             
                               ZRIKTA = 'KTAN' ZMODL ZSIG0 ZVAR0 ZMAT   
                                    'PREC' ZPREK 'DT  ' DTTAN ZKTASYM ; 
                               ZRAID = ZCLIM 'ET' ZRIKTA ;              
                         'FINSI' ;                                      
                     'FINSI' ;                                          
                'FINSI' ;                                               
           'FINSI' ;                                                    
     'FINSI' ;                                                          
     'SI' (IGRD 'ET' ('NON' HPP_EPS));                                  
           'SI' (IKSIA 'ET' ('NON' IFEFP)) ;                            
                KSI1 ='KSIGMA' ZMODL ZSIG0 ZMAT;                        
                ZRAIDINI=ZRAID;                                         
                ZRAID = ZRAID 'ET' KSI1 ;                               
           'FINSI' ;                                                    
     'FINSI' ;                                                          
                                                                        
     'SI' WTAB.'PROCEDURE_CHAR_MECA';                                   
           PRECED . 'ADDI_MATRICE' = vrai;                              
           TFP22  = CHARMECA  PRECED   WTAB.'T_FINAL';                  
           PRECED . 'ADDI_MATRICE' = faux;                              
           'SI' ('EXIS' TFP22 'ADDI_SECOND');                           
              FP22 = TFP22.'ADDI_SECOND';                               
           'FINS';                                                      
           'SI' ('EXIS' TFP22 'ADDI_MATRICE');                          
              ZRAID=ZRAID 'ET' TFP22.'ADDI_MATRICE';                    
           'FINSI';                                                     
            TFP0= CHARMECA  PRECED   TEMPS0;;                           
          'SI'('EXIS' TFP0 'ADDI_SECOND');                              
             FP0   = TFP0.'ADDI_SECOND';                                
          'FINS';                                                       
          'SI' ('EXIS' TFP0 'ADDI_MATRICE');                            
             ZRAID = ZRAID 'ET' TFP0.'ADDI_MATRICE';                    
          'FINSI';                                                      
            MZPRES0 = 'MAXI' 'ABS' FP0  ;                               
            MZPRES  = 'MAXI' 'ABS' FP22 ;                               
            DMZPRES =  MZPRES - MZPRES0 ;                               
            FP022   = 'COPIER' FP22     ;                               
            COEFP   = 1.D0              ;                               
     'FINSI';                                                           
     ZFCONSTA = 'COPIER' (ZFCONT + ZFEXT2);                             
                                                                        
     'SI' IDYN  ;                                                       
           UNSURH = 1. / STAB12.'DT';                                   
           ZFP1 = WTAB.'FREA1' ;                                        
           ZDYFEXT = ZFCONSTA  'ENLEVER' 'FLX';                         
           XXX1 = ZFCONSTA  +   ZFP1;                                   
           'DETR' ZFCONSTA;                                             
           ZFCONSTA = XXX1;                                             
     'FINSI';                                                           
     ZFEXT = ZFCONSTA  'ENLEVER' 'FLX';                                 
     ZFLX1 = 'EXCO' ZFCONSTA 'FLX' 'NOID' 'FLX' 'NATURE' 'DISCRET';     
     'SI' ('NEG' STAB12.'FFROT' 'INCONNU'); FFROT = STAB12.'FFROT';     
     'SINON' ; FFROT=ZFEXT * 0; 'FINSI';                                
     FFROTP = FFROT;                                                    
     ZF1 = 'BSIGMA' ZMODL ZSIG0 ZMAT ;                                  
     'SI' IRCON;                                                        
           ZF1 =ZF1 + ('REDU' MAI2 ((WTAB.'RIGIDITE_CONSTANTE')*ZU1));  
     'FINSI';                                                           
     'SI'  IDYN  ;  FFDYN = 'COPIER' ZF1; 'FINSI';                      
     'SI' ISOL ;                                                        
           GRAP0= 'GRAD' MO_POR ZU1 MA_POR0 'CONS' ;                    
           XXX1 = 'GRAD' MO_POR ZU1 MA_POR 'CONS' ;                     
           XXXS =((1.- WTAB. 'TETA' )*GRAP0)+ (WTAB. 'TETA' * XXX1);    
           XXX2 = STAB12.'DT' * ('GNFL' MO_POR XXXS) ;                  
           XXX3 = ZF1  ;                                                
           ZF1  = XXX3 - XXX2;'DETR' XXX3;                              
           'DETR' XXX2 ;                                                
     'FINSI';                                                           
     ZZD = 'ENLEVER' ZU1 'LX';                                          
     ZLX = ZU1  'EXCO' 'LX' 'NOID' 'LX' 'NATURE' 'DIFFUS';              
     FLXINI= ZZD * ZCLIM;                                               
     FREAP = ZLX * ZCLIM;                                               
     FEXT0 = ZF1 + FREAP;                                               
     XXX1 = ZFCONSTA - FLXINI ;                                         
     DFEXT0 = XXX1 - FEXT0;                                             
     'SI' WTAB.'PROCEDURE_CHAR_MECA'; DFEXT0 = DFEXT0 + FP0;'FINSI';    
     DFEXT0F = DFEXT0 'ENLEVER' 'FLX';                                  
     DFEXT0L = DFEXT0 'EXCO' 'FLX' 'NOID' 'FLX';                        
     XXX2 = FTHE + FDEF + XXX1;                                         
     RESIDU = XXX2 - ZF1;'DETR' XXX1; 'DETR' XXX2;                      
     ZDFINI = 'COPIER' DFEXT0 ;                                         
     ZFPLO= -1*FTHE - FDEF + ZF1 ;                                      
     'SI' (ITHER 'OU' WTAB.'MATVAR')  ;ZDFINI=ZDFINI + FTHE;'FINSI';    
     'SI' LOGDEF; ZDFINI= ZDFINI + FDEF; 'FINSI';                       
     'SI' WTAB.'PROCEDURE_CHAR_MECA' ;                                  
          RESIDU = RESIDU + FP22  ;                                     
          ZDFINI = ZDFINI + FP22  - FP0 ;                               
     'FINSI';                                                           
      IMPO12=FAUX;XXX1 = 'EXTR' ZCLIM 'MAIL' 'UNIL';                    
     'SI' ( ('NBEL' XXX1) > 0);                                         
          IMPO12 = VRAI;                                                
          DIMPO12='REDU' DFEXT0L XXX1;                                  
          DIMPOV= DFEXT0L - DIMPO12;                                    
     'FINSI';                                                           
      stab12.'SECOND_MEMBRE' = residu * 1.;                             
                                                                        
                                                                        
     'SI' ('EXIS' STAB12 'RIBLO_M' ) ;                                  
         'SI' (  WTAB. 'CAFROTTE'  );                                   
            ZDEP1 BID BID BID BID = 'RESOU' ZRAID RESIDU 'INIB'         
                                            STAB12.'RIBLO_M'            
                                            STAB12.'LISEA_M' FFROT;     
         'SINON';                                                       
            ZDEP1 BID BID BID     = 'RESOU' ZRAID RESIDU 'INIB'         
                                            STAB12.'RIBLO_M'            
                                            STAB12.'LISEA_M'      ;     
         'FINSI';                                                       
         'OUBLIER' STAB12.'RIBLO_M';                                    
     'SINON';                                                           
         'SI' (WTAB. 'CAFROTTE');                                       
               ZDEP1 = 'RESOU' ZRAID RESIDU FFROT;                      
         'SINON';                                                       
               ZDEP1 = 'RESOU' ZRAID RESIDU;                            
         'FINSI';                                                       
     'FINSI';                                                           
                                                                        
      ZRAID_T = 'EXTR' ZRAID 'CONT';                                    
                                                                        
     'SI'  IDYN;                                                        
        STAB12.'ZRAIDV'= ZRAID;                                         
     'FINSI';                                                           
                                                                        
     'SI' (exis WTAB 'RENORMALISATION');                                
          'SI' (WTAB . 'RENORMALISATION');                              
             coefmul = 1.;                                              
             DEPS1 = EPSI 'LINE' ZMODL ZDEP1 ZMAT;                      
             DPS1MAX = MAXI 'ABS' DEPS1 'AVEC' MLDEFOR ;                
             'SI' (DPS1MAX > WTAB . 'MAXDEFOR');                        
                 coefmul = WTAB . 'MAXDEFOR' / DPS1MAX;                 
                ZDEP1 = coefmul * ZDEP1;                                
    mess 'MAXDEFOR dÈpassÈ : Renormalisation initiale par ' coefmul;    
             'FINSI';                                                   
          'FINS';                                                       
     'FINS';                                                            
     'SI' ('EXIS' WTAB 'DEPI');                                         
           zdeptini = WTAB.'DEPI';                                      
      'SINON';                                                          
           zdeptini = zdep1;                                            
      'FINSI';                                                          
     XXX1= ZFEXT;                                                       
     'SI' WTAB.'PROCEDURE_CHAR_MECA';                                   
        XXX1=ZFEXT+FP22;                                                
     'FINSI';                                                           
                                                                        
     ZDEP1P50 = ZDEP1 + 1D-50 ;                                         
     XDENO='XTY' ZDEP1P50  ( XXX1 -( RESIDU  'EXCO'                     
        'FLX' 'NOID' 'FLX' 'NATURE' 'DISCRET')) MLPRIM MLDUAL;          
     MZDEP1M = 'MAXI' ZDEP1P50 'ABS' 'AVEC' MLDEPL;                     
     MZFM = 'MAXI' (FTHE + FDEF + ZF1) 'ABS' 'AVEC' MLDUAL;             
     MZFM = MZFM + 1D-50 ;                                              
     XDENO1 = 'ABS' XDENO  + (MZFM * MZDEP1M);                          
     XDENO=XDENO1/MZDEP1M;                                              
     XDENO = XDENO + MZFM;                                              
     XDENOM=XDENO;                                                      
     'SI' TSTMOM ;                                                      
        XDENOM = XDENO1/('MAXI' ZDEP1P50 'ABS' 'AVEC' MLROTA);          
     'FINSI' ;                                                          
     'SI' IPILOT ;                                                      
           'SI' ( WTAB.'AUTODEUX' ) ;                                   
              XDENO = STAB12.'XDENO';                                   
              XDENOM = STAB12.'XDENOM';                                 
           'FINSI';                                                     
     'FINSI';                                                           
     'SI' ('NON' WTAB.'CONV');                                          
           XDENO = STAB12.'XDENO';                                      
           XDENOM = STAB12.'XDENOM';                                    
     'FINSI';                                                           
                                                                        
     IAFAIR=FAUX;                                                       
     'SI'  WTAB.'CONV';                                                 
     STAB12.'INCREMENT' = 'COPIER' ZDFINI ; 'FINSI';                    
     RESIDNOR = 'COPIER' RESIDU ;                                       
     'SI' IPILOT;                                                       
            XXX3=DFEXT0F * ( 1-COEPI) ;                                 
            XXX2 = ZFEXT - XXX3;'DETR' XXX3;                            
           'DETR' ZFEXT; ;ZFEXT = XXX2;                                 
            XXX1 = RESIDU * COEPI; 'DETR' RESIDU;                       
            XXX2 = 1.D0 -COEPI * FREAP;RESIDU = XXX1 + XXX2;            
           'SI' IMPO12;                                                 
                RESIDU = 1.D0 - COEPI * DIMPO12 + RESIDU;               
           'FINSI';                                                     
           IAFAIR=VRAI;                                                 
     'FINSI';                                                           
     INIT = FAUX ;                                                      
     'SI'(('NEG' STAB12.'FNONL' 'INCONNU') 'ET'                         
           (WTAB.'INITIALISATION'));                                    
        'SI' IPILOT;                                                    
              'SI' ( WTAB.'AUTODEUX' 'ET' (COEPI 'NEG' 1.D0)) ;         
              'MESS' 'Initialisation a partir du pas precedent '  COEPI;
                    IAFAIR=VRAI; INIT = VRAI;                           
                     XXX1= RED1 * STAB12.'FNONL';                       
                     XXX2= XXX1 + RESIDU ;                              
                    'DETR' RESIDU ;'DETR' XXX1 ;RESIDU =XXX2;           
               'FINSI' ;                                                
        'SINON';                                                        
            'SI' WTAB.'CONV';                                           
              'SI' (('MAXI' 'ABS' STAB12.'FNONL') > (ZPREC * XDENO)) ;  
                STAB12.'INCREMENT'=STAB12.'INCREMENT' - STAB12.'RESIDU';
                    zdeps = WTAB.'ZDEP1' + zdep1;                       
                    FFNO= 'XTY' STAB12.'FNONL' zdeps  MLDUAL MLPRIM;    
                    F1 = STAB12.'INCREMENT' ;                           
                    F2 = INCRPREC ;                                     
                    f12 = 'XTY' f1 zdeps MLDUAL MLPRIM;                 
                    f22 = 'XTY' f2 zdeps MLDUAL MLPRIM;                 
                    AMPL = f12/(f22 + 1d-30);                           
                    DTPREC=1E30; AMPLT = 0;                             
                    'SI' ('NEG' STAB12.'DTPREC' 'INCONNU');             
                         DTPREC = STAB12.'DTPREC';                      
                         'SI' (DTPREC > 1E-30);                         
                             AMPLT=WTAB.'DT_INIT' /DTPREC;              
                         'FINSI';                                       
                     'FINSI';                                           
                    XDCOMP = ('XTY' ZDEP1 F1 MLPRIM MLDUAL) ;           
                   'SI' (('ABS' XDCOMP) < (ZPREC * XDENO * mzdep1m)     
                        'OU' (('ABS' FFNO) > (('ABS' F22) * 2.e2   ))); 
                        DTPREC = STAB12.'DTPREC';                       
                        AMPL=AMPLT;                                     
                      'SI'((F12/(f22 + 1.d-20)) < -0.05);ampl=0.;'FINS';
                        STAB12.'INITEMPS'=VRAI;LOGTEMP=FAUX;;           
                        'MESS'                                          
'Pas d increment de charge, initialisation calculee avec le temps';     
                   'SINON';                                             
                        AMPL = F12 / (F22 + 1d-30);                     
                        LOGTEMP=STAB12.'INITEMPS';                      
                        STAB12.'INITEMPS'=FAUX;                         
                   'FINSI';                                             
                    AMPL = MINI (prog AMPL AMPLT);                      
                   'SI' ((AMPL > 0) 'ET' (AMPL < 2e1)) ;                
      'MESS' 'Initialisation a partir de la solution precedente Coeff'  
                         AMPL;                                          
                         XXX1 = AMPL * STAB12.'FNONL';                  
                         XXX2 =RESIDU+ XXX1;                            
                         'DETR' XXX1;'DETR' RESIDU;                     
                         RESIDU = XXX2;                                 
                         IAFAIR=VRAI; INIT = VRAI;                      
                   'FINSI';                                             
              'FINSI';                                                  
            'FINSI';                                                    
        'FINSI';                                                        
     'FINSI';                                                           
     WTAB.'ZDEP1'=zdep1;                                                
     'SI' IPLAVI ;                                                      
          'SI' ('NEG' WTAB.'MOVA' 'RIEN') ;                             
                  ACC0 = 'EXCO' (WTAB.'MOVA') ZVAR0 ;                   
          'FINSI' ;                                                     
     'FINSI' ;                                                          
     IKT =  FAUX ;                                                      
     IPREM =  VRAI ; RECA_K = FAUX; RECA_N = 0;                         
     DEPSTP = 'ZERO' ZMODL 'DEFORMATIONS' ;                             
     DEPSTK = DEPSTP ;                                                  
     iafair = vrai;                                                     
     PASTEST = FAUX;                                                    
     ZITAC= 0 ;                                                         
     ACFP1  = 'COPIER' ZFEXT2 *0. ;                                     
     ACFP2  = ACFP1 ;                                                   
     ZDEPLD = ACFP1 ;                                                   
     ACFP3  = ACFP1 ;                                                   
     ACFEP1 = ACFP1 ;                                                   
     ACFEP2 = ACFP1 ;                                                   
     FCORF  = 'COPIER' FREAP;                                           
     XCONVMIN = 1e20;                                                   
     DPSMREF  = 0  ;                                                    
     XCONV    = 0. ;                                                    
     XCONVP   = 1. ;                                                    
     NSOINCR  = 1  ;                                                    
     'SI' ('NEG' WTAB.'SOUS_INCREMENT'  'INCONNU') ;                    
         NSOINCR = WTAB.'SOUS_INCREMENT' ;                              
     'FINSI';                                                           
     NONCONV = FAUX;                                                    
     CORREC=0;                                                          
     PASREINI=VRAI;                                                     
     coefmt=1.;                                                         
     'SI' IKLFFF ;                                                      
          'MESSAGE'                                                     
' Iter   Nplas     Critere        Deps.max       Eps.max      Crit.flex'
;                                                                       
     'SINON';                                                           
         'MESSAGE'                                                      
' Iter   Nplas     Fresidu        Deps.max       Eps.max      Mresidu  '
;                                                                       
     'FINSI';                                                           
'REPETER'  ETIQ ;                                                       
IT= IT + 1 ;                                                            
ITACC = ITACC - 1;                                                      
ZITAC = ZITAC + 1 ;                                                     
CORRECP = CORREC;                                                       
CORREC = 0;                                                             
PASTEST=FAUX;                                                           
ACFP0 = (RESIDU  - FCORF) 'ENLE' FLX ;                                  
ACFEP0 = ACFP0;                                                         
ACFEP0 = ACFEP0 - CORRECP ;                                             
'SI' IGRD ;                                                             
  'FORM' GEOM1;                                                         
  'SI' ((&etiq '>EG' 2) 'ET' ((DEKREAC1 > EKREAC)                       
      'OU' URG 'OU'(ITACC >EG 4)) 'OU' (FAUX     ));                    
      URG=FAUX;                                                         
      sigttcca=  zsigf ;                                                
      geor='FORM' zdept;                                                
      zdepr = zdept;                                                    
      c_zdepr = faux;                                                   
      RECA_K = VRAI;                                                    
      RECA_N = RECA_N + 1;                                              
                                                                        
     'SI' (RECA_N > 20) ;                                               
        nonconv = vrai;                                                 
     'FINSI';                                                           
                                                                        
      txt_k = chai ' Recalcul de K (= K^el';                            
      ritc = 'RIGI'  zmodl zmat;                                        
      CRR =  0;                                                         
     'SI' WTAB.'CONTACT';                                               
        ZFCONT = 'VIDE' 'CHPOINT' / 'DISCRET';                          
        ZCLIM  =  WTAB.'CLIM';                                          
        freacav = zclim * zdetot enle 'FLX';                            
        modcon= wtab.'MODCONTA';                                        
        WTAB.'CONT_REEL'=modcon;                                        
       'SI' ('EXIS' WTAB 'MAT_JEU');                                    
          CDAP CRR RFROT= 'RFCO' modcon  WTAB.'CONV'  WTAB.'MAT_JEU';   
       'SINON' ;                                                        
           CDAP CRR RFROT= 'RFCO' modcon  WTAB.'CONV'  ;                
       'FINSI' ;                                                        
                                                                        
       'SI' (WTAB . 'MODAL') ;                                          
          CRR  = 'PJBA' CRR  ZMODL MMMM ;                               
          MCRR = 'EXTR' CRR 'MAIL' 'MULT' ;                             
          MCDAP = 'EXTR' CDAP 'MAIL' ;                                  
                                                                        
         'REPETER' BCDA ('NBNO' MCDAP) ;                                
            PBCDA = MCDAP 'POINT' &BCDA ;                               
            PCRR  ='POINT' MCRR &BCDA   ;                               
            CHCR  ='MANU' 'CHPO' PCRR 1 'FLX' ('EXTR' CDAP 'FLX' PBCDA) 
                   'NATURE' 'DISCRETE' ;                                
           'SI' ('EGA' 1 &BCDA) ;                                       
              CCDA = CHCR ;                                             
           'SINON' ;                                                    
              CCDA = CCDA 'ET' CHCR ;                                   
           'FINSI' ;                                                    
         'FIN' BCDA ;                                                   
                                                                        
          CDAP = CCDA ;                                                 
       'FINSI' ;                                                        
          ZCLIM  =  WTAB.'CLIM';                                        
          ZCLIM2 = 0;                                                   
          'SI'  ('NEG' CRR 0);                                          
               ZCLIM2 =  CRR ;                                          
               CCOR = CRR * ((zdept + zu1) 'ENLE' 'LX');                
               ZFCONT = ZFCONT + CCOR;                                  
          'FINSI';                                                      
          'SI' ( 'NEG' 0 CDAP);                                         
               ZFCONT = ZFCONT + CDAP;                                  
          'FINSI';                                                      
          'SI' ('NEG' 0 RFROT);                                         
            'SI'  ('EGA' ZCLIM2 0);                                     
               ZCLIM2 =  RFROT ;                                        
            'SINON';                                                    
                 ZCLIM2 = RFROT 'ET' ZCLIM2;                            
            'FINSI';                                                    
               CCOR  = RFROT * CDEPSLX ;                                
               ZFCONT = ZFCONT + CCOR;                                  
          'FINSI';                                                      
       ZFCONSTA = 'COPIER' (ZFCONT + ZFEXT2);                           
       'SI' IDYN; ZFCONSTA = ZFCONSTA + ZFP1; 'FINSI';                  
      'SI'  ('NEG' ZCLIM2 0);                                           
         ZCLIM = ZCLIM2 'ET' ZCLIM;                                     
     'FINSI';                                                           
        freacap = zclim * zdetot 'ENLE' 'FLX';                          
        residu = residu + freacav - freacap;                            
     'FINSI';                                                           
     ZFLX1 = 'EXCO' ZFCONSTA 'FLX' 'NOID' 'FLX' 'NATURE' 'DISCRET';     
       ZRAID=  ZCLIM 'ET' ritc;                                         
      'SI' iksia ;                                                      
       ksigtc= 'KSIGM' sigttcca zmodl zmat;                             
       ZRAID= ZRAID 'ET' ksigtc;                                        
      'FINSI';                                                          
       'SI' IRCON;                                                      
        ZRAID = ZRAID 'ET' (WTAB . 'RIGIDITE_CONSTANTE');               
        txt_k = chai txt_k ' + K^cst';                                  
       'FINSI';                                                         
       'SI' WTAB.'PROCEDURE_CHAR_MECA';                                 
         PRECED . 'ADDI_MATRICE' = vrai;                                
         TFP22= CHARMECA  PRECED   WTAB.'T_FINAL';                      
         PRECED . 'ADDI_MATRICE' = faux;                                
         'SI' (EXIS TFP22 'ADDI_MATRICE');                              
            zraid = zraid 'ET' TFP22.'ADDI_MATRICE';                    
            txt_k = chai txt_k ' + K^cent';                             
         'FINSI';                                                       
      'FINSI';                                                          
      'SI' IDYN;                                                        
         MMA= WTAB.'MASSE' * ( 4.D0 / WTAB.'DT' / WTAB.'DT');           
         ZRAID= ZRAID 'ET' MMA;                                         
      'FINSI';                                                          
      mess ( chai txt_k ' ) dans config deformee ' DEKREAC1 );          
      'FORM' GEOM1;                                                     
      'DETR' GEOR;                                                      
      'SI' (IT 'EGA' 2) ;                                               
         ITACC = 5 ;                                                    
      'SINO' ;                                                          
         ITACC = 3 ;                                                    
      'FINS' ;                                                          
      GR_U_K  = GR_U_FIN ;                                              
      zdeptm = zdept ;                                                  
  'FINSI';                                                              
'FINSI';                                                                
                                                                        
'SI' (('NON' (NONCONV 'ET' ZICONV))        'ET' ('MULT' IT ZNACCE)      
                      'ET' (ITACC '<EG' 0) 'ET' (IT '>' 3) );           
   CORREC = 'ACT3' ACFEP2  ACFEP1 ACFEP0                                
            ACFP3 ACFP2 ACFP1  ACFP0 ;                                  
   RESIDU = RESIDU - CORREC;                                            
  'DETR' ACFP3; 'DETR' ACFEP2;                                          
'FINSI';                                                                
 ACFP3  = ACFP2  ;                                                      
 ACFP2  = ACFP1  ;                                                      
 ACFP1  = ACFP0  ;                                                      
 ACFEP2 = ACFEP1 ;                                                      
 ACFEP1 = ACFEP0 ;                                                      
'SI' IAFAIR;                                                            
  'SI' ( ('EXIS' STAB12 'RIBLO_M') 'ET' (IPREM 'OU' RECA_K) ) ;         
    'SI' ( WTAB.'CAFROTTE'  );                                          
       ZDEP1 BID BID BID BID = 'RESOU' ZRAID RESIDU 'INIB'              
                              STAB12.'RIBLO_M'   STAB12.'LISEA_M' FFROT;
    'SINON';                                                            
       ZDEP1 BID BID BID     = 'RESOU' ZRAID RESIDU 'INIB'              
                              STAB12.'RIBLO_M'   STAB12.'LISEA_M' ;     
    'FINSI';                                                            
                                                                        
  'SINON';                                                              
    'SI' ( WTAB.'CAFROTTE'  );                                          
      ZDEP1 = 'RESOU' ZRAID RESIDU FFROT ;                              
    'SINON';                                                            
      ZDEP1 = 'RESOU' ZRAID RESIDU;                                     
      'SI' (WTAB.'MAN' 'ET' IPREM);                                     
          ORDRE      = WTAB.'ORDRE' ;                                   
          ZDEP2 IOUT = CORMAN ZRAIDINI ZMODL ZMAT  ORDRE                
                       ZU1 ZSIG0      RESIDNOR  WTAB ;                  
          'SI' (IOUT 'EGA' 1) ;                                         
             ZDEP1=ZDEP2;                                               
          'FINSI';                                                      
      'FINSI';                                                          
    'FINSI';                                                            
  'FINSI';                                                              
                                                                        
                                                                        
  ZRAID_T = 'EXTR' ZRAID 'CONT';                                        
  'SI' ('EXIS' ZRAID_T 'NITER');                                        
       'SI' IDYN ; STAB12.'ZRAIDV'= ZRAID; 'FINSI';                     
        STAB12.'RIBLO_M' = ZRAID_T.7;                                   
        STAB12.'LISEA_M' = ZRAID_T.6;                                   
  'FINSI';                                                              
'FINSI';                                                                
RECA_K = FAUX;                                                          
'SI' ('EXIS' WTAB 'RENORMALISATION');                                   
    'SI' (WTAB . 'RENORMALISATION');                                    
        coefmul = 1.;                                                   
        DEPS1 = EPSI 'LINE' ZMODL ZDEP1 ZMAT;                           
        DPS1MAX = MAXI 'ABS' DEPS1 'AVEC' MLDEFOR ;                     
        'SI' (DPS1MAX > WTAB . 'MAXDEFOR');                             
            coefmul = WTAB . 'MAXDEFOR' / DPS1MAX;                      
            'SI' IPREM;                                                 
                ZDEP1 = coefmul * ZDEP1 ;                               
            'SINO';                                                     
                ZDLX0 = ZDEPTP 'EXCO' 'LX' 'NOID' 'LX';                 
                ZDEP1 = (coefmul * ZDEP1) + ((1.-coefmul) * ZDLX0);     
                'DETR' ZDLX0;                                           
            'FINS';                                                     
         'MESS' 'MAXDEFOR dÈpassÈ : Renormalisation de l iteration par '
            coefmul;                                                    
        'FINSI';                                                        
    'FINSI';                                                            
'FINSI';                                                                
'REPETER' bzdept2 7;                                                    
'SI' WTAB.'STABILITE';                                                  
     sens = xty ((residu enle 'FLX') +                                  
     (-1 * residu exco 'FLX' 'NOID' 'FLX'))  zdep1  MLDUAL MLPRIM;      
     nbneg = diagn zraid;                                               
     'SI' (( nbneg > 0));                                               
     ZDEP1  = (zdep1 enle lx) * -0.2 et (zdep1 exco 'LX' 'NOID' 'LX') ; 
     'MESS' 'instabilite detectee' nbneg sens;                          
     HPP_EPS = FAUX;                                                    
     'FINSI';                                                           
'FINSI';                                                                
'SI'   IPREM  ;                                                         
          ZDEPT  = 'COPIER' ZDEP1 ;                                     
          ZDEPTM = ZDEPT ;                                              
          ZDEPTP = ZDEPT ;                                              
          ZDELA  =   'COPIER' ZDEPT ;                                   
          'SI' (WTAB . 'MODAL') ;                                       
             'SI' ('EXISTE' WTAB 'MODCONTA') ;                          
                mamoco1 = 'EXTR' (ZDEPT 'ENLEVER' 'LX') 'MAIL' ;        
             'FINSI';                                                   
          'FINSI' ;                                                     
'SINON';                                                                
        XXX1   = ZDEPT 'ENLEVER' 'LX' ;                                 
        zdeptp = ZDEPT ;                                                
        zsigfp = zsigf ;                                                
        fcorfp = fcorf ;                                                
        zclimp = zclim ;                                                
                                                                        
        ZDEPT  = XXX1 + ZDEP1 ;                                         
       'DETR' XXX1 ;                                                    
'FINSI' ;                                                               
'SI' (WTAB . 'MODAL') ;                                                 
     'SI' ('EXISTE' WTAB 'MODCONTA') ;                                  
         zdeptu1 =  'REDU' zdept   mamoco1      ;                       
         ch_dco  =  'RECO' zdeptu1 ZMODL ZMATIN ;                       
         ZDEPT   = ('EXCO' zdept 'LX' 'LX') 'ET' zdeptu1 et ch_dco ;    
     'FINSI';                                                           
'FINSI' ;                                                               
                                                                        
ACC_Q = FAUX;  ACC_R = VRAI;                                            
'REPETER' bzdept 40;                                                    
 nsoincr = 1;                                                           
'SI' ((IT '>' 5   ) 'ET' (DPSMAX '>' 0.)'ET' (&BZDEPT 'EGA' 1)) ;       
  coefmul = WTAB.maxdefor / (DPSMAX+1e-30) ;                            
 'SI' (XCONV > TABCONV.(IT - 2) ) ;                                     
  'SI' ((NONCONV 'ET' ((coefmul < zprec) 'OU' (dpsmax*1e4 < zprec))) ); 
    coefmul = coefmul * 1e-1;                                           
     ZDEPT = zdept* coefmul ;                                           
     'SI' ((RED_URG > 1) 'ET' NONCONV);                                 
       zflx1 = flxini + ((zflx1 - flxini) * 0.5  );                     
     'FINSI';                                                           
     RED_URG = RED_URG + 1;                                             
    ZNACCE = 999;                                                       
    'MESS' ' Renormalisation de l increment de deplacement'             
    dpsmax coefmul;                                                     
    'SI' (DEPSTDM '>' DEPSTREF) ;                                       
      DEPSTREF = 2. * DEPSTDM ;                                         
    'FINS' ;                                                            
    'SI' NONCONV ;                                                      
      'SI' (ITNORM1 'EGA' 0) ;                                          
        ITNORM1  = IT ;                                                 
      'SINO' ;                                                          
        'SI' (DITNORM1 'EGA' 0) ;                                       
          XCONVNOR = 2. * XCONV ;                                       
          DITNORM1 = IT - ITNORM1 ;                                     
          ITNORM1  = IT ;                                               
        'SINO' ;                                                        
          'SI' (XCONV '<EG' XCONVNOR) ;                                 
            XCONVNOR = 2. * XCONV ;                                     
            'SI' ((IT - ITNORM1) 'EGA' DITNORM1) ;                      
              NBCYCLE1 = NBCYCLE1 + 1 ;                                 
              'SI' (NBCYCLE1 'EGA' 2) ;                                 
                'MESS'                                                  
            ' Renormalisation cyclique en non-convergence detectee ' ;  
              'FINS' ;                                                  
            'FINS' ;                                                    
            DITNORM1 = IT - ITNORM1 ;                                   
            ITNORM1  = IT ;                                             
          'FINS' ;                                                      
        'FINS' ;                                                        
      'FINS' ;                                                          
    'FINS' ;                                                            
  'FINSI' ;                                                             
 'FINSI' ;                                                              
'FINSI';                                                                
                                                                        
'SI' ((XCONV > 1E8) 'ET' PASREINI 'ET' ('NON' IPILOT)) ;                
        'MESS' 'Reinitialisation du schema';                            
        XXX1 = ZDEPT 'ENLEVER' 'LX' ;                                   
        ZDEPT = ZDEPT - XXX1 ;                                          
        PASREINI=FAUX;                                                  
        ITACC=3;                                                        
'FINSI';                                                                
                                                                        
'SI' (('MULT' IT ZNACCE)  'ET' (ITACC '<EG' 0)) ;                       
                                                                        
    'SI' IPILOT;                                                        
              RED1 = STAB12.'AUTOREDU' ;                                
                                                                        
                                                                        
           'SI' (RED2 < (IT/20));                                       
                STAB12.'AUTOREDU' = STAB12.'AUTOREDU' * 3. ;            
                RED2 = RED2 + 1 ;                                       
                ITACC= 3;                                               
           'FINSI';                                                     
                                                                        
            RED1 = RED1 / (STAB12.'AUTOREDU') ;                         
            'SI' (RED1 < 0.9) ;  STAB12.AUTORED1 = 10 ; 'FINSI' ;       
                                                                        
            'SI' ( STAB12.'AUTOREDU' > 1.D0 ) ;                         
               'MESS' 'On divise le critere de pilotage par '           
                STAB12.'AUTOREDU';                                      
            'FINSI' ;                                                   
                                                                        
            'SI' IPLAVI ;                                               
                  XXX2 = 'EXCO' ZDEPT  'LX' 'NOID' 'LX' ;               
                  XXX1= 2. * XXX2;XXX3 = ZDEPT -XXX1;                   
                                                                        
                  SRE = 'XTY' ZDFINI XXX3 MLDUAL MLPRIM;                
            'SINON' ;                                                   
                  XXX1=COEPI * ZDELA;XXX3 = ZDEPT - XXX1;               
                  XXX2 = 'EXCO' XXX3 'LX' 'NOID' 'LX';                  
             'DETR' XXX1;'DETR' XXX3;XXX1=XXX2 *2.;XXX4=COEPI* ZDELA;   
                  XXX3= ZDEPT - XXX4;'DETR' XXX4;XXX4=XXX3 -XXX1;       
                SRE = 'XTY' ZDFINI XXX4  MLDUAL MLPRIM ; 'DETR' XXX4;   
           'FINSI' ;                                                    
           'DETR' XXX2 ;'DETR' XXX1; 'DETR' XXX3;                       
            XXX1 = 'EXCO' ZDEPT 'LX' 'NOID' 'LX' ;XXX2=XXX1* 2.;        
            XXX3= ZDEPT - XXX2;                                         
            SRT = 'XTY' ZDFINI XXX3 MLDUAL MLPRIM;                      
           'DETR' XXX1 ;  'DETR' XXX2; 'DETR' XXX3;                     
                                                                        
            ISNPB = FAUX;                                               
           'SI'  (SRT < 0) ;                                            
                ISNPB = VRAI ;                                          
           'FINSI';                                                     
                                                                        
            OO = WTAB.AUTOCRIT ;                                        
            OO = OO / STAB12.'AUTOREDU' ;                               
            U1MA = AUTOPILO ZDEPT (COEPI*ZDELA) ZMODLI ZMATIN WTAB;     
            AL1 = OO / U1MA ;                                           
           'SI' (( al1 '>EG' 1.d0) 'ET' (coepi '>EG' 1.d0)) ;           
                 AL1 = 1.d0 ;                                           
           'FINSI' ;                                                    
            'SI'((AL1 '>' 1.D0) 'ET' (COEPI '>' 0.D0));                 
              'SI' ( AL1 '>' (1.D0 /COEPI));                            
                   AL1 = 1.D0 /COEPI;                                   
              'FINSI';                                                  
            'FINSI';                                                    
                                                                        
              PASTEST=VRAI;XXX1 = ZLX *( 1.d0 -AL1);                    
              XXX3=ZDEPT * AL1;XXX2 = XXX3 + XXX1;                      
             'DETR' XXX3;ZDEPT=XXX2;                                    
    'FINSI';                                                            
'SINON';                                                                
      'SI' IPILOT ;                                                     
            OO = WTAB.'AUTOCRIT' ;                                      
            OO = OO / STAB12.'AUTOREDU' ;                               
            U1MA = AUTOPILO ZDEPT (COEPI*ZDELA) ZMODLI ZMATIN WTAB;     
            AL1 = OO / U1MA ;                                           
           'SI' (( AL1 '>EG' 1.d0) 'ET' (COEPI '>EG' 1.d0)) ;           
                 AL1 = 1.d0 ;                                           
           'FINSI' ;                                                    
      'FINSI' ;                                                         
'FINSI';                                                                
ZDEPLP = ZDEPL                         ;                                
ZDEPL  = ZDEPT 'EXCO' 'LX' 'NOID' 'LX' ;                                
                                                                        
                                                                        
'DETRUIRE' FCORF;                                                       
ZDETOT = ZZD + ZDEPT;                                                   
XXX1= ZCLIM * ZDETOT;                                                   
FCORF = 'ENLEVER'  XXX1 'FLX';                                          
FCORU = 'EXCO'  XXX1 'FLX'  'NOID' 'FLX';                               
'DETR' XXX1 ;                                                           
ZMATT = ZMAT    ;                                                       
'SI' ('ET' ('ET' ITHER ('OU' IENDOM IVIDOM ) ) WTAB.'MATVAR')  ;        
      ZMATT = (WTAB.'MA_COMP')  'REDU' ZMODL;                           
'FINSI';                                                                
                                                                        
'SI' IFEFP;                                                             
  'SI' IFEFPUL;                                                         
    GEOM2 = 'FORM' ZDEPT ;                                              
    ZRIKTA ZSIGF ZVARF ZDEIF = 'ECFEFP'                                 
         ZMODL ZEPS0 ZVAR0 ZDEPT ZMAT ZPREK NITMA XUPDA;                
  'SINON';                                                              
    chp_z = ZDEPT + ZU1 ;                                               
    GEOM2 = 'FORM' chp_z ;                                              
    ZRIKTA ZSIGF ZVARF ZDEIF = 'ECFEFP'                                 
         ZMODL ZEPS0 ZVAR0 chp_z ZMAT ZPREK NITMA ;                     
    chp_z = 1 ;                                                         
  'FINSI';                                                              
  FEQU2 = 'BSIGMA' ZMODL ZSIGF ZMAT ;                                   
  ZRAID = ZRIKTA 'ET' ZCLIM ;                                           
   'FORM' GEOM1 ;                                                       
  XXX1 = 'EXCO' (WTAB.'MOVA') ZVARF ;                                   
  EPSM = 'MAXI' XXX1 'AVEC' MLDEFOR ;                                   
  ACC  = 'ABS' ( XXX1 - ACC0 ) ;                                        
  MMC = 'MASQUE' ACC 'SUPERIEUR' 1.D-10 'SOMME' ;                       
  'SI' (MMC > MMCMAX) ; MMCMAX = MMC ; 'FINSI' ;                        
  DPSMAXP = DPSMAX ;                                                    
  DPSMAX  = 'MAXI' ACC 'AVEC'  MLDEFOR ;                                
  DEPST   = 'CHAN' 'TYPE' ZDEIF 'DEFORMATIONS' ;                        
                                                                        
  GR_U_FIN= 'MOT' 'INCONNU';                                            
                                                                        
'SINON';                                                                
  ZMAT05=ZMAT;                                                          
    'SI' (EPS_NLIN 'ET' IGRD);                                          
       zdepm = zdept * 0.5;                                             
      'SI' ITCAR ;                                                      
         GEOTEMP ZMATTEMP = 'FORM' ZDEPM ZMODLI ZMAT05 ;                
         ZMATTEMP = 'REDU' ZMATTEMP ZMODL ;                             
         DEPST    = 'EPSI' 'LINE' 'NOER' ZMODL ZDEPT ZMATTEMP ;         
        'FORM' geom1 ;                                                  
        'DETR' GEOTEMP ZMATTEMP ;                                       
      'SINON' ;                                                         
         GEOTEMP  = 'FORM' ZDEPM ;                                      
         DEPST    = 'EPSI' 'LINE' 'NOER' ZMODL ZDEPT ZMAT05 ;           
        'FORM' geom1 ;                                                  
        'DETR' GEOTEMP;                                                 
      'FINSI' ;                                                         
       PASOK = FAUX;                                                    
                                                                        
      'SI' ((NBPART < 1) 'OU' PARTLOCA 'OU' ('NON' PARALLEL));          
         'SI' ('EGA' ('TYPE' DEPST) 'ENTIER');                          
           PASOK = VRAI;                                                
         'FINSI';                                                       
      'SINON';                                                          
         'REPETER' BTEST ('DIME' DEPST - 2);                            
          'SI' ('EGA' ('TYPE' (DEPST . &BTEST) ) 'ENTIER');             
             PASOK = VRAI;                                              
          'FINSI';                                                      
         'FIN' BTEST;                                                   
      'FINSI';                                                          
                                                                        
      'SI' ('NON' PASOK);                                               
         DEPST = CAPI DEPST ZMODL ZDEPM ;                               
        'SI' ('MAXI' 'ABS' DEPST > 2);                                  
           PASOK = VRAI;                                                
        'FINSI';                                                        
                                                                        
      'FINSI';                                                          
                                                                        
      'SINON';                                                          
         PASOK = vrai;                                                  
      'FINSI';                                                          
                                                                        
      'SI' PASOK;                                                       
         zdepm =  0. * zdept;                                           
         DEPST='EPSI' 'LINE'  ZMODL ZDEPT ZMAT05  ;                     
      'FINSI';                                                          
                                                                        
      'SI' IPLAVI;                                                      
        'SI' ('OU' ('OU' IENDOM IVIDOM)  ICERAM);                       
           HOOKENDO = 'HOOK'          ZMODL ZMAT05 ZVAR0          ;     
           DEPST    = 'EPSI' 'LINE'   ZMODL ZDEPT  HOOKENDO ZMAT05;     
        'FINSI';                                                        
                                                                        
        'SI' (ITHER 'OU' WTAB.'MATVAR') ;                               
           XXX1 = DEPST0 * COEPI;                                       
           XXX2 = DEPST - XXX1;                                         
           DEPST = XXX2 ;                                               
        'FINSI' ;                                                       
                                                                        
        'SI' LOGDEF  ;                                                  
           XXX1 = DDEFOR0 * COEPI;                                      
           XXX2 = DEPST - XXX1;                                         
           DEPST = XXX2 ;                                               
        'FINSI' ;                                                       
                                                                        
      'SINON';                                                          
       DSIGT= 'ELAS'  ZMODL DEPST ZMAT05 ;                              
        'SI' (('NON' ITHER) 'ET' WTAB.'MATVAR') ;                       
           XXXXX3 = 'ELAS' ZMODL ZSIG0 ZMAT05 ;                         
           XXXXX4 = 'ELAS' ZMODL ZSIG0 ('REDU' ZMODL STAB12.'MAT1') ;   
           XXDEFO = XXXXX4 - XXXXX3 ;                                   
           DSIGTV = 'ELAS' ZMODL XXDEFO ZMAT05 ;                        
           DSIGT  =  DSIGT + DSIGTV ;                                   
        'FINSI' ;                                                       
        'SI' ITHER  ;                                                   
           XXX1 = DSIGT0 * COEPI;                                       
           XXX2 = DSIGT - XXX1;                                         
           DSIGT =  XXX2  ;                                             
        'FINSI';                                                        
                                                                        
        'SI' LOGDEF  ;                                                  
           XXX1 = DSI1 * COEPI;                                         
           XXX2 = DSIGT - XXX1;                                         
           DSIGT =  XXX2 ;                                              
        'FINSI';                                                        
      'FINSI';                                                          
'SI' ('NEG' GR_U_DEB 'INCONNU');                                        
  'FORM' GEOREF0 ;                                                      
   GR_U_FIN = 'GRAD' ZMODL ZMAT ZDETOT ;                                
   D_GR_U   =  GR_U_FIN - GR_U_DEB     ;                                
  'FORM' GEOM1 ;                                                        
'SINON';                                                                
   GR_U_FIN = 'MOT' 'INCONNU';                                          
'FINSI';                                                                
  'SI' ZCCONV ;                                                         
    STAB12.'DT' = DTINI * COEPI ;                                       
  'SINON' ;                                                             
    STAB12.'DT' = 0. ;                                                  
  'FINSI' ;                                                             
MMC = 0 ;                                                               
'SI'  IPLAVI ;                                                          
                                                                        
   'SI' ISSTE;                                                          
      ZRIKTA ZSIGF ZVARF ZDEIF =                                        
                        'SSTE' ZMODL ZSIG0 ZVAR0 DEPST ZMATT            
                               ZPREK NSSTE NITMA;                       
      zvar0 = ('EXCO' zvar0 ('ENLE' lnom ('DIME' lnom))) 'ET'           
              ('EXCO' zvarf ssii);                                      
      zvar0 = 'CHANGER' 'TYPE' zvar0 'VARIABLES INTERNES';              
                                                                        
   'SINON';                                                             
      ZSIG01=ZSIG0;                                                     
      ZVAR01=ZVAR0;                                                     
      ZEPS01=ZEPS0;                                                     
      CHASANST= WTAB.'CHARGEMENT' 'ENLE' 'T';                           
                                                                        
     'SI' (nsoincr 'NEG' 1);                                            
        ZSIGM=ZSIG0/2;                                                  
     'FINSI';                                                           
                                                                        
     'REPETER'  sousinc nsoincr;                                        
                                                                        
       tsodeb='FLOT' stab12 .'DT'/nsoincr*( &sousinc - 1)+conti.'TEMPS';
       tsofin='FLOT' stab12 .'DT'/nsoincr*  &sousinc     +conti.'TEMPS';
      'SI' ('NON' ZCCONV) ;                                             
         tsodeb = tsofin ;                                              
      'FINSI' ;                                                         
                                                                        
       che1= 'ADET' 'NOUV' ZMODL CHASANST tsodeb 'TEMP' tsodeb;         
       che2= 'ADET' 'NOUV' ZMODL CHASANST tsofin 'TEMP' tsofin;         
                                                                        
       'SI' ('EXISTE' WTAB 'MOD_LIA') ;                                 
         vite1 =  'CHAN' 'COMP' conti.'VITESSES' MLPRIM MVPRIM ;        
         che1  = che1                                                   
            'ET' ('CHAN' 'CHAM' ZMODL vite1                'STRESSES')  
            'ET' ('CHAN' 'CHAM' ZMODL conti.'DEPLACEMENTS' 'STRESSES'); 
         che2  = che2                                                   
            'ET' ('CHAN' 'CHAM' ZMODL  ZDETOT              'STRESSES')  
            'ET' ('CHAN' 'CHAM' ZMODL (ZFEXT2 + ZFCONT)    'STRESSES'); 
       'FINSI';                                                         
                                                                        
       'SI' ither ;                                                     
         TETDE=STAB12.'TET1' + (DTETD *('FLOT' (&sousinc - 1)/nsoincr));
         TETDF=STAB12.'TET1' + (DTETD *('FLOT'  &sousinc     /nsoincr));
         che3 = 'CHAN' 'CHAM' ZMODL TETDE 'STRESSES' ;                  
         che4 = 'CHAN' 'CHAM' ZMODL TETDF 'STRESSES' ;                  
       'FINSI' ;                                                        
                                                                        
       che1 = che1 'ET' che3 ;                                          
       che2 = che2 'ET' che4 ;                                          
       aa5  = DEPST * ( (&sousinc - 1.)/ nsoincr);                      
       che5 = DEFT0 +   aa5;                                            
       cc5  = DEPST  * ('FLOT' &sousinc / nsoincr);                     
       che6 = DEFT0 +  CC5;                                             
       che1 = che5 'ET' che1 ;                                          
       che2 = che6 'ET' che2 ;                                          
          che1 = che1 'ET' ('REDU' ZMODL STAB12.'MAT1') ;               
       'SI' ( 'NEG' GR_U_DEB 'INCONNU') ;                               
         gru1 = GR_U_DEB + ( D_GR_U * ('FLOT' (&sousinc-1) / nsoincr)); 
         che1 = che1 'ET' gru1 ;                                        
         gru2 = GR_U_DEB + ( D_GR_U * ('FLOT'  &sousinc    / nsoincr)); 
         che2 = che2 'ET' gru2 ;                                        
       'FINS';                                                          
                                                                        
       'SI' LNLOC ;                                                     
          CHE1A = che1 ;                                                
          CHE2A = che2 ;                                                
                                                                        
          ISTEP = 1 ;                                                   
          chm_z = 'ADET' 'NOUV' ZMODL CHASANST tsodeb 'STEP' ISTEP ;    
          che11 = CHE1A 'ET' chm_z ;                                    
          che11 = che11 'ET' ZSIG01 'ET' ZVAR01 'ET' ZEPS01 ;           
                                                                        
          chm_z = 'ADET' 'NOUV' ZMODL CHASANST tsofin 'STEP' ISTEP ;    
          che22 = CHE2A 'ET' chm_z ;                                    
          che22 = che22 'ET' ZMATT ;                                    
                                                                        
          'SI' PARTLOCA ;                                               
            cha11 = 'ASSIS' 'TOUS' 'REDU' MODRELOC che11 ;              
            cha22 = 'ASSIS' 'TOUS' 'REDU' MODRELOC che22 ;              
            cho22 = 'ASSIS' 'TOUS' 'COMP' MODRELOC cha11 cha22 ;        
            cho2  = 'REDU' ZMODL ('ETG' cho22) ;                        
            cha11 = 0 ; cha22 = 0 ; cho22 = 0 ;                         
          'SINON';                                                      
             cho2  = 'COMP' ZMODL che11 che22 ;                         
          'FINSI' ;                                                     
                                                                        
          ZVARF = 'CHANGER' ('EXCO' cho2 com_var 'NOID')                
                            'TYPE' 'VARIABLES INTERNES' ;               
          'SI' (PARALLEL 'ET' ('NON' PARTLOCA)) ;                       
            ZVARF = 'REDU'  ZVARF ZMODLI ;                              
          'FINSI' ;                                                     
                                                                        
          'SI' ('EGA' WTAB.'NON_LOCAL' 'MOYE') ;                        
             ZVARN = 'NLOC' ZVARF WTAB.'CONN' WTAB.'LVIAM' ;            
          'FINS' ;                                                      
          'SI' ('EGA' WTAB.'NON_LOCAL' 'SB  ') ;                        
             MOD_SB =  WTAB.'NLOC_SB_MODL' ;                            
             CONTP = 'PRIN' ('REDU' ZSIG01 MOD_SB) MOD_SB ;             
             ZVARF = ZVARF '+' CONTP '+' WTAB.'NLOC_SB_REGU' ;          
             ZVARN = 'NLOC' 'SB' ZVARF WTAB.'CONN'                      
                                 WTAB.'NLOC_SB_CCS' ;                   
             ZVARN = 'CHANGER' ('EXCO' ZVARN com_var)                   
                          'TYPE' 'VARIABLES INTERNES' ;                 
          'FINS' ;                                                      
          'SI' (PARALLEL 'ET' ('NON' PARTLOCA)) ;                       
            ZVARN = 'REDU' ZVARN ZMODL ;                                
          'FINSI' ;                                                     
                                                                        
          ISTEP = 2 ;                                                   
          chm_z = 'ADET' 'NOUV' ZMODL CHASANST tsodeb 'STEP' ISTEP ;    
          che11 = CHE1A 'ET' chm_z ;                                    
          che11 = che11 'ET' ZSIG01 'ET' ZVARN 'ET' ZEPS01 ;            
                                                                        
          chm_z = 'ADET' 'NOUV' ZMODL CHASANST tsofin 'STEP' ISTEP ;    
          che22 = CHE2A 'ET' chm_z ;                                    
          che22 = che22 'ET' ZMATT ;                                    
                                                                        
          'SI' PARTLOCA ;                                               
            cha11 = 'ASSIS' 'TOUS' 'REDU' MODRELOC che11 ;              
            cha22 = 'ASSIS' 'TOUS' 'REDU' MODRELOC che22 ;              
            cho22 = 'ASSIS' 'TOUS' 'COMP' MODRELOC cha11 cha22 ;        
            cho2  = 'REDU' ZMODL ('ETG' cho22) ;                        
            cha11 = 0 ; cha22 = 0 ; cho22 = 0 ;                         
          'SINON';                                                      
            cho2  = 'COMP' ZMODL che11 che22 ;                          
          'FINSI' ;                                                     
                                                                        
          CHE1A = 1 ;                                                   
          CHE2A = 1 ;                                                   
          ZVARN = 1 ;                                                   
          ZVARF = 1 ;                                                   
          chm_z = 1 ;                                                   
                                                                        
       'SINON' ;                                                        
           che11 = che1 'ET' ZSIG01 'ET' ZVAR01 'ET' ZEPS01 ;           
           che22 = che2 'ET' ZMATT ;                                    
           'SI' PARTLOCA;                                               
               cha11 = 'ASSIS' 'TOUS' 'REDU' MODRELOC che11 ;           
               cha22 = 'ASSIS' 'TOUS' 'REDU' MODRELOC che22 ;           
               cho22 = 'ASSIS' 'TOUS' 'COMP' MODRELOC cha11 cha22 ;     
               cho2  = 'REDU' ZMODL ('ETG' cho22) ;                     
               cha11 = 0 ; cha22 = 0 ; cho22 = 0 ;                      
           'SINON';                                                     
              cho2  = 'COMP' ZMODL che11 che22 ;                        
           'FINSI';                                                     
       'FINSI' ;                                                        
   ZSIGF = 'CHANGER' ('EXCO' cho2 com_sig 'NOID')                       
                     'TYPE' 'CONTRAINTES' ;                             
   ZVARF = 'CHANGER' ('EXCO' cho2 com_var 'NOID')                       
                     'TYPE' 'VARIABLES INTERNES' ;                      
   ZDEIF = 'CHANGER' ('EXCO' cho2 com_dei 'NOID')                       
                     'TYPE' 'DEFORMATIONS INELASTIQUES' ;               
                                                                        
       'SI' ('EXISTE' WTAB 'MOD_LIA') ;                                 
         ZFLIA = 'EXCO' cho2 'FLIA' 'NOID';                             
       'FINSI' ;                                                        
       'SI' (nsoincr 'NEG' 1);                                          
         'SI' (&sousinc 'EGA' nsoincr);                                 
           aaa1=zsigf/2;                                                
           aaa2=aaa1+ zsigm;                                            
           'DETR' aaa1; 'DETR' zsigm;                                   
           zsigm=aaa2;                                                  
         'SINON';                                                       
           aaa2=zsigf+ zsigm;                                           
           'DETR' zsigm;                                                
           zsigm=aaa2;                                                  
         'FINSI';                                                       
       'FINSI';                                                         
       zsig01 = zsigf ;                                                 
       ZVAR01 = ZVARF ;                                                 
       ZEPS01 = ZDEIF ;                                                 
     'FIN' sousinc;                                                     
     'SI' (IKTAN 'ET' IPERT) ;                                          
       Z1COMP = che11 ;                                                 
       Z2COMP = che22 'ET' ZSIGF ;                                      
     'FINSI' ;                                                          
     'SI' (nsoincr 'NEG' 1);                                            
          CONT  =(ZSIGF + ZSIG0)          ;                             
          ZSIGM = ZSIGM*(2. /nsoincr)     ;                             
          ZSIGM = ZSIGM - CONT            ;                             
          BZSIGM='BSIGMA' ZMODL ZSIGM ZMAT;                             
     'FINSI';                                                           
     zsig01=1;ZVAR01=1;ZEPS01=1;                                        
                                                                        
   'FINSI';                                                             
   'SI' ITHER;                                                          
     'SI' POR1 ;                                                        
        ZSIGF = ZSIGF - ( COEPI * DMSRT0 ) ;                            
     'FINSI';                                                           
   'FINSI';                                                             
   'SI' ('EGA' WTAB.'MOVA' 'RIEN') ;                                    
      MMC=0;                                                            
   'SINON';                                                             
      XXX1 = 'EXCO' (WTAB.'MOVA') ZVARF ;                               
      ACC = 'ABS' ( XXX1 - ACC0 ) ;                                     
      MMC = 'MASQUE' ACC 'SUPERIEUR' 1.D-10 'SOMME' ;                   
      'SI' (MMC > MMCMAX) ; MMCMAX = MMC ; 'FINSI' ;                    
   'FINSI';                                                             
'SINON' ;                                                               
    ZSIGF = ZSIG0 + DSIGT ;                                             
'FINSI';                                                                
DPSMAXP = DPSMAX ;                                                      
DPSMAX = 'MAXI' 'ABS' DEPST 'AVEC' MLDEFOR ;                            
EPSM   = 'MAXI' 'ABS' (ZDETOT 'EPSI' ZMAT ZMODL) 'AVEC' MLDEFOR ;       
 ZMAT2=ZMAT;                                                            
                                                                        
'SI' (IGRD 'ET' ('NON' HPP_EPS) );                                      
                                                                        
  coefmul = 1.d0 / (DPSMAX + 1e-30);                                    
  ref = 75;                                                             
 'SI' ((&bzdept > 1) 'ET' ACC_Q 'ET' ACC_R   );                         
        ref = 200 ; 'FINSI';                                            
  'SI' ((coefmul   < ref) 'ET' WTAB.'LINESEARCH');                      
    zdeptlx = zdept 'EXCO' 'LX' 'LX';                                   
    ACC_Q = VRAI;                                                       
    znacce=999;   zmaxit = it;                                          
    coefmul = 0.5;                                                      
    'SI' ((&bzdept 'EGA' 1) 'ET' (RED_URG < 5));                        
      coefmul = coefmul * -1;                                           
      urg = vrai;                                                       
    'FINSI';                                                            
     zdeptq = zdeptp;                                                   
     'SI' (&bzdept > 1);zdeptq=zdeptini exco 'LX' 'NOID' 'LX'; finsi;   
     ZDEPT = zdeptq +( coefmul  * (ZDEPT -zdeptq)) ;                    
                                                                        
    'SI' (RED_URG > 2 )  ;                                              
     'SI' ('NON' nonconv);  'MESS' ' non convergence detectee 1' ;      
      ZMAXIT =     IT+5;                                                
     'FINSI';                                                           
     nonconv = vrai;                                                    
    'FINSI';                                                            
    'SI' (&bzdept 'EGA' 1);                                             
      'MESS' 'reduction d urgence des deplacements';                    
      hpp_eps=faux; RED_URG = RED_URG + 1;                              
     'FINSI';                                                           
     SI (RED_URG > 6 ); ZMAXIT = IT; 'FINSI';                           
                                                                        
     'ITERER' bzdept;                                                   
    'FINSI';                                                            
  'FINSI';                                                              
                                                                        
'FINSI';                                                                
                                                                        
   'SI' ('NON' WTAB.'LINESEARCH'); 'QUITTER' bzdept; 'FINSI';           
   'SI' (it < 2); 'QUITTER' bzdept; 'FINSI';                            
   'SI' ('MULT' IT ZNACCE); 'QUITTER' bzdept; 'FINSI';                  
   'SI' (HPP_EPS); 'QUITTER' bzdept; 'FINSI';                           
   'SI' ACC_Q ; 'QUITTER' bzdept; 'FINSI';                              
   ACC_Q = VRAI; ACC_R = FAUX;                                          
                                                                        
    r1 = (residc )  * -1.;                                              
     r1 = r1 'ENLE' 'FLX';                                              
                                                                        
    zdeptdif = (zdept - zdeptp)                   ;                     
    krr = (zclim * zdept) - (zclimp * zdeptp) 'ENLE' 'FLX';             
    GEOTEMP='FORM' zdeptp;                                              
    k1 = bsigma (sigma zdeptdif zmodl zmat) zmodl zmat;                 
    k1 = k1 -krr ;                                                      
   'FORM' geom1  ;                                                      
   'DETR' GEOTEMP;                                                      
                                                                        
    GEOTEMP='FORM' zdept ;                                              
    k2 = bsigma (sigma zdeptdif zmodl zmat) zmodl zmat;                 
    k2 = k2 - krr;                                                      
                                                                        
   'FORM' geom1  ;                                                      
   'DETR' GEOTEMP;                                                      
                                                                        
    alpha = k2 - k1 ;                                                   
    beta = k1  ;                                                        
                                                                        
                                                                        
      a0 = xty beta r1 mldual mldual ;                                  
      a1 = (xty beta beta mldual mldual)+(xty alpha r1 mldual mldual);  
      a2 = (3./2.) * (xty alpha beta mldual mldual);                    
      a3 = (1./2.) * (xty alpha alpha mldual mldual);                   
                                                                        
       xr1 = racpol  a0 a1 a2 a3;                                       
       lambd = extr xr1 1;                                              
'SI' WTAB.'STABILITE' ;                                                 
     'SI' (lambd < 0);  lambd = 0.2; 'FINSI';;                          
'FINSI';                                                                
                                                                        
       'SI' ((dime xr1) > 1 );                                          
        lambd2 = extr xr1 2;                                            
        lambd3 = extr xr1 3;                                            
'SI' WTAB.'STABILITE' ;                                                 
     'SI' (lambd2 < 0);  lambd2 = 0.2; 'FINSI';                         
     'SI' (lambd3 < 0);  lambd3 = 0.2; 'FINSI';                         
'FINSI';                                                                
  'SI' ((lambd2 - 1.5 abs) < (lambd - 1.5 abs)); lambd = lambd2;'FINS'; 
  'SI' ((lambd3 - 1.5 abs) < (lambd - 1.5 abs)); lambd = lambd3;'FINSI';
       'FINSI';                                                         
       lambdav=lambd;                                                   
      'SI' (lambd > 4    ); lambd =  4  ;  'FINSI';                     
      'SI' (('ABS' lambd < 1e-4) 'ET' (itacc 'NEG' 3) 'ET'              
            (dpsmax > zprecnc));                                        
         lambd = 0.1 ; urg = vrai; ; znacce = 999; itacc=4;             
      'FINSI';                                                          
          'SI' ((lambd < 0) 'ET' WTAB.'STABILITE');                     
        lambd = 0.3 ; finsi;                                            
        'SI' ('ABS' lambd < 1e-3 );                                     
           lambd = 1e-3;                                                
        'FINSI';                                                        
      'SI' (lambd < -3 ); lambd =-3. ; 'FINSI';                         
     'SI' ((lambd < 0) 'ET' (itacc 'NEG' 3)) ; znacce = 999;'FINSI';    
       zdeptmm = zdep1 'EXTRAI' 'MAIL';                                 
       zdeptm = (zdep1 - ((zdeptp 'EXCO' 'LX' 'LX') 'REDU' zdeptmm))    
                                                        * (lambd - 1);  
       zdept = zdept   + zdeptm ;                                       
                                                                        
       correc = correc - (ZRAID * zdeptm);                              
                                                                        
fin bzdept;                                                             
                                                                        
'SI' ('NON' IFEFP);                                                     
  'SI' (IGRD 'ET' ('NON' HPP_EPS));                                     
                                                                        
     ZPI =  ZSIGF ;                                                     
     zdepf = zdept ;                                                    
     ZSIGF = 'PICA' ZMODL ZPI ZDEPF ;                                   
    'DETR' ZPI ;                                                        
                                                                        
    'SI' ITCAR ;                                                        
       GEOM2 ZMAT2 ='FORM' ZDEPF ZMODLI ZMATI;                          
       ZMAT2       ='REDU' ZMAT2 ZMODL       ;                          
    'SINON';                                                            
       GEOM2 = 'FORM' ZDEPF ;                                           
    'FINSI';                                                            
     FEQU2 = 'BSIGMA' ZMODL ZSIGF  ZMAT2  ;                             
    'SI' IRCON;                                                         
       FEQU2 = FEQU2+('REDU' MAI2 ((WTAB.'RIGIDITE_CONSTANTE')*ZDETOT));
    'FINSI';                                                            
                                                                        
    'SI' WTAB.'PROCEDURE_CHAR_MECA';                                    
       ZDFINI = ZDFINI - FP22 ;                                         
      'DETR' FP22;                                                      
       TFP22  = CHARMECA PRECED WTAB.'T_FINAL' ;                        
      'SI' ('EXIS' TFP22 'ADDI_SECOND');                                
         FP22 = TFP22.'ADDI_SECOND';                                    
      'FINS';                                                           
     ZDFINI = ZDFINI + FP22;                                            
      'SI' IPILOT ;                                                     
         COEFP =(COEPI*DMZPRES+ MZPRES0)/(MZPRES+1.E-15);               
      'FINSI' ;                                                         
   'FINSI' ;                                                            
   'FORM' GEOM1 ;                                                       
  'SINON';                                                              
     FEQU2 = 'BSIGMA' ZMODL ZSIGF ZMAT ;                                
    'SI' IRCON;                                                         
        FEQU2 = FEQU2                                                   
              + ('REDU' MAI2 ((WTAB.'RIGIDITE_CONSTANTE')*ZDETOT));     
    'FINSI';                                                            
    'SI' WTAB.'PROCEDURE_CHAR_MECA'; ;                                  
        ZDFINI = ZDFINI - FP22 ;                                        
        'DETR' FP22;                                                    
         TFP22 = CHARMECA PRECED WTAB.'T_FINAL' ;                       
      'SI' ('EXIS' TFP22 'ADDI_SECOND');                                
         FP22 = TFP22.'ADDI_SECOND';                                    
      'FINS';                                                           
              ZDFINI = ZDFINI + FP22;                                   
      'SI' IPILOT ;                                                     
         COEFP =(COEPI*DMZPRES+ MZPRES0)/(MZPRES+1.E-15);               
      'FINSI' ;                                                         
    'FINSI' ;                                                           
  'FINSI';                                                              
'FINSI';                                                                
       'SI' ('EXISTE' WTAB 'MOD_LIA') ;                                 
          FLIAI = 0.d0 ;                                                
         'SI' ('EGA' ('TYPE' ZFLIA) 'MCHAML  ') ;                       
            NZLIA = 'EXTR' ZFLIA 'NBZO' ;                               
          'SI' (NZLIA > 0) ;                                            
           'REPETER' BZLIA NZLIA ;                                      
        FLIAI= FLIAI +                                                  
  ('EXCO' ('EXTR' ZFLIA 'FLIA' &BZLIA 1 1) MLDUAL 'NOID') ;             
           'FIN' BZLIA ;                                                
          'FINSI' ;                                                     
           FEQU2 = FEQU2 + FLIAI ;                                      
         'FINSI' ;                                                      
       'FINSI' ;                                                        
'SI' (WTAB.'CAFROTTE');                                                 
   MAINT=FAUX;                                                          
  'SI' ('NON' WTAB.'CONV' 'ET' ('NEG' WTAB.'FFROT' 'INCONNU'));         
     MAINT=VRAI;                                                        
  'FINSI';                                                              
   zsigfT = 'REDU' zsigf ZMODLI;                                        
   MODFRO = 'EXTR' WTAB.'CONT_REEL' 'COMP' 'FROTTANT';                  
   MATFRO = 'REDU' WTAB.'MAT_FRO'    WTAB.'CONT_REEL';                  
  'SI' MAINT;                                                           
     FFROT1 = 'EXCF' ZRAID ZDEPT MODFRO MATFRO WTAB.'FFROT' ZSIGFt ;    
  'SINON';                                                              
     FFROT1 = 'EXCF' ZRAID ZDEPT MODFRO MATFRO              ZSIGFt ;    
  'FINSI';                                                              
   FFROT  = ((1*FFROT1) + FFROTP)/2;                                    
  'DETR' FFROTP;                                                        
   FFROTP = FFROT1;                                                     
'FINSI';                                                                
                                                                        
                                                                        
'SI' ISOL  ;                                                            
        'SI' IPLAVI ;                                                   
           ZMATPF = 'CHANGER' ('EXCO' cho2 com_maa 'NOID')              
           'TYPE' 'CARACTERISTIQUES';                                   
           MA_POR = 'REDU' ZMATPF MO_POR ;                              
        'FINSI';                                                        
        XXX1 = 'GRAD' MO_POR ZDETOT MA_POR 'CONS'  ;                    
        XXXS = (1. - WTAB.'TETA' )*GRAP0 + (WTAB.'TETA'*XXX1) ;         
        XXX2 = STAB12.'DT' * ('GNFL' MO_POR XXXS) ;                     
        XXX3 = FEQU2 ;                                                  
        FEQU2 = XXX3 - XXX2;'DETR' XXX3; 'DETR' XXX2 ;                  
'FINSI' ;                                                               
                                                                        
'SI' ( nsoincr > 1);                                                    
  FEQU2 = FEQU2 + BZSIGM ;                                              
'FINSI';                                                                
                                                                        
'SI' IDYN;                                                              
   'DETR' FFDYN;                                                        
    FFDYN = 'COPIER' FEQU2 ;                                            
    XXX1 = WTAB.'MASSE' * ZDEPT;                                        
    XXX3 = 4. * UNSURH * UNSURH  * XXX1 ;                               
   'DETR' XXX1;                                                         
   'SI' ('EXISTE' WTAB 'MOD_LIA');                                      
     'SI' (NZLIA > 0) ;                                                 
        XVIT2 = 0.d0;                                                   
       'REPETER' BZLIA NZLIA ;                                          
          XVIT2 = XVIT2 +                                               
  ('EXCO' ('EXTR' ZFLIA 'FLIA' &BZLIA 1 1) MVPRIM MLPRIM 'NOID') ;      
       'FIN' BZLIA ;                                                    
     'FINSI' ;                                                          
   'FINSI' ;                                                            
   'SI' ( 'NEG' WTAB.'AMORTISSEMENT' 'INCONNU') ;                       
      XXX1 = WTAB.'AMORTISSEMENT' * ZDEPT;                              
      XXX2 = 2. * UNSURH * XXX1 ;                                       
      XXX4 = XXX3 + XXX2 ;                                              
     'DETR'  XXX3 ;                                                     
     'DETR'  XXX1 ;                                                     
     'DETR'  XXX2 ;                                                     
      XXX3 = XXX4 ;                                                     
   'FINSI' ;                                                            
    XXX4 = FEQU2 + XXX3;                                                
   'DETR' XXX3         ;                                                
   'DETR' FEQU2        ;                                                
    FEQU2 = XXX4       ;                                                
  'SI' IMPLP;                                                           
     VADD XXX3 = VITETFOR ZRAID_T  WTAB  FCORU ;                        
     XXX4      = FEQU2 - XXX3;                                          
    'DETR' XXX3      ;                                                  
    'DETR' FEQU2     ;                                                  
     FEQU2     = XXX4;                                                  
  'FINSI' ;                                                             
'FINSI';                                                                
 RESIDUP= RESIDU ;                                                      
 XXX1   = ZFEXT  ;                                                      
'SI'WTAB.'PROCEDURE_CHAR_MECA' ;                                        
   XXX2= XXX1 + (FP22 * COEFP) ;                                        
   XXX1= XXX2                  ;                                        
'FINSI';                                                                
                                                                        
                                                                        
RESIDU = XXX1 - FEQU2;                                                  
FEQUI =  XXX1 - FCORF;                                                  
                                                                        
RESIDC=  RESIDU - FCORF;                                                
                                                                        
       XXX1 = RESIDU +ZFLX1;'DETR' RESIDU;                              
       RESIDU = XXX1 - FCORU;'DETR' XXX1;                               
      'SI' (IPILOT 'ET' IMPO12);                                        
               XXX3 =COEPI-1.D0*DIMPOV;                                 
               XXX1= RESIDU + XXX3;'DETR' RESIDU;RESIDU=XXX1;           
              'DETR' XXX3;                                              
      'FINSI';                                                          
XXX1 = FEQUI - ZFPLO;                                                   
ZFAU1 = 'ABS'  XXX1  ;'DETR' XXX1;                                      
XAUXF = 'MAXI' ZFAU1 'ABS' 'SANS' MXMFLX;                               
'SI' TSTMOM ;                                                           
   XAUXM = 'MAXI' ZFAU1 'ABS' 'AVEC' MXMYMZ;                            
'FINSI';                                                                
'DETR' ZFAU1;                                                           
COEINC = 0.D0;                                                          
'SI' (IPILOT 'ET' PASTEST) ;                                            
       'SI' (WTAB.'VISCOPLASTIQUE' 'OU' WTAB.'VISCODOMMAGE'             
       'OU' ITHER 'OU' LOGDEF );                                        
             'MESS' 'ALPHA calcule avec la norme de l increment' ;      
              COEPI0 = COEPI;                                           
              COEPI = 'MINI' ('PROG' 1. (STAB12.'AUTOCOEF' * al1) );    
              COEINC =COEPI0 - COEPI ;                                  
      'SINON' ;                                                         
              XXX1 = 'EXCO' ZDEPT 'LX' 'NOID' 'LX';                     
              XXX2=2.D0 * XXX1;'DETR' XXX1;                             
              XXX4=ZDEPT - XXX2;'DETR' XXX2;                            
              XXX3=DFEXT0L *(  COEPI * ( 1 - AL1 ));                    
              XXX2 = XXX3 + RESIDC;'DETR' XXX3;XXX5=RESIDNOR* 1.D0;     
             'SI' IMPO12 ;                                              
                   XXX1= COEPI * ( 1 - AL1 ) * DIMPO12;                 
                   XXX3= XXX2  - XXX1;'DETR' XXX1;'DETR' XXX2;          
                   XXX2 = XXX3;XXX1 = XXX5 - DIMPO12;                   
                  'DETR' XXX5; XXX5=XXX1;                               
             'FINSI';                                                   
             'SI' WTAB.'PROCEDURE_CHAR_MECA';                           
                  XXX7= XXX5 + FP22;'DETR' XXX5;                        
                  XXX5 = XXX7 - FP022;'DETR' XXX7;CORFR='COPIER' XXX5;  
             'FINSI';                                                   
              XX3 = 'XTY' RESIDNOR XXX4   MLDUAL MLPRIM;                
              XX1='XTY' XXX2 XXX4 MLDUAL MLPRIM;                        
              XX2='XTY' XXX5 XXX4 MLDUAL MLPRIM ;                       
              COEINC =  XX1 / XX2;                                      
             'DETR' XXX4;'DETR' XXX2;'DETR' XXX5;                       
              COEPI0 = COEPI;                                           
              COEPI = 'MINI' ('PROG' (COEPI0 - COEINC) 1.d0 ) ;         
             'SI' ((COEPI0 'EGA' 1d0) 'ET' (AL1 'EGA' 1D0));            
                   COEPI = 1d0;                                         
             'FINSI';                                                   
              COEINC = COEPI0 - COEPI;                                  
             'SI' ((COEPI 'EGA' 1d0) 'ET' (COEPI0 'NEG' 1d0));ITACC=3;  
             'FINSI';                                                   
     'FINSI' ;                                                          
       XXX3=DFEXT0F * COEINC ;                                          
       XXX2 = ZFEXT - XXX3;'DETR' XXX3;                                 
      'DETR' ZFEXT; ;ZFEXT = XXX2;                                      
      'SI' WTAB.'PROCEDURE_CHAR_MECA';                                  
              MZPRES2=COEPI*DMZPRES+ MZPRES0;                           
              COEFP =MZPRES2/(MZPRES+1.E-15);XXX3 = FP22* COEFP;        
              XXX2 = ZFEXT + XXX3;'DETR' XXX3;                          
      'FINSI';                                                          
       XXX1= XXX2 - FEQU2;                                              
      'DETR' RESIDU;XXX3=COEPI * DFEXT0L; XXX4= XXX3 + FLXINI;          
      'DETR' XXX3; XXX3 = XXX4 - FCORU;'DETR' XXX4;                     
       RESIDU = XXX1 + XXX3;'DETR' XXX3;                                
       'SI' IMPO12;                                                     
              XXX3= 1.D0 - COEPI * DIMPO12;                             
              XXX2= RESIDU + XXX3; 'DETR' RESIDU;                       
              RESIDU = XXX2; 'DETR' XXX3;                               
      'FINSI';                                                          
      'SI' (ITHER  'OU' WTAB.'MATVAR') ;                                
              XXX3 = FTHE * COEINC;                                     
              XXX2= RESIDU + XXX3; 'DETR' RESIDU;                       
              RESIDU = XXX2; 'DETR' XXX3;                               
      'FINSI';                                                          
      'SI' LOGDEF ;                                                     
              XXX3 = FDEF * COEINC;                                     
              XXX2= RESIDU + XXX3; 'DETR' RESIDU;                       
              RESIDU = XXX2; 'DETR' XXX3;                               
      'FINSI';                                                          
                                                                        
       STAB12.'AUTOCOEF'= COEPI ;                                       
      'SI' WTAB.'PROCEDURE_CHAR_MECA';                                  
            XXX1= COEINC * CORFR;'DETR' CORFR;                          
      'SINON';                                                          
            XXX1=(COEINC * RESIDNOR) 'ENLE' FLX;                        
      'FINSI';                                                          
                                                                        
       XXX3 = ACFEP2 - XXX1 ;                                           
       XXX4 = ACFEP1 - XXX1 ;                                           
      'DETR' ACFEP2; ACFEP2= XXX3;                                      
      'DETR' ACFEP1; ACFEP1= XXX4;                                      
      'DETR' XXX1;                                                      
                                                                        
       CORPREC = 1. ;                                                   
      'SI' (COEPI < 0) ;                                                
           CORPREC = ZPRECD / ZPREC;                                    
          'MESS' 'Chargement decroissant. Critere divise par ' CORPREC; 
      'FINSI';                                                          
      'SI' ISNPB ;                                                      
          'SI' ( COEPI > 0) ;                                           
                ISNPB = FAUX ;                                          
          'FINSI' ;                                                     
      'FINSI' ;                                                         
      'MESS' 'nouvelle valeur de ALPHA' COEPI;                          
'FINSI' ;                                                               
'DETR' FCORU;                                                           
                                                                        
XNUMF = 'MAXI' RESIDC 'ABS'  'SANS' MXMFLX;                             
XNUMG = 'MAXI' ((ZDEPL - ZDEPLP)*ZCLIM) 'ABS';                          
XNUMF = 'MAXI' ('PROG' XNUMF XNUMG);                                    
'SI' TSTMOM ;                                                           
       XNUMM= 'MAXI' RESIDC 'ABS' 'AVEC' MXMYMZ;                        
'FINSI';                                                                
'SI' IFTOL;                                                             
       ZPREC =  ZFTOL ;                                                 
       XDENO  = 1.;                                                     
'FINSI';                                                                
'SI' IMTOL;                                                             
      ZPRECM = ZMTOL ;                                                  
      XDENOM = 1.;                                                      
'FINSI';                                                                
XCONV = XNUMF/ XDENO ;                                                  
XCONVM = XCONV ;                                                        
'SI' TSTMOM ;                                                           
      'SI' ( <   XAUXM  1.D-30 ) ;                                      
             XCONVM=0.;                                                 
      'SINON';                                                          
            'SI' ( <   (XAUXF / XAUXM)  1.D-12 ) ;                      
                  XCONV=0.;                                             
            'FINSI';                                                    
             XCONVM =XNUMM/ XDENOM ;                                    
      'FINSI';                                                          
'FINSI' ;                                                               
           'MESS'  IT MMC  XCONV  DPSMAX EPSM XCONVM  ;                 
                                                                        
DETRRES = vrai;                                                         
'SI' (IGRD 'ET' ('NON' HPP_EPS))  ;                                     
  DGR_U_K  =  GR_U_FIN - GR_U_K   ;                                     
  DEKREAC1 = 'MAXI' 'ABS' DGR_U_K ;                                     
  DETR DGR_U_K ;                                                        
'FINSI' ;                                                               
                                                                        
'SI' (IGRD 'ET' WTAB.'CONVERGENCE_MONOTONE');                           
'SI' (XCONV > XCONVP);                                                  
  txtres = 'CHAI' ' Croissance du residu detectee';                     
  'SI' (RECA_K);                                                        
    txtres = 'CHAI' txtres ': reduction de du^i';                       
    coefmul=0.2**(&bzdept2);                                            
    'SI' (IPREM);                                                       
      ZDEP1 = coefmul * ZDEP1;                                          
    'SINO';                                                             
      URG = VRAI;                                                       
      ZDEPL = ZDEPLP; ZDEPT = ZDEPTP;                                   
      si(ega &bzdept2 1); ZDEP1P= ZDEP1;    'FINSI';                    
      ZDLX0 = ZDEPTP 'EXCO' 'LX' 'NOID' 'LX';                           
      ZDEP1 = (coefmul * ZDEP1P) + ((1.-coefmul) * ZDLX0);              
      'DETR' ZDLX0;                                                     
   'FINS';                                                              
    'ITER' bzdept2;                                                     
  'SINO';                                                               
    txtres = chai txtres ': refus de la participation de l itÈrÈ';      
    URG = VRAI;                                                         
    ZDEPL = ZDEPLP; ZDEPT = ZDEPTP;                                     
    RESIDU = RESIDUP; DETRRES = faux;                                   
  'FINS';                                                               
  'MESS' txtres;                                                        
'FINS';                                                                 
'FINS';                                                                 
'SI' (DETRRES); 'DETR' RESIDUP; 'FINS';                                 
    'QUIT' bzdept2;                                                     
                                                                        
'FIN'  bzdept2;                                                         
   'SI'(xconv < xconvp);  zdeptm = zdept ; xconvp = xconv ; 'FINSI';    
                                                                        
TABCONV.IT=XCONV;                                                       
'SI' IPILOT;'SI' ((MMC 'EGA' 0) 'ET' (MMCMAX > 0.) 'ET' (COEPI < 0.));  
    COEPI = 'ABS' COEPI;PASTEST = VRAI;                                 
'FINSI'; 'FINSI';                                                       
  'SI' (WTAB .'CAFROTTE' 'ET' (IT < 2 ));                               
    PASTEST=VRAI;                                                       
  'FINSI';                                                              
   PASUNIL = FAUX;                                                      
   'SI' ('EXISTE' ZRAID_T 'OK');                                        
           'SI' ( 'NON' ZRAID_T.'OK');                                  
                 PASUNIL= VRAI;                                         
           'FINSI';                                                     
   'FINSI';                                                             
                                                                        
'SI' ('NON' PASTEST);                                                   
DEPSTD  = DEPST - DEPSTP ;                                              
DEPSTDM = 'MAXI' 'ABS' DEPSTD 'AVEC' MLDEFOR;                           
DEPSTP  = DEPST;                                                        
   'SI' ( ( IT > 1) 'OU' ('NON' INIT) ) ;                               
   'SI' (RED_URG <EG 2);                                                
                                                                        
        'SI' ( XCONV   < (ZPREC  * CORPREC )) ;                         
        'SI' ( XCONVM  < (ZPRECM * CORPREC )) ;                         
        'SI' ( DEPSTDM < (ZPREC  * CORPREC )) ;                         
        'SI' PASUNIL;                                                   
      'MESS' ' ****** NON CONVERGENCE DE CONTACT A L ITERATION ' IT ;   
       ZICONV = FAUX;                                                   
      'SI' IDYN  ;                                                      
                        VITI = UNSURH * 2. * ZDEPT -                    
                               conti. 'VITESSES';                       
                        VITI = 'ENLE' VITI 'LX' ;                       
                        ZVITET = VITI - conti. 'VITESSES';              
                        ACCEI = UNSURH * 2. * ZVITET -                  
                               conti. 'ACCELERATIONS';                  
                        ACCEI = 'ENLE' ACCEI 'LX' ;                     
                        ZFPU = ZDYFEXT - FFDYN;                         
                        ZFP  = ZFPU - FCORF;                            
                       'DETR' ZFPU;'DETR' FFDYN;'DETR' ZDYFEXT;         
      'FINSI';                                                          
      'QUITTER' ETIQ;                                                   
        'FINSI';                                                        
        'SI' ('NON' HPP_EPS) ;                                          
                                                                        
               'MESS' ' ****** CONVERGENCE A L ITERATION ' IT           
                          '  SOUS-PAS ' WTAB . 'ISOUSPAS';              
               'MESS' ' ';                                              
               STAB12.'NBPLAS'= MMC ;                                   
              'SI' IDYN  ;                                              
                        VITI = UNSURH * 2. * ZDEPT -                    
                           conti. 'VITESSES' ;                          
                        VITI = 'ENLE' VITI 'LX' ;                       
                        ZFPU = ZDYFEXT - FFDYN;                         
                        ZFP  = ZFPU - FCORF;                            
                       'DETR' ZFPU;'DETR' FFDYN;'DETR' ZDYFEXT;         
                                                                        
      'SI' ('EXISTE' WTAB 'MOD_LIA');                                   
       'SI' ('EXISTE' WTAB.'MOD_LIA' 'MATE' 'NEWMARK') ;                
         'SI' ('EGA' 'CHPOINT  ' ('TYPE' FLIAI) ) ;                     
          MODNEW = 'EXTR' WTAB.'MOD_LIA' 'MATE' 'NEWMARK' ;             
          MAUNEW = 'EXTR' MODNEW 'MAIL' ;                               
          'SI' ('EXIS' ZFLIA MODNEW) ;                                  
             ZFLIANEW = 'REDU' ZFLIA MODNEW ;                           
             NZNEW = 'EXTR' ZFLIANEW 'NBZO' ;                           
            ZFPNW = 0. ; XVITW = 0. ;                                   
           'REPETER' BZLIAW NZNEW ;                                     
         ZFPNW = ZFPNW +                                                
  ('EXCO' ('EXTR' ZFLIANEW 'FLIA' &BZLIAW 1 1) MLDUAL 'NOID') ;         
              XVITW = XVITW +                                           
  ('EXCO' ('EXTR' ZFLIANEW 'FLIA' &BZLIAW 1 1) MVPRIM MLPRIM 'NOID') ;  
           'FIN' BZLIAW ;                                               
                                                                        
            ZFP = ZFP +  ZFPNW ;                                        
          'FINSI' ;                                                     
         'FINSI' ;                                                      
       'FINSI' ;                                                        
                                                                        
       'SI' (NZLIA > 0) ;                                               
            XVIT2 = 0.d0;                                               
                                                                        
           'REPETER' BZLIA NZLIA ;                                      
             XVIT2 = XVIT2 +                                            
  ('EXCO' ('EXTR' ZFLIA 'FLIA' &BZLIA 1 1) MVPRIM MLPRIM 'NOID') ;      
           'FIN' BZLIA ;                                                
        'SI' ('EGA' ('TYPE' XVIT2) 'CHPOINT  ') ;                       
          MAAUT2 = 'DIFF' ('EXTR' VITI 'MAIL') ('EXTR' XVIT2 'MAIL') ;  
          VITI = ('REDU' VITI MAAUT2) + XVIT2 ; 'DETR' XVIT2 ;          
          'SI' ('EGA' ('TYPE' XVITW) 'CHPOINT  ') ;                     
            MAAUT3 = 'DIFF' ('EXTR' VITI 'MAIL') ('EXTR' XVITW 'MAIL'); 
          VITI = ('REDU' VITI MAAUT3) + XVITW ; 'DETR' XVITW ;          
          'FINSI' ;                                                     
        'FINSI' ;                                                       
         'DETR' FLIAI ;'DETR' ZFLIA ;                                   
       'FINSI' ;                                                        
      'FINSI' ;                                                         
                                                                        
                        ZVITET = VITI - conti. 'VITESSES';              
                        ACCEI = UNSURH * 2. * ZVITET -                  
                               conti. 'ACCELERATIONS';                  
                        ACCEI = 'ENLE' ACCEI 'LX' ;                     
              'FINSI' ;                                                 
               STAB12.'NOMBRE_ITERATIONS' = IT;                         
              'QUITTE' ETIQ ;                                           
       'SINON';                                                         
                                                                        
         CORPREC=1; ITACC=5;                                            
         EPS_EPS = TEXTE '        '; HPP_EPS = FAUX;                    
         xconvp = 1;                                                    
         XCONVMIN = 1e20;                                               
         DPSMREF  = 0   ;                                               
         'REPETER' tabraz it;                                           
          tabconv.&tabraz = 1;                                          
         'FIN' tabraz;                                                  
                                                                        
       PASTEST=VRAI;                                                    
       'MESS' ' passage en grands deplacements';                        
       'FINSI';                                                         
       'FINSI';                                                         
       'FINSI';                                                         
       'FINSI';                                                         
       'FINSI';                                                         
   'FINSI' ;                                                            
'FINSI' ;                                                               
XCONVREF=1E50;                                                          
'SI' (IT > WTAB.'DELTAITER');                                           
     XCONVREF=TABCONV.(IT-WTAB.'DELTAITER') * 0.99;                     
'FINSI';                                                                
'SI' (('NON' PASTEST) 'ET' (XCONV < XCONVMIN));                         
XCONVMIN = XCONV; DPSMREF=DPSMAX/10;                                    
'SI' (XCONVMIN < ZPREC); XCONVMIN=ZPREC; 'FINSI';                       
'FINSI';                                                                
'SI'(IT '>EG' ZMAXIT 'OU' (XCONV > XCONVREF) 'OU'                       
((XCONV < ZPREC) 'ET' ( XCONVM < ZPREC) 'ET' (DEPSTDM < ZPREC))         
     'ET' ('NON' PASTEST) 'ET' ('NON' NONCONV) 'ET' ( IT > 1)           
     'ET' ('NON' IPILOT) 'ET' ('NON' PASUNIL));                         
      'MESS' ' non convergence detectee 2' ;ZMAXIT = 3 * IT;            
      HPP_EPS=FAUX;                                                     
      URG = VRAI; RED_URG = RED_URG + 1;                                
      COEPI = WTAB.'RELAXATION_NONCONV';                                
      STAB12.'AUTOCOEF'= COEPI ;                                        
      'SI' (dpsmax < (zprec * 1e3));                                    
       zdept = zdept *coepi;                                            
      'SINON';                                                          
        zdept = zdeptm *coepi;                                          
      'FINSI';                                                          
      NONCONV = VRAI;                                                   
      itacc=4;                                                          
      'SI' (COEPI < 0.99999); ZICONV = FAUX;  'FINSI';                  
      ITNV=IT;                                                          
'FINSI';                                                                
'SI' nonconv ;'SI' (it > (zmaxit *2 /3)); zprecnc=zprecnc*1.4;          
'FINSI';'FINSI';                                                        
'SI' ('NON' PASTEST 'ET' (dpsmax < zprecnc));                           
'SI' ((IT '>EG' ZMAXIT)                                                 
  'OU' ((NBCYCLE1 '>EG' 3) 'ET' (IT 'EGA' (ITNORM1 + DITNORM1 - 1)))    
  'OU' (NONCONV 'ET' ('NON' PASTEST)                                    
       'ET' (XCONV '>' XCONVREF) 'ET' (DPSMAX '>EG'  DPSMREF)           
       'ET' (ITNV 'NEG' IT)));                                          
                                                                        
      'MESS' ' ****** NON CONVERGENCE A L ITERATION ' IT ' /' ZMAXIT    
       '  SOUS-PAS ' WTAB . 'ISOUSPAS';;                                
       ZICONV = FAUX;                                                   
      'SI' IDYN  ;                                                      
                        VITI = UNSURH * 2. * ZDEPT -                    
                               conti. 'VITESSES';                       
                        VITI = 'ENLE' VITI 'LX' ;                       
                        ZVITET = VITI - conti. 'VITESSES';              
                        ACCEI = UNSURH * 2. * ZVITET -                  
                               conti. 'ACCELERATIONS';                  
                        ACCEI = 'ENLE' ACCEI 'LX' ;                     
                        ZFPU = ZDYFEXT - FFDYN;                         
                        ZFP  = ZFPU - FCORF;                            
                       'DETR' ZFPU;'DETR' FFDYN;'DETR' ZDYFEXT;         
      'FINSI';                                                          
      'QUITTER' ETIQ;                                                   
'FINSI' ;                                                               
'FINSI' ;                                                               
'DETR' FEQU2;                                                           
'SI' WTAB.'PROCEDURE_CHAR_MECA' ;                                       
       'SI' IDYN  ;                                                     
             XXX1=ZFCONSTA - ZFP1 + FP22;                               
             ZDYFEXT = XXX1 'ENLEVER' 'FLX';'DETR' XXX1;                
       'FINSI';                                                         
'FINSI' ;                                                               
'SI' IKTAN ;                                                            
  'SI' ('NON' IFEFP) ;                                                  
    'SI' ('MULT' ZITAC ZNCONS) ;                                        
      'SI' (IGRD 'ET' ('NON' HPP_EPS));                                 
        'FORM' GEOM2 ;                                                  
        ZMATloc = ZMAT2 ;                                               
      'SINON' ;                                                         
        ZMATloc = ZMAT ;                                                
      'FINSI' ;                                                         
                                                                        
      'SI' ('NON' ISSTE) ;                                              
        'SI' IPERT ;                                                    
          'SI' PARTLOCA ;                                               
            cha1 = 'ASSIS' 'TOUS' 'REDU' MODRELOC Z1COMP ;              
            cha2 = 'ASSIS' 'TOUS' 'REDU' MODRELOC Z2COMP ;              
            zktap = 'ASSIS' 'TOUS' 'KTAN' 'PERT' MODRELOC cha1 cha2     
                                          'C1' ZPERC1 'C2' ZPERC2       
                                          ZKTASYM ;                     
            ZRIKTA = 'ET' zktap ;                                       
          'SINON';                                                      
            ZRIKTA = 'KTAN' 'PERT' ZMODL Z1COMP Z2COMP                  
                            'C1' ZPERC1 'C2' ZPERC2 ZKTASYM ;           
          'FINSI';                                                      
        'SINON' ;                                                       
          'SI' ('ET' ('NON' IVISCO) ('NON' IVIDOM)) ;                   
            DTTAN = 0. ;                                                
          'SINON' ;                                                     
            DTTAN = STAB12.'DT' ;                                       
          'FINSI' ;                                                     
          ZRIKTA = 'KTAN' ZMODL ZSIGF ZVARF ZMATloc                     
                                'PREC' ZPREK 'DT  ' DTTAN ZKTASYM ;     
        'FINSI' ;                                                       
      'FINSI' ;                                                         
                                                                        
      'SI' IKSIA ;                                                      
        KSIG = 'KSIGMA' ZMODL ZSIGF ZMATloc ;                           
        ZRIKTA = ZRIKTA 'ET' KSIG ;                                     
      'FINSI' ;                                                         
                                                                        
      ZRAID = ZRIKTA 'ET' ZCLIM ;                                       
                                                                        
      'SI' IGRD ;  'FORM' GEOM1 ;  'FINSI' ;                            
                                                                        
      IKT = VRAI ; ZMATloc = 1. ;                                       
                                                                        
    'FINSI' ;                                                           
  'FINSI' ;                                                             
'FINSI' ;                                                               
'SI' (IGRD 'ET' ('NON' HPP_EPS));                                       
'SI' ('EGA' ('TYPE' GEOM2) 'CONFIGUR');                                 
     'DETR' GEOM2 ;                                                     
'FINSI';                                                                
'FINSI' ;                                                               
                                                                        
'SI' IFEFP ; 'DETR' ZRIKTA ; 'DETR' GEOM2;  'FINSI' ;                   
IPREM = FAUX;      IAFAIR=VRAI; RECA_K = FAUX;                          
'FIN' ETIQ ;                                                            
'SI' (WTAB. 'CAFROTTE' );                                               
     STAB12.'FFROT'= 'COPIER' FFROT;                                    
'FINSI';                                                                
               STAB12.'RESIDU' = RESIDC;                                
               XXX1 = ZRAID * ZDEPT;                                    
               XXX3 = ZDFINI * COEPI;                                   
               XXX4 = XXX1 - XXX3;                                      
               XXX3 = XXX4 + RESIDC;                                    
               XXX1 = XXX3 - FREAP ;                                    
               XXX5 = XXX1 'ENLEVER' 'FLX ' ;                           
               'DETR' XXX1 ; 'DETR' XXX3 ; 'DETR' XXX4 ;                
           'SI' WTAB.'CONV';                                            
               STAB12.'FNONL' = XXX5 ;                                  
           'SINON';                                                     
               STAB12.'FNONL' = XXX5 + STAB12.'FNONL';                  
               'DETR' XXX5 ;                                            
           'FINSI';                                                     
               STAB12.'DTPREC'= WTAB.'DT_INIT';                         
'SI' IKTAN ;                                                            
  'SI' IFEFP ;                                                          
    STAB12.'LASTKTAN' = ZRIKTA ;                                        
  'SINON' ;                                                             
    'SI' (IKT_SAUV 'ET' IKT) ;                                          
      STAB12.'LASTKTAN' = ZRIKTA ;                                      
    'FINSI' ;                                                           
  'FINSI' ;                                                             
'FINSI' ;                                                               
'SI' IPLAVI ;                                                           
      'SI' ('NEG' WTAB.'MOVA' 'RIEN') ;                                 
       'FINSI' ;                                                        
'FINSI' ;                                                               
'DETR' ZFEXT ; 'DETR' FREAP ;                                           
'SI' IPILOT;                                                            
          'SI' ITHER ;                                                  
                 'DETR' FTHE ;                                          
                 'DETR' ETT;                                            
                  XXX1= (TETA2 - TETA1) * COEPI + TETA1;                
                  STAB12.'TET2' = XXX1;                                 
                  XXX1 = XXX1 - WTAB.'TEMPERATURE_REFERENCE';           
                  ETT = 'EPTH' ZMODL ZMAT  XXX1 ;                       
                  ETT=ETT - WTAB.'ETREF' ;                              
                  'SI' POR1 ;                                           
                      ZMATP  = 'REDU'  ZMAT MO_POR ;                    
                      ZALM   = 'EXCO' 'ALPM' ZMATP 'MSR0' ;             
                      ZBI    = 'EXCO' 'COB'  ZMATP 'MSR0' ;             
                      ZALPH  = 'EXCO' 'ALPH' ZMATP 'MSR0' ;             
                      ZFAC = 3. * ( ZALM - ( ZBI * ZALPH ) );           
                      ZFAC = 'CHAN' 'STRESSES' MO_POR ZFAC ;            
                      ZDT = 'REDU' XXX1 MAI_POR;                        
                      ZDDT = 'CHAN' 'CHAM' ZDT MO_POR                   
                             'STRESSES' 'SCALAIRE';                     
                      MSRTT = ZFAC  * ZDDT ;                            
                  'FINSI';                                              
          'FINSI';                                                      
          'SI' LOGDEF ;                                                 
             XXX1 = 'REDU' (DDEFOR0 '*' COEPI) ZMODLI;                  
             STAB12.'DEFOR2' = STAB12.'DEFOR1' '+' XXX1    ;            
            'DETR' XXX1;'DETR' FDEF ;                                   
          'FINSI';                                                      
'FINSI';                                                                
'SI' ITHER ;                                                            
   STAB12.'ETHER2'='REDU' ETT ZMODLI ;                                  
   STAB12.'ETHER1'=STAB12.'ETHER2' ;                                    
   'SI'  POR1 ;                                                         
       STAB12.'MSRTHER2'='REDU' MSRTT ZMODLI;                           
   'FINSI';                                                             
'FINSI';                                                                
'SI'  IDYN  ;                                                           
           STAB12.'FOPL' = ZFP ;                                        
           STAB12.'VITI' = VITI;                                        
           STAB12.'ACCEI' = ACCEI;                                      
           'SI' IMPLP; STAB12.'VAUX' = VADD; 'FINSI';                   
'FINSI' ;                                                               
'SI' IGRD;                                                              
  depstp = depst;                                                       
  DEPST = 'CAPI' zu1  depst zmodl;                                      
'FINSI';                                                                
                                                                        
STAB12.'DEFF' = 'REDU' (DEFT0 + DEPST) ZMODLI;                          
'SI'  IPLAVI ;                                                          
  STAB12.'VARF' = 'REDU' ZVARF ZMODLI ;                                 
  STAB12.'DFPF' = 'REDU' ZDEIF ZMODLI;                                  
 'SI' IFEFPUL;                                                          
    STAB12.'FOR'  = GEOM2 ;                                             
 'FINSI';                                                               
  ZVAR0=STAB12.'VARF';                                                  
  ZEPS0=STAB12.'DFPF';                                                  
'FINSI';                                                                
                                                                        
STAB12.'DEPT' = ZDEPT ;                                                 
STAB12.'ZU1'  = ('ENLE' ZU1 'LX' ) +  ZDEPT ;                           
STAB12.'SIGF' = 'REDU' ZSIGF ZMODLI;                                    
STAB12.'CONV' = ZICONV ;                                                
'SI' ZICONV;                                                            
   STAB12.'XDENO'=XDENO;                                                
   STAB12.'XDENOM' = XDENOM;                                            
'SINON';                                                                
   STAB12.'XDENO'  = 'MAXI'  ('PROG' STAB12.'XDENO'  XDENO  );          
   STAB12.'XDENOM' = 'MAXI'  ('PROG' STAB12.'XDENOM' XDENOM );          
'FINSI';                                                                
                                                                        
 STAB12.'DFGRAD' = GR_U_FIN ;                                           
                                                                        
'SI' IGRD;                                                              
   'SI' ('EGA' GEOM2 'GEOM2');                                          
     'SI' ITCAR ;                                                       
        GEOM2 ZMAT2 ='FORM' ZDEPT ZMODLI ZMATI;                         
        ZMAT2       ='REDU' ZMAT2 ZMODL       ;                         
     'SINON';                                                           
        GEOM2 = 'FORM' ZDEPT ;                                          
     'FINSI';                                                           
   'FINSI';                                                             
    STAB12.'FOR' = GEOM2 ;                                              
    GEOM1=GEOM2;                                                        
    GEO_COUR= STAB12.'FOR';                                             
    'FORM' GEO_COUR;                                                    
    STAB12.'FOR' = GEOM2 ;                                              
    GEOM2='MOT' 'GEOM2';                                                
    'SI'  (&BONOCON 'NEG' 1);                                           
      'DETR' GEO_COUR;                                                  
    'FINSI';                                                            
    GEOM1= STAB12.'FOR';                                                
   'FORM' GEOM1;                                                        
   'SI' ITCAR;                                                          
     STAB12.'CARA'= 'REDU' ZMAT2 ZMODLI;                                
   'FINSI';                                                             
'FINSI' ;                                                               
'SI' LOGDEF;STAB12.'DEFOR1'=STAB12.'DEFOR2';'FINSI';                    
STAB12.'MAT1' = REDU ZMAT2          ZMODLI ;                            
STAB12.'ETAT1'= REDU STAB12.'ETAT2' ZMODLI ;                            
'SI' ('NEG' WTAB.'DT' STAB12.'DT');                                     
   STAB12.'DT'= WTAB.'DT' - STAB12.'DT'    ;                            
'FINSI';                                                                
DEPS0  = STAB12.'DEFF';                                                 
TEMPS0 = TI;                                                            
                                                                        
  ZCCONV = ZICONV ;                                                     
  'SI' ('NON' ZICONV) ;                                                 
    DEFT0 = STAB12.'DEFF' ;                                             
    'SI' ('EXISTE' STAB12 'LISEA_M') ;                                  
      WTAB.'LISEA_M' = STAB12.'LISEA_M' ;                               
    'FINSI' ;                                                           
    'SI' ('EXISTE' STAB12 'RIBLO_M') ;                                  
      WTAB.'RIBLO_M' = STAB12.'RIBLO_M' ;                               
    'FINSI' ;                                                           
    'SI' ('EXIS' STAB12 'TET2') ;                                       
      STAB12.'TET1'  = STAB12.'TET2'  ;                                 
    'FINSI' ;                                                           
    'SI' ITHER ;                                                        
      STAB12.'TETA1' = STAB12.'TETA2' ;                                 
    'FINSI' ;                                                           
  'FINSI' ;                                                             
                                                                        
'SI' ZICONV;'QUITTER'  BONOCONV;'FINSI';                                
WTAB.'CONV'=STAB12.'CONV';                                              
                                                                        
WTAB.'ISOUSPAS' = WTAB.'ISOUSPAS' + 1;                                  
'SI' (WTAB.'ISOUSPAS' >EG WTAB.'MAXSOUSPAS');                           
     'ERREUR' 996 ;                                                     
'FINSI';                                                                
wtab.'CLIMCF' = ZCLIM;                                                  
                                                                        
'FIN' BONOCONV;                                                         
                                                                        
'SI' ('NEG' GR_U_FIN 'INCONNU') ;                                       
  STAB12.'DFGRAD' = 'REDU' GR_U_FIN ZMODLI ;                            
'SINON' ;                                                               
  STAB12.'DFGRAD' = 'MOT' 'INCONNU' ;                                   
'FINSI';                                                                
WTAB.'DFGRAD' = STAB12.'DFGRAD' ;                                       
                                                                        
 conti.'TEMPS' = conti.'TEMPS' + DT_INIT ;                              
WTAB.'MAT1' = ZMAT2 ;                                                   
wtab.'CLIM' = ZCLIM;                                                    
                                                                        
'OPTI' 'PARA' FAUX;                                                     
'FINPROC' STAB12;                                                       
fin;                                                                    
